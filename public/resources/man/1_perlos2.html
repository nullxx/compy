<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Thu Aug 18 14:59:22 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>PERLOS2</title>

</head>
<body>

<h1 align="center">PERLOS2</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#Frequently asked questions">Frequently asked questions</a><br>
<a href="#INSTALLATION">INSTALLATION</a><br>
<a href="#Accessing documentation">Accessing documentation</a><br>
<a href="#BUILD">BUILD</a><br>
<a href="#Building a binary distribution">Building a binary distribution</a><br>
<a href="#Building custom .EXE files">Building custom .EXE files</a><br>
<a href="#Build FAQ">Build FAQ</a><br>
<a href="#Specific (mis)features of OS/2 port">Specific (mis)features of OS/2 port</a><br>
<a href="#Perl flavors">Perl flavors</a><br>
<a href="#ENVIRONMENT">ENVIRONMENT</a><br>
<a href="#Evolution">Evolution</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#AUTHOR">AUTHOR</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">perlos2 &minus;
Perl under OS/2, DOS, Win0.3*, Win0.95 and WinNT.</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">One can read
this document in the following formats:</p>

<pre style="margin-left:11%; margin-top: 1em">        man perlos2
        view perl perlos2
        explorer perlos2.html
        info perlos2</pre>


<p style="margin-left:11%; margin-top: 1em">to list some
(not all may be available simultaneously), or it may be read
<i>as is</i>: either as <i><small>README</small> .os2</i>,
or <i>pod/perlos2.pod</i>.</p>

<p style="margin-left:11%; margin-top: 1em">To read the
<i>.INF</i> version of documentation (<b>very</b>
recommended) outside of <small>OS/2</small> , one needs an
<small>IBM</small> &rsquo;s reader (may be available on
<small>IBM</small> ftp sites (?) ( <small>URL</small>
anyone?)) or shipped with <small>PC DOS</small> 7.0 and
<small>IBM</small> &rsquo;s Visual Age C <small>++</small>
3.5.</p>

<p style="margin-left:11%; margin-top: 1em">A copy of a
Win* viewer is contained in the &quot;Just add
<small>OS/2</small> Warp&quot; package</p>

<pre style="margin-left:11%; margin-top: 1em">  ftp://ftp.software.ibm.com/ps/products/os2/tools/jaow/jaow.zip</pre>


<p style="margin-left:11%; margin-top: 1em">in
<i>?:\JUST_ADD\view.exe</i>. This gives one an access to
<small>EMX</small> &rsquo;s <i>.INF</i> docs as well (text
form is available in <i>/emx/doc</i> in <small>EMX</small>
&rsquo;s distribution). There is also a different viewer
named xview.</p>

<p style="margin-left:11%; margin-top: 1em">Note that if
you have <i>lynx.exe</i> or <i>netscape.exe</i> installed,
you can follow <small>WWW</small> links from this document
in <i>.INF</i> format. If you have <small>EMX</small> docs
installed correctly, you can follow library links (you need
to have <tt>&quot;view emxbook&quot;</tt> working by setting
<tt>&quot;EMXBOOK&quot;</tt> environment variable as it is
described in <small>EMX</small> docs).</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Target</b>
<br>
The target is to make <small>OS/2</small> one of the best
supported platform for using/building/developing Perl and
<i>Perl applications</i>, as well as make Perl the best
language to use under <small>OS/2</small> . The secondary
target is to try to make this work under <small>DOS</small>
and Win* as well (but not <b>too</b> hard).</p>

<p style="margin-left:11%; margin-top: 1em">The current
state is quite close to this target. Known limitations:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="6%"></td>
<td width="82%">


<p>Some *nix programs use <i>fork()</i> a lot; with the
mostly useful flavors of perl for <small>OS/2</small> (there
are several built simultaneously) this is supported; but
some flavors do not support this (e.g., when Perl is called
from inside <small>REXX</small> ). Using <i>fork()</i> after
<i>use</i>ing dynamically loading extensions would not work
with <i>very</i> old versions of <small>EMX</small> .</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="6%"></td>
<td width="82%">


<p>You need a separate perl executable <i>perl__.exe</i>
(see &quot;perl__.exe&quot;) if you want to use
<small>PM</small> code in your application (as Perl/Tk or
OpenGL Perl modules do) without having a text-mode window
present.</p> </td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">While using the
standard <i>perl.exe</i> from a text-mode window is possible
too, I have seen cases when this causes degradation of the
system stability. Using <i>perl__.exe</i> avoids such a
degradation.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="6%"></td>
<td width="82%">


<p style="margin-top: 1em">There is no simple way to access
<small>WPS</small> objects. The only way I know is via
<tt>&quot;OS2::REXX&quot;</tt> and <tt>&quot;SOM&quot;</tt>
extensions (see <small>OS2::REXX</small> ,
<small>SOM</small> ). However, we do not have access to
convenience methods of Object-REXX. (Is it possible at all?
I know of no Object-REXX <small>API</small> .) The
<tt>&quot;SOM&quot;</tt> extension (currently in alpha-text)
may eventually remove this shortcoming; however, due to the
fact that <small>DII</small> is not supported by the
<tt>&quot;SOM&quot;</tt> module, using
<tt>&quot;SOM&quot;</tt> is not as convenient as one would
like it.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Please keep
this list up-to-date by informing me about other items.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Other
OSes</b> <br>
Since <small>OS/2</small> port of perl uses a remarkable
<small>EMX</small> environment, it can run (and build
extensions, and &minus; possibly &minus; be built itself)
under any environment which can run <small>EMX</small> . The
current list is <small>DOS</small> ,
DOS&minus;inside&minus;OS/2, Win0.3*, Win0.95 and WinNT. Out
of many perl flavors, only one works, see
&quot;perl_.exe&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">Note that not
all features of Perl are available under these environments.
This depends on the features the <i>extender</i> &minus;
most probably <small>RSX</small> &minus; decided to
implement.</p>

<p style="margin-left:11%; margin-top: 1em">Cf.
&quot;Prerequisites&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Prerequisites</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em"><small>EMX</small></p></td>
<td width="5%"></td>
<td width="80%">


<p style="margin-top: 1em"><small>EMX</small> runtime is
required (may be substituted by <small>RSX</small> ). Note
that it is possible to make <i>perl_.exe</i> to run under
<small>DOS</small> without any external support by binding
<i>emx.exe</i>/<i>rsx.exe</i> to it, see
<tt>&quot;emxbind&quot;</tt>. Note that under
<small>DOS</small> for best results one should use
<small>RSX</small> runtime, which has much more functions
working (like <tt>&quot;fork&quot;</tt>,
<tt>&quot;popen&quot;</tt> and so on). In fact
<small>RSX</small> is required if there is no
<small>VCPI</small> present. Note the <small>RSX</small>
requires <small>DPMI</small> . Many implementations of
<small>DPMI</small> are known to be very buggy, beware!</p></td></tr>
</table>

<p style="margin-left:20%; margin-top: 1em">Only the latest
runtime is supported, currently <tt>&quot;0.9d fix
03&quot;</tt>. Perl may run under earlier versions of
<small>EMX</small> , but this is not tested.</p>

<p style="margin-left:20%; margin-top: 1em">One can get
different parts of <small>EMX</small> from, say</p>

<pre style="margin-left:20%; margin-top: 1em">  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/
  http://hobbes.nmsu.edu/h&minus;browse.php?dir=/pub/os2/dev/emx/v0.9d/</pre>


<p style="margin-left:20%; margin-top: 1em">The runtime
component should have the name <i>emxrt.zip</i>.</p>


<p style="margin-left:20%; margin-top: 1em"><b><small>NOTE</small></b>
. When using <i>emx.exe</i>/<i>rsx.exe</i>, it is enough to
have them on your path. One does not need to specify them
explicitly (though this</p>

<pre style="margin-left:20%; margin-top: 1em">  emx perl_.exe &minus;de 0</pre>


<p style="margin-left:20%; margin-top: 1em">will work as
well.)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em"><small>RSX</small></p></td>
<td width="5%"></td>
<td width="80%">


<p style="margin-top: 1em">To run Perl on
<small>DPMI</small> platforms one needs <small>RSX</small>
runtime. This is needed under DOS&minus;inside&minus;OS/2,
Win0.3*, Win0.95 and WinNT (see &quot;Other OSes&quot;).
<small>RSX</small> would not work with <small>VCPI</small>
only, as <small>EMX</small> would, it requires
<small>DMPI</small> .</p></td></tr>
</table>

<p style="margin-left:20%; margin-top: 1em">Having
<small>RSX</small> and the latest <i>sh.exe</i> one gets a
fully functional <b>*nix</b>&minus;ish environment under
<small>DOS</small> , say, <tt>&quot;fork&quot;</tt>,
<tt>&quot;``&quot;</tt> and
pipe&minus;<tt>&quot;open&quot;</tt> work. In fact,
MakeMaker works (for static build), so one can have Perl
development environment under <small>DOS</small> .</p>

<p style="margin-left:20%; margin-top: 1em">One can get
<small>RSX</small> from, say</p>

<pre style="margin-left:20%; margin-top: 1em">  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/
  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/contrib/</pre>


<p style="margin-left:20%; margin-top: 1em">Contact the
author on
<tt>&quot;rainer@mathematik.uni&minus;bielefeld.de&quot;</tt>.</p>

<p style="margin-left:20%; margin-top: 1em">The latest
<i>sh.exe</i> with <small>DOS</small> hooks is available
in</p>

<pre style="margin-left:20%; margin-top: 1em">  http://www.ilyaz.org/software/os2/</pre>


<p style="margin-left:20%; margin-top: 1em">as
<i>sh_dos.zip</i> or under similar names starting with
<tt>&quot;sh&quot;</tt>, <tt>&quot;pdksh&quot;</tt> etc.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p style="margin-top: 1em"><small>HPFS</small></p></td>
<td width="3%"></td>
<td width="80%">


<p style="margin-top: 1em">Perl does not care about file
systems, but the perl library contains many files with long
names, so to install it intact one needs a file system which
supports long file names.</p></td></tr>
</table>

<p style="margin-left:20%; margin-top: 1em">Note that if
you do not plan to build the perl itself, it may be possible
to fool <small>EMX</small> to truncate file names. This is
not supported, read <small>EMX</small> docs to see how to do
it.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p style="margin-top: 1em">pdksh</p></td>
<td width="2%"></td>
<td width="80%">


<p style="margin-top: 1em">To start external programs with
complicated command lines (like with pipes in between,
and/or quoting of arguments), Perl uses an external shell.
With <small>EMX</small> port such shell should be named
<i>sh.exe</i>, and located either in the
wired-in-during-compile locations (usually <i>F:/bin</i>),
or in configurable location (see &quot;
<small>PERL_SH_DIR</small> &quot;).</p></td></tr>
</table>

<p style="margin-left:20%; margin-top: 1em">For best
results use <small>EMX</small> pdksh. The standard binary
(5.2.14 or later) runs under <small>DOS</small> (with &quot;
<small>RSX</small> &quot;) as well, see</p>

<pre style="margin-left:20%; margin-top: 1em">  http://www.ilyaz.org/software/os2/</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Starting
Perl programs under <small>OS/2</small> (and
<small>DOS</small> and...)</b> <br>
Start your Perl program <i>foo.pl</i> with arguments
<tt>&quot;arg1 arg2 arg3&quot;</tt> the same way as on any
other platform, by</p>

<pre style="margin-left:11%; margin-top: 1em">        perl foo.pl arg1 arg2 arg3</pre>


<p style="margin-left:11%; margin-top: 1em">If you want to
specify perl options <tt>&quot;&minus;my_opts&quot;</tt> to
the perl itself (as opposed to your program), use</p>

<pre style="margin-left:11%; margin-top: 1em">        perl &minus;my_opts foo.pl arg1 arg2 arg3</pre>


<p style="margin-left:11%; margin-top: 1em">Alternately, if
you use OS/2&minus;ish shell, like <small>CMD</small> or
4os2, put the following at the start of your perl
script:</p>

<pre style="margin-left:11%; margin-top: 1em">        extproc perl &minus;S &minus;my_opts</pre>


<p style="margin-left:11%; margin-top: 1em">rename your
program to <i>foo.cmd</i>, and start it by typing</p>

<pre style="margin-left:11%; margin-top: 1em">        foo arg1 arg2 arg3</pre>


<p style="margin-left:11%; margin-top: 1em">Note that
because of stupid <small>OS/2</small> limitations the full
path of the perl script is not available when you use
<tt>&quot;extproc&quot;</tt>, thus you are forced to use
<tt>&quot;&minus;S&quot;</tt> perl switch, and your script
should be on the <tt>&quot;PATH&quot;</tt>. As a plus side,
if you know a full path to your script, you may still start
it with</p>

<pre style="margin-left:11%; margin-top: 1em">        perl ../../blah/foo.cmd arg1 arg2 arg3</pre>


<p style="margin-left:11%; margin-top: 1em">(note that the
argument <tt>&quot;&minus;my_opts&quot;</tt> is taken care
of by the <tt>&quot;extproc&quot;</tt> line in your script,
see &quot;<tt>&quot;extproc&quot;</tt> on the first
line&quot;).</p>

<p style="margin-left:11%; margin-top: 1em">To understand
what the above <i>magic</i> does, read perl docs about
<tt>&quot;&minus;S&quot;</tt> switch &minus; see perlrun,
and cmdref about <tt>&quot;extproc&quot;</tt>:</p>

<pre style="margin-left:11%; margin-top: 1em">        view perl perlrun
        man perlrun
        view cmdref extproc
        help extproc</pre>


<p style="margin-left:11%; margin-top: 1em">or whatever
method you prefer.</p>

<p style="margin-left:11%; margin-top: 1em">There are also
endless possibilities to use <i>executable extensions</i> of
4os2, <i>associations</i> of <small>WPS</small> and so on...
However, if you use *nixish shell (like <i>sh.exe</i>
supplied in the binary distribution), you need to follow the
syntax specified in &quot;Command Switches&quot; in
perlrun.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
<b>&minus;S</b> switch supports scripts with additional
extensions <i>.cmd</i>, <i>.btm</i>, <i>.bat</i>, <i>.pl</i>
as well.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Starting
<small>OS/2</small> (and <small>DOS</small> ) programs under
Perl</b> <br>
This is what <i>system()</i> (see &quot;system&quot; in
perlfunc), <tt>&quot;``&quot;</tt> (see &quot;I/O
Operators&quot; in perlop), and <i>open pipe</i> (see
&quot;open&quot; in perlfunc) are for. (Avoid <i>exec()</i>
(see &quot;exec&quot; in perlfunc) unless you know what you
do).</p>

<p style="margin-left:11%; margin-top: 1em">Note however
that to use some of these operators you need to have a
sh-syntax shell installed (see &quot;Pdksh&quot;,
&quot;Frequently asked questions&quot;), and perl should be
able to find it (see &quot; <small>PERL_SH_DIR</small>
&quot;).</p>

<p style="margin-left:11%; margin-top: 1em">The cases when
the shell is used are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">1.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">One-argument <i>system()</i>
(see &quot;system&quot; in perlfunc), <i>exec()</i> (see
&quot;exec&quot; in perlfunc) with redirection or shell
meta-characters;</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>2.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Pipe-open (see &quot;open&quot; in perlfunc) with the
command which contains redirection or shell
meta-characters;</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>3.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Backticks <tt>&quot;``&quot;</tt> (see &quot;I/O
Operators&quot; in perlop) with the command which contains
redirection or shell meta-characters;</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>4.</p></td>
<td width="3%"></td>
<td width="83%">


<p>If the executable called by
<i>system()</i>/<i>exec()</i>/pipe&minus;<i>open()</i>/<tt>&quot;``&quot;</tt>
is a script with the &quot;magic&quot;
<tt>&quot;#!&quot;</tt> line or <tt>&quot;extproc&quot;</tt>
line which specifies shell;</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>5.</p></td>
<td width="3%"></td>
<td width="83%">


<p>If the executable called by
<i>system()</i>/<i>exec()</i>/pipe&minus;<i>open()</i>/<tt>&quot;``&quot;</tt>
is a script without &quot;magic&quot; line, and
<tt>$ENV{EXECSHELL}</tt> is set to shell;</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>6.</p></td>
<td width="3%"></td>
<td width="83%">


<p>If the executable called by
<i>system()</i>/<i>exec()</i>/pipe&minus;<i>open()</i>/<tt>&quot;``&quot;</tt>
is not found (is not this remark obsolete?);</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>7.</p></td>
<td width="3%"></td>
<td width="83%">


<p>For globbing (see &quot;glob&quot; in perlfunc,
&quot;I/O Operators&quot; in perlop) (obsolete? Perl uses
builtin globbing nowadays...).</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">For the sake of
speed for a common case, in the above algorithms backslashes
in the command name are not considered as shell
metacharacters.</p>

<p style="margin-left:11%; margin-top: 1em">Perl starts
scripts which begin with cookies
<tt>&quot;extproc&quot;</tt> or <tt>&quot;#!&quot;</tt>
directly, without an intervention of shell. Perl uses the
same algorithm to find the executable as <i>pdksh</i>: if
the path on <tt>&quot;#!&quot;</tt> line does not work, and
contains <tt>&quot;/&quot;</tt>, then the directory part of
the executable is ignored, and the executable is searched in
<i>.</i> and on <tt>&quot;PATH&quot;</tt>. To find arguments
for these scripts Perl uses a different algorithm than
<i>pdksh</i>: up to 3 arguments are recognized, and trailing
whitespace is stripped.</p>

<p style="margin-left:11%; margin-top: 1em">If a script
does not contain such a cooky, then to avoid calling
<i>sh.exe</i>, Perl uses the same algorithm as <i>pdksh</i>:
if <tt>$ENV{EXECSHELL}</tt> is set, the script is given as
the first argument to this command, if not set, then
<tt>&quot;$ENV{COMSPEC} /c&quot;</tt> is used (or a
hardwired guess if <tt>$ENV{COMSPEC}</tt> is not set).</p>

<p style="margin-left:11%; margin-top: 1em">When starting
scripts directly, Perl uses exactly the same algorithm as
for the search of script given by <b>&minus;S</b>
command-line option: it will look in the current directory,
then on components of <tt>$ENV{PATH}</tt> using the
following order of appended extensions: no extension,
<i>.cmd</i>, <i>.btm</i>, <i>.bat</i>, <i>.pl</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Note that Perl
will start to look for scripts only if <small>OS/2</small>
cannot start the specified application, thus
<tt>&quot;system 'blah'&quot;</tt> will not look for a
script if there is an executable file <i>blah.exe
anywhere</i> on <tt>&quot;PATH&quot;</tt>. In other words,
<tt>&quot;PATH&quot;</tt> is essentially searched twice:
once by the <small>OS</small> for an executable, then by
Perl for scripts.</p>

<p style="margin-left:11%; margin-top: 1em">Note also that
executable files on <small>OS/2</small> can have an
arbitrary extension, but <i>.exe</i> will be automatically
appended if no dot is present in the name. The workaround is
as simple as that: since <i>blah.</i> and <i>blah</i> denote
the same file (at list on <small>FAT</small> and
<small>HPFS</small> file systems), to start an executable
residing in file <i>n:/bin/blah</i> (no extension) give an
argument <tt>&quot;n:/bin/blah.&quot;</tt> (dot appended) to
<i>system()</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Perl will start
<small>PM</small> programs from <small>VIO</small>
(=text&minus;mode) Perl process in a separate
<small>PM</small> session; the opposite is not true: when
you start a non-PM program from a <small>PM</small> Perl
process, Perl would not run it in a separate session. If a
separate session is desired, either ensure that shell will
be used, as in <tt>&quot;system 'cmd /c myprog'&quot;</tt>,
or start it using optional arguments to <i>system()</i>
documented in <tt>&quot;OS2::Process&quot;</tt> module. This
is considered to be a feature.</p>

<h2>Frequently asked questions
<a name="Frequently asked questions"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;It
does not work&quot;</b> <br>
Perl binary distributions come with a <i>testperl.cmd</i>
script which tries to detect common problems with
misconfigured installations. There is a pretty large chance
it will discover which step of the installation you managed
to goof. <tt>&quot;;&minus;)&quot;</tt></p>

<p style="margin-left:11%; margin-top: 1em"><b>I cannot run
external programs</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">Did you run your programs with
<tt>&quot;&minus;w&quot;</tt> switch? See &quot;Starting
<small>OS/2</small> (and <small>DOS</small> ) programs under
Perl&quot;.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Do you try to run <i>internal</i> shell commands, like
<tt>&quot;`copy a b`&quot;</tt> (internal for
<i>cmd.exe</i>), or <tt>&quot;`glob a*b`&quot;</tt>
(internal for ksh)? You need to specify your shell
explicitly, like <tt>&quot;`cmd /c copy a b`&quot;</tt>,
since Perl cannot deduce which commands are internal to your
shell.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>I cannot
embed perl into my program, or use</b> <i>perl.dll</i>
<b>from my program.</b> <br>
Is your program EMX-compiled with &quot;&minus;Zmt
&minus;Zcrtdll&quot;?</p>

<p style="margin-left:17%;">Well, nowadays Perl
<small>DLL</small> should be usable from a differently
compiled program too... If you can run Perl code from
<small>REXX</small> scripts (see <small>OS2::REXX</small> ),
then there are some other aspect of interaction which are
overlooked by the current hackish code to support
differently-compiled principal programs.</p>

<p style="margin-left:17%; margin-top: 1em">If everything
else fails, you need to build a stand-alone
<small>DLL</small> for perl. Contact me, I did it once.
Sockets would not work, as a lot of other stuff.</p>

<p style="margin-left:11%;">Did you use
ExtUtils::Embed?</p>

<p style="margin-left:17%;">Some time ago I had reports it
does not work. Nowadays it is checked in the Perl test
suite, so grep <i>./t</i> subdirectory of the build tree (as
well as <i>*.t</i> files in the <i>./lib</i> subdirectory)
to find how it should be done &quot;correctly&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;``&quot;
and pipe&minus;&quot;open&quot; do not work under
<small>DOS</small> .</b> <br>
This may a variant of just &quot;I cannot run external
programs&quot;, or a deeper problem. Basically: you
<i>need</i> <small>RSX</small> (see
&quot;Prerequisites&quot;) for these commands to work, and
you may need a port of <i>sh.exe</i> which understands
command arguments. One of such ports is listed in
&quot;Prerequisites&quot; under <small>RSX</small> . Do not
forget to set variable <tt>&quot;PERL_SH_DIR&quot;</tt> as
well.</p>


<p style="margin-left:11%; margin-top: 1em"><small>DPMI</small>
is required for <small>RSX</small> .</p>

<p style="margin-left:11%; margin-top: 1em"><b>Cannot start
&quot;find.exe &quot;pattern&quot; file&quot;</b> <br>
The whole idea of the &quot;standard C <small>API</small> to
start applications&quot; is that the forms
<tt>&quot;foo&quot;</tt> and <tt>&quot;foo&quot;</tt> of
program arguments are completely interchangeable.
<i>find</i> breaks this paradigm;</p>

<pre style="margin-left:11%; margin-top: 1em">  find &quot;pattern&quot; file
  find pattern file</pre>


<p style="margin-left:11%; margin-top: 1em">are not
equivalent; <i>find</i> cannot be started directly using the
above <small>API</small> . One needs a way to surround the
doublequotes in some other quoting construction, necessarily
having an extra non-Unixish shell in between.</p>

<p style="margin-left:11%; margin-top: 1em">Use one of</p>

<pre style="margin-left:11%; margin-top: 1em">  system 'cmd', '/c', 'find &quot;pattern&quot; file';
  `cmd /c 'find &quot;pattern&quot; file'`</pre>


<p style="margin-left:11%; margin-top: 1em">This would
start <i>find.exe</i> via <i>cmd.exe</i> via
<tt>&quot;sh.exe&quot;</tt> via
<tt>&quot;perl.exe&quot;</tt>, but this is a price to pay if
you want to use non-conforming program.</p>

<h2>INSTALLATION
<a name="INSTALLATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Automatic
binary installation</b> <br>
The most convenient way of installing a binary distribution
of perl is via perl installer <i>install.exe</i>. Just
follow the instructions, and 99% of the installation blues
would go away.</p>

<p style="margin-left:11%; margin-top: 1em">Note however,
that you need to have <i>unzip.exe</i> on your path, and
<small>EMX</small> environment <i>running</i>. The latter
means that if you just installed <small>EMX</small> , and
made all the needed changes to <i>Config.sys</i>, you may
need to reboot in between. Check <small>EMX</small> runtime
by running</p>

<pre style="margin-left:11%; margin-top: 1em">        emxrev</pre>


<p style="margin-left:11%; margin-top: 1em">Binary
installer also creates a folder on your desktop with some
useful objects. If you need to change some aspects of the
work of the binary installer, feel free to edit the file
<i>Perl.pkg</i>. This may be useful e.g., if you need to run
the installer many times and do not want to make many
interactive changes in the <small>GUI</small> .</p>

<p style="margin-left:11%; margin-top: 1em"><b>Things not
taken care of by automatic binary installation:</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="21%">


<p>&quot;PERL_BADLANG&quot;</p></td>
<td width="2%"></td>
<td width="66%">


<p>may be needed if you change your codepage <i>after</i>
perl installation, and the new value is not supported by
<small>EMX</small> . See &quot; <small>PERL_BADLANG</small>
&quot;.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="21%">


<p>&quot;PERL_BADFREE&quot;</p></td>
<td width="2%"></td>
<td width="66%">


<p>see &quot; <small>PERL_BADFREE</small> &quot;.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="21%">


<p><i>Config.pm</i></p></td>
<td width="2%"></td>
<td width="66%">


<p>This file resides somewhere deep in the location you
installed your perl library, find it out by</p></td></tr>
</table>

<pre style="margin-left:34%; margin-top: 1em">  perl &minus;MConfig &minus;le &quot;print $INC{'Config.pm'}&quot;</pre>


<p style="margin-left:34%; margin-top: 1em">While most
important values in this file <i>are</i> updated by the
binary installer, some of them may need to be hand-edited. I
know no such data, please keep me informed if you find one.
Moreover, manual changes to the installed version may need
to be accompanied by an edit of this file.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NOTE</small></b>
. Because of a typo the binary installer of 5.00305 would
install a variable <tt>&quot;PERL_SHPATH&quot;</tt> into
<i>Config.sys</i>. Please remove this variable and put
<tt>&quot;PERL_SH_DIR&quot;</tt> instead.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Manual
binary installation</b> <br>
As of version 5.00305, <small>OS/2</small> perl binary
distribution comes split into 11 components. Unfortunately,
to enable configurable binary installation, the file paths
in the zip files are not absolute, but relative to some
directory.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
extraction with the stored paths is still necessary (default
with unzip, specify <tt>&quot;&minus;d&quot;</tt> to
pkunzip). However, you need to know where to extract the
files. You need also to manually change entries in
<i>Config.sys</i> to reflect where did you put the files.
Note that if you have some primitive unzipper (like
<tt>&quot;pkunzip&quot;</tt>), you may get a lot of
warnings/errors during unzipping. Upgrade to
<tt>&quot;(w)unzip&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">Below is the
sample of what to do to reproduce the configuration on my
machine. In <i><small>VIEW</small> .EXE</i> you can press
<tt>&quot;Ctrl&minus;Insert&quot;</tt> now, and
cut-and-paste from the resulting file &minus; created in the
directory you started <i><small>VIEW</small> .EXE</i>
from.</p>

<p style="margin-left:11%; margin-top: 1em">For each
component, we mention environment variables related to each
installation directory. Either choose directories to match
your values of the variables, or create/append&minus;to
variables to take into account the directories. <br>
Perl <small>VIO</small> and <small>PM</small> executables
(dynamically linked)</p>

<pre style="margin-left:15%;">  unzip perl_exc.zip *.exe *.ico &minus;d f:/emx.add/bin
  unzip perl_exc.zip *.dll &minus;d f:/emx.add/dll</pre>


<p style="margin-left:15%; margin-top: 1em">(have the
directories with <tt>&quot;*.exe&quot;</tt> on
<small>PATH</small> , and <tt>&quot;*.dll&quot;</tt> on
<small>LIBPATH</small> );</p>

<p style="margin-left:11%;">Perl_ <small>VIO</small>
executable (statically linked)</p>

<pre style="margin-left:15%;">  unzip perl_aou.zip &minus;d f:/emx.add/bin</pre>


<p style="margin-left:15%; margin-top: 1em">(have the
directory on <small>PATH</small> );</p>

<p style="margin-left:11%;">Executables for Perl
utilities</p>

<pre style="margin-left:15%;">  unzip perl_utl.zip &minus;d f:/emx.add/bin</pre>


<p style="margin-left:15%; margin-top: 1em">(have the
directory on <small>PATH</small> );</p>

<p style="margin-left:11%;">Main Perl library</p>

<pre style="margin-left:15%;">  unzip perl_mlb.zip &minus;d f:/perllib/lib</pre>


<p style="margin-left:15%; margin-top: 1em">If this
directory is exactly the same as the prefix which was
compiled into <i>perl.exe</i>, you do not need to change
anything. However, for perl to find the library if you use a
different path, you need to <tt>&quot;set
PERLLIB_PREFIX&quot;</tt> in <i>Config.sys</i>, see &quot;
<small>PERLLIB_PREFIX</small> &quot;.</p>

<p style="margin-left:11%;">Additional Perl modules</p>

<pre style="margin-left:15%;">  unzip perl_ste.zip &minus;d f:/perllib/lib/site_perl/5.16.3/</pre>


<p style="margin-left:15%; margin-top: 1em">Same remark as
above applies. Additionally, if this directory is not one of
directories on <tt>@INC</tt> (and <tt>@INC</tt> is
influenced by <tt>&quot;PERLLIB_PREFIX&quot;</tt>), you need
to put this directory and subdirectory <i>./os2</i> in
<tt>&quot;PERLLIB&quot;</tt> or
<tt>&quot;PERL5LIB&quot;</tt> variable. Do not use
<tt>&quot;PERL5LIB&quot;</tt> unless you have it set
already. See &quot; <small>ENVIRONMENT</small> &quot; in
perl.</p>

<p style="margin-left:15%; margin-top: 1em"><b>[Check
whether this extraction directory is still applicable with
the new directory structure layout!]</b></p>

<p style="margin-left:11%;">Tools to compile Perl
modules</p>

<pre style="margin-left:15%;">  unzip perl_blb.zip &minus;d f:/perllib/lib</pre>


<p style="margin-left:15%; margin-top: 1em">Same remark as
for <i>perl_ste.zip</i>.</p>

<p style="margin-left:11%;">Manpages for Perl and
utilities</p>

<pre style="margin-left:15%;">  unzip perl_man.zip &minus;d f:/perllib/man</pre>


<p style="margin-left:15%; margin-top: 1em">This directory
should better be on <tt>&quot;MANPATH&quot;</tt>. You need
to have a working <i>man</i> to access these files.</p>

<p style="margin-left:11%;">Manpages for Perl modules</p>

<pre style="margin-left:15%;">  unzip perl_mam.zip &minus;d f:/perllib/man</pre>


<p style="margin-left:15%; margin-top: 1em">This directory
should better be on <tt>&quot;MANPATH&quot;</tt>. You need
to have a working man to access these files.</p>

<p style="margin-left:11%;">Source for Perl
documentation</p>

<pre style="margin-left:15%;">  unzip perl_pod.zip &minus;d f:/perllib/lib</pre>


<p style="margin-left:15%; margin-top: 1em">This is used by
the <tt>&quot;perldoc&quot;</tt> program (see perldoc), and
may be used to generate <small>HTML</small> documentation
usable by <small>WWW</small> browsers, and documentation in
zillions of other formats: <tt>&quot;info&quot;</tt>,
<tt>&quot;LaTeX&quot;</tt>, <tt>&quot;Acrobat&quot;</tt>,
<tt>&quot;FrameMaker&quot;</tt> and so on. [Use programs
such as <i>pod2latex</i> etc.]</p>

<p style="margin-left:11%;">Perl manual in <i>.INF</i>
format</p>

<pre style="margin-left:15%;">  unzip perl_inf.zip &minus;d d:/os2/book</pre>


<p style="margin-left:15%; margin-top: 1em">This directory
should better be on <tt>&quot;BOOKSHELF&quot;</tt>.</p>

<p style="margin-left:11%;">Pdksh</p>

<pre style="margin-left:15%;">  unzip perl_sh.zip &minus;d f:/bin</pre>


<p style="margin-left:15%; margin-top: 1em">This is used by
perl to run external commands which explicitly require
shell, like the commands using <i>redirection</i> and
<i>shell metacharacters</i>. It is also used instead of
explicit <i>/bin/sh</i>.</p>

<p style="margin-left:15%; margin-top: 1em">Set
<tt>&quot;PERL_SH_DIR&quot;</tt> (see &quot;
<small>PERL_SH_DIR</small> &quot;) if you move <i>sh.exe</i>
from the above location.</p>

<p style="margin-left:15%; margin-top: 1em"><b>Note.</b> It
may be possible to use some other sh-compatible shell
(untested).</p>

<p style="margin-left:11%; margin-top: 1em">After you
installed the components you needed and updated the
<i>Config.sys</i> correspondingly, you need to hand-edit
<i>Config.pm</i>. This file resides somewhere deep in the
location you installed your perl library, find it out by</p>

<pre style="margin-left:11%; margin-top: 1em">  perl &minus;MConfig &minus;le &quot;print $INC{'Config.pm'}&quot;</pre>


<p style="margin-left:11%; margin-top: 1em">You need to
correct all the entries which look like file paths (they
currently start with <tt>&quot;f:/&quot;</tt>).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Warning</b>
<br>
The automatic and manual perl installation leave precompiled
paths inside perl executables. While these paths are
overwriteable (see &quot; <small>PERLLIB_PREFIX</small>
&quot;, &quot; <small>PERL_SH_DIR</small> &quot;), some
people may prefer binary editing of paths inside the
executables/DLLs.</p>

<h2>Accessing documentation
<a name="Accessing documentation"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Depending on
how you built/installed perl you may have (otherwise
identical) Perl documentation in the following formats:</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>OS/2</small></b>
<i>.INF</i> <b>file</b> <br>
Most probably the most convenient form. Under
<small>OS/2</small> view it as</p>

<pre style="margin-left:11%; margin-top: 1em">  view perl
  view perl perlfunc
  view perl less
  view perl ExtUtils::MakeMaker</pre>


<p style="margin-left:11%; margin-top: 1em">(currently the
last two may hit a wrong location, but this may improve
soon). Under Win* see &quot; <small>SYNOPSIS</small>
&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">If you want to
build the docs yourself, and have <i><small>OS/2</small>
toolkit</i>, run</p>

<pre style="margin-left:11%; margin-top: 1em">        pod2ipf &gt; perl.ipf</pre>


<p style="margin-left:11%; margin-top: 1em">in
<i>/perllib/lib/pod</i> directory, then</p>

<pre style="margin-left:11%; margin-top: 1em">        ipfc /inf perl.ipf</pre>


<p style="margin-left:11%; margin-top: 1em">(Expect a lot
of errors during the both steps.) Now move it on your
<small>BOOKSHELF</small> path.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Plain
text</b> <br>
If you have perl documentation in the source form, perl
utilities installed, and <small>GNU</small> groff installed,
you may use</p>

<pre style="margin-left:11%; margin-top: 1em">        perldoc perlfunc
        perldoc less
        perldoc ExtUtils::MakeMaker</pre>


<p style="margin-left:11%; margin-top: 1em">to access the
perl documentation in the text form (note that you may get
better results using perl manpages).</p>

<p style="margin-left:11%; margin-top: 1em">Alternately,
try running pod2text on <i>.pod</i> files.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Manpages</b>
<br>
If you have <i>man</i> installed on your system, and you
installed perl manpages, use something like this:</p>

<pre style="margin-left:11%; margin-top: 1em">        man perlfunc
        man 3 less
        man ExtUtils.MakeMaker</pre>


<p style="margin-left:11%; margin-top: 1em">to access
documentation for different components of Perl. Start
with</p>

<pre style="margin-left:11%; margin-top: 1em">        man perl</pre>


<p style="margin-left:11%; margin-top: 1em">Note that dot
(<i>.</i>) is used as a package separator for documentation
for packages, and as usual, sometimes you need to give the
section &minus; <tt>3</tt> above &minus; to avoid shadowing
by the <i>less(1) manpage</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Make sure that
the directory <b>above</b> the directory with manpages is on
our <tt>&quot;MANPATH&quot;</tt>, like this</p>

<pre style="margin-left:11%; margin-top: 1em">  set MANPATH=c:/man;f:/perllib/man</pre>


<p style="margin-left:11%; margin-top: 1em">for Perl
manpages in <tt>&quot;f:/perllib/man/man1/&quot;</tt>
etc.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>HTML</small></b>
<br>
If you have some <small>WWW</small> browser available,
installed the Perl documentation in the source form, and
Perl utilities, you can build <small>HTML</small> docs. Cd
to directory with <i>.pod</i> files, and do like this</p>

<pre style="margin-left:11%; margin-top: 1em">        cd f:/perllib/lib/pod
        pod2html</pre>


<p style="margin-left:11%; margin-top: 1em">After this you
can direct your browser the file <i>perl.html</i> in this
directory, and go ahead with reading docs, like this:</p>

<pre style="margin-left:11%; margin-top: 1em">        explore file:///f:/perllib/lib/pod/perl.html</pre>


<p style="margin-left:11%; margin-top: 1em">Alternatively
you may be able to get these docs prebuilt from
<small>CPAN</small> .</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>GNU</small>
&quot;info&quot; files</b> <br>
Users of Emacs would appreciate it very much, especially
with <tt>&quot;CPerl&quot;</tt> mode loaded. You need to get
latest <tt>&quot;pod2texi&quot;</tt> from
<tt>&quot;CPAN&quot;</tt>, or, alternately, the prebuilt
info pages.</p>


<p style="margin-left:11%; margin-top: 1em"><i><small>PDF</small></i>
<b>files</b> <br>
for <tt>&quot;Acrobat&quot;</tt> are available on
<small>CPAN</small> (may be for slightly older version of
perl).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;LaTeX&quot;
docs</b> <br>
can be constructed using <tt>&quot;pod2latex&quot;</tt>.</p>

<h2>BUILD
<a name="BUILD"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Here we discuss
how to build Perl under <small>OS/2</small> .</p>

<p style="margin-left:11%; margin-top: 1em"><b>The short
story</b> <br>
Assume that you are a seasoned porter, so are sure that all
the necessary tools are already present on your system, and
you know how to get the Perl source distribution. Untar it,
change to the extract directory, and</p>

<pre style="margin-left:11%; margin-top: 1em">  gnupatch &minus;p0 &lt; os2\diff.configure
  sh Configure &minus;des &minus;D prefix=f:/perllib
  make
  make test
  make install
  make aout_test
  make aout_install</pre>


<p style="margin-left:11%; margin-top: 1em">This puts the
executables in f:/perllib/bin. Manually move them to the
<tt>&quot;PATH&quot;</tt>, manually move the built
<i>perl*.dll</i> to <tt>&quot;LIBPATH&quot;</tt> (here for
Perl <small>DLL</small> <i>*</i> is a not-very-meaningful
hex checksum), and run</p>

<pre style="margin-left:11%; margin-top: 1em">  make installcmd INSTALLCMDDIR=d:/ir/on/path</pre>


<p style="margin-left:11%; margin-top: 1em">Assuming that
the <tt>&quot;man&quot;</tt>&minus;files were put on an
appropriate location, this completes the installation of
minimal Perl system. (The binary distribution contains also
a lot of additional modules, and the documentation in
<small>INF</small> format.)</p>

<p style="margin-left:11%; margin-top: 1em">What follows is
a detailed guide through these steps.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Prerequisites</b>
<br>
You need to have the latest <small>EMX</small> development
environment, the full <small>GNU</small> tool suite (gawk
renamed to awk, and <small>GNU</small> <i>find.exe</i>
earlier on path than the <small>OS/2</small>
<i>find.exe</i>, same with <i>sort.exe</i>, to check use</p>

<pre style="margin-left:11%; margin-top: 1em">  find &minus;&minus;version
  sort &minus;&minus;version</pre>


<p style="margin-left:11%; margin-top: 1em">). You need the
latest version of <i>pdksh</i> installed as
<i>sh.exe</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Check that you
have <b><small>BSD</small></b> libraries and headers
installed, and &minus; optionally &minus; Berkeley
<small>DB</small> headers and libraries, and crypt.</p>

<p style="margin-left:11%; margin-top: 1em">Possible
locations to get the files:</p>

<pre style="margin-left:11%; margin-top: 1em">  ftp://ftp.uni&minus;heidelberg.de/pub/os2/unix/
  http://hobbes.nmsu.edu/h&minus;browse.php?dir=/pub/os2
  http://cd.textfiles.com/hobbesos29804/disk1/DEV32/
  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/</pre>


<p style="margin-left:11%; margin-top: 1em">It is reported
that the following archives contain enough utils to build
perl: <i>gnufutil.zip</i>, <i>gnusutil.zip</i>,
<i>gnututil.zip</i>, <i>gnused.zip</i>, <i>gnupatch.zip</i>,
<i>gnuawk.zip</i>, <i>gnumake.zip</i>, <i>gnugrep.zip</i>,
<i>bsddev.zip</i> and <i>ksh527rt.zip</i> (or a later
version). Note that all these utilities are known to be
available from <small>LEO:</small></p>

<pre style="margin-left:11%; margin-top: 1em">  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/</pre>


<p style="margin-left:11%; margin-top: 1em">Note also that
the <i>db.lib</i> and <i>db.a</i> from the
<small>EMX</small> distribution are not suitable for
multi-threaded compile (even single-threaded flavor of Perl
uses multi-threaded C <small>RTL</small> , for compatibility
with XFree86&minus;OS/2). Get a corrected one from</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.ilyaz.org/software/os2/db_mt.zip</pre>


<p style="margin-left:11%; margin-top: 1em">If you have
<i>exactly the same version of Perl</i> installed already,
make sure that no copies or perl are currently running.
Later steps of the build may fail since an older version of
<i>perl.dll</i> loaded into memory may be found. Running
<tt>&quot;make test&quot;</tt> becomes meaningless, since
the test are checking a previous build of perl (this
situation is detected and reported by <i>lib/os2_base.t</i>
test). Do not forget to unset
<tt>&quot;PERL_EMXLOAD_SEC&quot;</tt> in environment.</p>

<p style="margin-left:11%; margin-top: 1em">Also make sure
that you have <i>/tmp</i> directory on the current drive,
and <i>.</i> directory in your <tt>&quot;LIBPATH&quot;</tt>.
One may try to correct the latter condition by</p>

<pre style="margin-left:11%; margin-top: 1em">  set BEGINLIBPATH .\.</pre>


<p style="margin-left:11%; margin-top: 1em">if you use
something like <i><small>CMD</small> .EXE</i> or latest
versions of <i>4os2.exe</i>. (Setting
<small>BEGINLIBPATH</small> to just <tt>&quot;.&quot;</tt>
is ignored by the <small>OS/2</small> kernel.)</p>

<p style="margin-left:11%; margin-top: 1em">Make sure your
gcc is good for <tt>&quot;&minus;Zomf&quot;</tt> linking:
run <tt>&quot;omflibs&quot;</tt> script in <i>/emx/lib</i>
directory.</p>

<p style="margin-left:11%; margin-top: 1em">Check that you
have link386 installed. It comes standard with
<small>OS/2</small> , but may be not installed due to
customization. If typing</p>

<pre style="margin-left:11%; margin-top: 1em">  link386</pre>


<p style="margin-left:11%; margin-top: 1em">shows you do
not have it, do <i>Selective install</i>, and choose
<tt>&quot;Link object modules&quot;</tt> in <i>Optional
system utilities/More</i>. If you get into link386 prompts,
press <tt>&quot;Ctrl&minus;C&quot;</tt> to exit.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Getting perl
source</b> <br>
You need to fetch the latest perl source (including
developers releases). With some probability it is located
in</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.cpan.org/src/
  http://www.cpan.org/src/unsupported</pre>


<p style="margin-left:11%; margin-top: 1em">If not, you may
need to dig in the indices to find it in the directory of
the current maintainer.</p>

<p style="margin-left:11%; margin-top: 1em">Quick cycle of
developers release may break the <small>OS/2</small> build
time to time, looking into</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.cpan.org/ports/os2/</pre>


<p style="margin-left:11%; margin-top: 1em">may indicate
the latest release which was publicly released by the
maintainer. Note that the release may include some
additional patches to apply to the current source of
perl.</p>

<p style="margin-left:11%; margin-top: 1em">Extract it like
this</p>

<pre style="margin-left:11%; margin-top: 1em">  tar vzxf perl5.00409.tar.gz</pre>


<p style="margin-left:11%; margin-top: 1em">You may see a
message about errors while extracting <i>Configure</i>. This
is because there is a conflict with a similarly-named file
<i>configure</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Change to the
directory of extraction.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Application
of the patches</b> <br>
You need to apply the patches in <i>./os2/diff.*</i> like
this:</p>

<pre style="margin-left:11%; margin-top: 1em">  gnupatch &minus;p0 &lt; os2\diff.configure</pre>


<p style="margin-left:11%; margin-top: 1em">You may also
need to apply the patches supplied with the binary
distribution of perl. It also makes sense to look on the
perl5&minus;porters mailing list for the latest
OS/2&minus;related patches (see
http://www.xray.mpe.mpg.de/mailing&minus;lists/perl5&minus;porters/
&lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/&gt;).
Such patches usually contain strings
<tt>&quot;/os2/&quot;</tt> and <tt>&quot;patch&quot;</tt>,
so it makes sense looking for these strings.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Hand-editing</b>
<br>
You may look into the file <i>./hints/os2.sh</i> and correct
anything wrong you find there. I do not expect it is needed
anywhere.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Making</b></p>


<pre style="margin-left:11%;">  sh Configure &minus;des &minus;D prefix=f:/perllib</pre>



<p style="margin-left:11%; margin-top: 1em">&quot;prefix&quot;
means: where to install the resulting perl library. Giving
correct prefix you may avoid the need to specify
<tt>&quot;PERLLIB_PREFIX&quot;</tt>, see &quot;
<small>PERLLIB_PREFIX</small> &quot;.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Ignore the
message about missing &quot;ln&quot;, and about
&quot;&minus;c&quot; option to tr</i>. The latter is most
probably already fixed, if you see it and can trace where
the latter spurious warning comes from, please inform
me.</p>

<p style="margin-left:11%; margin-top: 1em">Now</p>
<pre style="margin-left:11%; margin-top: 1em">  make</pre>

<p style="margin-left:11%; margin-top: 1em">At some moment
the built may die, reporting a <i>version mismatch</i> or
<i>unable to run perl</i>. This means that you do not have
<i>.</i> in your <small>LIBPATH</small> , so <i>perl.exe</i>
cannot find the needed <i>perl67B2.dll</i> (treat these hex
digits as line noise). After this is fixed the build should
finish without a lot of fuss.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Testing</b>
<br>
Now run</p>

<pre style="margin-left:11%; margin-top: 1em">  make test</pre>


<p style="margin-left:11%; margin-top: 1em">All tests
should succeed (with some of them skipped). If you have the
same version of Perl installed, it is crucial that you have
<tt>&quot;.&quot;</tt> early in your <small>LIBPATH</small>
(or in <small>BEGINLIBPATH</small> ), otherwise your tests
will most probably test the wrong version of Perl.</p>

<p style="margin-left:11%; margin-top: 1em">Some tests may
generate extra messages similar to <br>
A lot of &quot;bad free&quot;</p>

<p style="margin-left:17%;">in database tests related to
Berkeley <small>DB</small> . <i>This should be fixed
already.</i> If it persists, you may disable this warnings,
see &quot; <small>PERL_BADFREE</small> &quot;.</p>

<p style="margin-left:11%;">Process terminated by
<small>SIGTERM/SIGINT</small></p>

<p style="margin-left:17%;">This is a standard message
issued by <small>OS/2</small> applications. *nix
applications die in silence. It is considered to be a
feature. One can easily disable this by appropriate
sighandlers.</p>

<p style="margin-left:17%; margin-top: 1em">However the
test engine bleeds these message to screen in unexpected
moments. Two messages of this kind <i>should</i> be present
during testing.</p>

<p style="margin-left:11%; margin-top: 1em">To get finer
test reports, call</p>

<pre style="margin-left:11%; margin-top: 1em">  perl t/harness</pre>


<p style="margin-left:11%; margin-top: 1em">The report with
<i>io/pipe.t</i> failing may look like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  Failed Test  Status Wstat Total Fail  Failed  List of failed
  &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;
  io/pipe.t                    12    1   8.33%  9
  7 tests skipped, plus 56 subtests skipped.
  Failed 1/195 test scripts, 99.49% okay. 1/6542 subtests failed, 99.98% okay.</pre>


<p style="margin-left:11%; margin-top: 1em">The reasons for
most important skipped tests are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="15%">


<p><i>op/fs.t</i></p></td>
<td width="3%"></td>
<td width="71%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="15%">


<p>18</p></td>
<td width="3%"></td>
<td width="71%">


<p>Checks <tt>&quot;atime&quot;</tt> and
<tt>&quot;mtime&quot;</tt> of <tt>&quot;stat()&quot;</tt>
&minus; unfortunately, <small>HPFS</small> provides only
2sec time granularity (for compatibility with
<small>FAT</small> ?).</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="15%">


<p>25</p></td>
<td width="3%"></td>
<td width="71%">


<p>Checks <tt>&quot;truncate()&quot;</tt> on a filehandle
just opened for write &minus; I do not know why this should
or should not work.</p></td></tr>
</table>

<p style="margin-left:11%;"><i>op/stat.t</i></p>

<p style="margin-left:23%;">Checks
<tt>&quot;stat()&quot;</tt>. Tests:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="23%"></td>
<td width="2%">


<p>4</p></td>
<td width="4%"></td>
<td width="71%">


<p>Checks <tt>&quot;atime&quot;</tt> and
<tt>&quot;mtime&quot;</tt> of <tt>&quot;stat()&quot;</tt>
&minus; unfortunately, <small>HPFS</small> provides only
2sec time granularity (for compatibility with
<small>FAT</small> ?).</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>Installing
the built perl</b> <br>
If you haven&rsquo;t yet moved
<tt>&quot;perl*.dll&quot;</tt> onto <small>LIBPATH</small> ,
do it now.</p>

<p style="margin-left:11%; margin-top: 1em">Run</p>

<pre style="margin-left:11%; margin-top: 1em">  make install</pre>


<p style="margin-left:11%; margin-top: 1em">It would put
the generated files into needed locations. Manually put
<i>perl.exe</i>, <i>perl__.exe</i> and <i>perl___.exe</i> to
a location on your <small>PATH</small> , <i>perl.dll</i> to
a location on your <small>LIBPATH</small> .</p>

<p style="margin-left:11%; margin-top: 1em">Run</p>

<pre style="margin-left:11%; margin-top: 1em">  make installcmd INSTALLCMDDIR=d:/ir/on/path</pre>


<p style="margin-left:11%; margin-top: 1em">to convert perl
utilities to <i>.cmd</i> files and put them on
<small>PATH</small> . You need to put
<i>.EXE</i>&minus;utilities on path manually. They are
installed in <tt>&quot;$prefix/bin&quot;</tt>, here
<tt>$prefix</tt> is what you gave to <i>Configure</i>, see
&quot;Making&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">If you use
<tt>&quot;man&quot;</tt>, either move the installed
<i>*/man/</i> directories to your
<tt>&quot;MANPATH&quot;</tt>, or modify
<tt>&quot;MANPATH&quot;</tt> to match the location. (One
could have avoided this by providing a correct
<tt>&quot;manpath&quot;</tt> option to <i>./Configure</i>,
or editing <i>./config.sh</i> between configuring and making
steps.)</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;a.out&quot;&minus;style
build</b> <br>
Proceed as above, but make <i>perl_.exe</i> (see
&quot;perl_.exe&quot;) by</p>

<pre style="margin-left:11%; margin-top: 1em">  make perl_</pre>


<p style="margin-left:11%; margin-top: 1em">test and
install by</p>

<pre style="margin-left:11%; margin-top: 1em">  make aout_test
  make aout_install</pre>


<p style="margin-left:11%; margin-top: 1em">Manually put
<i>perl_.exe</i> to a location on your <small>PATH</small>
.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note.</b>
The build process for <tt>&quot;perl_&quot;</tt> <i>does not
know</i> about all the dependencies, so you should make sure
that anything is up-to-date, say, by doing</p>

<pre style="margin-left:11%; margin-top: 1em">  make perl_dll</pre>


<p style="margin-left:11%; margin-top: 1em">first.</p>

<h2>Building a binary distribution
<a name="Building a binary distribution"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">[This section
provides a short overview only...]</p>

<p style="margin-left:11%; margin-top: 1em">Building should
proceed differently depending on whether the version of perl
you install is already present and used on your system, or
is a new version not yet used. The description below assumes
that the version is new, so installing its DLLs and
<i>.pm</i> files will not disrupt the operation of your
system even if some intermediate steps are not yet fully
working.</p>

<p style="margin-left:11%; margin-top: 1em">The other cases
require a little bit more convoluted procedures. Below I
suppose that the current version of Perl is <tt>5.8.2</tt>,
so the executables are named accordingly.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">1.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">Fully build and test the Perl
distribution. Make sure that no tests are failing with
<tt>&quot;test&quot;</tt> and <tt>&quot;aout_test&quot;</tt>
targets; fix the bugs in Perl and the Perl test suite
detected by these tests. Make sure that
<tt>&quot;all_test&quot;</tt> make target runs as clean as
possible. Check that <i>os2/perlrexx.cmd</i> runs fine.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>2.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Fully install Perl, including
<tt>&quot;installcmd&quot;</tt> target. Copy the generated
DLLs to <tt>&quot;LIBPATH&quot;</tt>; copy the numbered Perl
executables (as in <i>perl5.8.2.exe</i>) to
<tt>&quot;PATH&quot;</tt>; copy
<tt>&quot;perl_.exe&quot;</tt> to <tt>&quot;PATH&quot;</tt>
as <tt>&quot;perl_5.8.2.exe&quot;</tt>. Think whether you
need backward-compatibility DLLs. In most cases you do not
need to install them yet; but sometime this may simplify the
following steps.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>3.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Make sure that <tt>&quot;CPAN.pm&quot;</tt> can download
files from <small>CPAN</small> . If not, you may need to
manually install <tt>&quot;Net::FTP&quot;</tt>.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>4.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Install the bundle
<tt>&quot;Bundle::OS2_default&quot;</tt></p> </td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em"><tt>perl5.8.2
&minus;MCPAN &minus;e &quot;install
Bundle::OS2_default&quot; &lt; nul |&amp; tee
00cpan_i_1</tt></p>

<p style="margin-left:17%; margin-top: 1em">This may take a
couple of hours on 1GHz processor (when run the first time).
And this should not be necessarily a smooth procedure. Some
modules may not specify required dependencies, so one may
need to repeat this procedure several times until the
results stabilize.</p>

<pre style="margin-left:17%; margin-top: 1em">  perl5.8.2 &minus;MCPAN &minus;e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_2
  perl5.8.2 &minus;MCPAN &minus;e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_3</pre>


<p style="margin-left:17%; margin-top: 1em">Even after they
stabilize, some tests may fail.</p>

<p style="margin-left:17%; margin-top: 1em">Fix as many
discovered bugs as possible. Document all the bugs which are
not fixed, and all the failures with unknown reasons.
Inspect the produced logs <i>00cpan_i_1</i> to find
suspiciously skipped tests, and other fishy events.</p>

<p style="margin-left:17%; margin-top: 1em">Keep in mind
that <i>installation</i> of some modules may fail too: for
example, the DLLs to update may be already loaded by
<i><small>CPAN</small> .pm</i>. Inspect the
<tt>&quot;install&quot;</tt> logs (in the example above
<i>00cpan_i_1</i> etc) for errors, and install things
manually, as in</p>

<pre style="margin-left:17%; margin-top: 1em">  cd $CPANHOME/.cpan/build/Digest&minus;MD5&minus;2.31
  make install</pre>


<p style="margin-left:17%; margin-top: 1em">Some
distributions may fail some tests, but you may want to
install them anyway (as above, or via <tt>&quot;force
install&quot;</tt> command of <tt>&quot;CPAN.pm&quot;</tt>
shell-mode).</p>

<p style="margin-left:17%; margin-top: 1em">Since this
procedure may take quite a long time to complete, it makes
sense to &quot;freeze&quot; your <small>CPAN</small>
configuration by disabling periodic updates of the local
copy of <small>CPAN</small> index: set
<tt>&quot;index_expire&quot;</tt> to some big value (I use
365), then save the settings</p>

<pre style="margin-left:17%; margin-top: 1em">  CPAN&gt; o conf index_expire 365
  CPAN&gt; o conf commit</pre>


<p style="margin-left:17%; margin-top: 1em">Reset back to
the default value <tt>1</tt> when you are finished.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">5.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">When satisfied with the results,
rerun the <tt>&quot;installcmd&quot;</tt> target. Now you
can copy <tt>&quot;perl5.8.2.exe&quot;</tt> to
<tt>&quot;perl.exe&quot;</tt>, and install the other
OMF-build executables: <tt>&quot;perl__.exe&quot;</tt> etc.
They are ready to be used.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>6.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Change to the <tt>&quot;./pod&quot;</tt> directory of
the build tree, download the Perl logo
<i>CamelGrayBig.BMP</i>, and run</p></td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  ( perl2ipf &gt; perl.ipf ) |&amp; tee 00ipf
  ipfc /INF perl.ipf |&amp; tee 00inf</pre>


<p style="margin-left:17%; margin-top: 1em">This produces
the Perl docs online book <tt>&quot;perl.INF&quot;</tt>.
Install in on <tt>&quot;BOOKSHELF&quot;</tt> path.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">7.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">Now is the time to build
statically linked executable <i>perl_.exe</i> which includes
newly-installed via <tt>&quot;Bundle::OS2_default&quot;</tt>
modules. Doing testing via <tt>&quot;CPAN.pm&quot;</tt> is
going to be painfully slow, since it statically links a new
executable per <small>XS</small> extension.</p></td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">Here is a
possible workaround: create a toplevel <i>Makefile.PL</i> in
<i>$CPANHOME/.cpan/build/</i> with contents being (compare
with &quot;Making executables with a custom collection of
statically loaded extensions&quot;)</p>

<pre style="margin-left:17%; margin-top: 1em">  use ExtUtils::MakeMaker;
  WriteMakefile NAME =&gt; 'dummy';</pre>


<p style="margin-left:17%; margin-top: 1em">execute this
as</p>

<pre style="margin-left:17%; margin-top: 1em">  perl_5.8.2.exe Makefile.PL &lt;nul |&amp; tee 00aout_c1
  make &minus;k all test &lt;nul |&amp; 00aout_t1</pre>


<p style="margin-left:17%; margin-top: 1em">Again, this
procedure should not be absolutely smooth. Some
<tt>&quot;Makefile.PL&quot;</tt>&rsquo;s in subdirectories
may be buggy, and would not run as &quot;child&quot;
scripts. The interdependency of modules can strike you;
however, since non-XS modules are already installed, the
prerequisites of most modules have a very good chance to be
present.</p>

<p style="margin-left:17%; margin-top: 1em">If you discover
some glitches, move directories of problematic modules to a
different location; if these modules are non-XS modules, you
may just ignore them &minus; they are already installed; the
remaining, <small>XS</small> , modules you need to install
manually one by one.</p>

<p style="margin-left:17%; margin-top: 1em">After each such
removal you need to rerun the
<tt>&quot;Makefile.PL&quot;</tt>/<tt>&quot;make&quot;</tt>
process; usually this procedure converges soon. (But be sure
to convert all the necessary external C libraries from
<i>.lib</i> format to <i>.a</i> format: run one of</p>

<pre style="margin-left:17%; margin-top: 1em">  emxaout foo.lib
  emximp &minus;o foo.a foo.lib</pre>


<p style="margin-left:17%; margin-top: 1em">whichever is
appropriate.) Also, make sure that the DLLs for external
libraries are usable with with executables compiled without
<tt>&quot;&minus;Zmtd&quot;</tt> options.</p>

<p style="margin-left:17%; margin-top: 1em">When you are
sure that only a few subdirectories lead to failures, you
may want to add <tt>&quot;&minus;j4&quot;</tt> option to
<tt>&quot;make&quot;</tt> to speed up skipping
subdirectories with already finished build.</p>

<p style="margin-left:17%; margin-top: 1em">When you are
satisfied with the results of tests, install the build C
libraries for extensions:</p>

<pre style="margin-left:17%; margin-top: 1em">  make install |&amp; tee 00aout_i</pre>


<p style="margin-left:17%; margin-top: 1em">Now you can
rename the file <i>./perl.exe</i> generated during the last
phase to <i>perl_5.8.2.exe</i>; place it on
<tt>&quot;PATH&quot;</tt>; if there is an inter-dependency
between some <small>XS</small> modules, you may need to
repeat the
<tt>&quot;test&quot;</tt>/<tt>&quot;install&quot;</tt> loop
with this new executable and some excluded modules &minus;
until the procedure converges.</p>

<p style="margin-left:17%; margin-top: 1em">Now you have
all the necessary <i>.a</i> libraries for these Perl modules
in the places where Perl builder can find it. Use the perl
builder: change to an empty directory, create a
&quot;dummy&quot; <i>Makefile.PL</i> again, and run</p>

<pre style="margin-left:17%; margin-top: 1em">  perl_5.8.2.exe Makefile.PL |&amp; tee 00c
  make perl                  |&amp; tee 00p</pre>


<p style="margin-left:17%; margin-top: 1em">This should
create an executable <i>./perl.exe</i> with all the
statically loaded extensions built in. Compare the generated
<i>perlmain.c</i> files to make sure that during the
iterations the number of loaded extensions only increases.
Rename <i>./perl.exe</i> to <i>perl_5.8.2.exe</i> on
<tt>&quot;PATH&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">When it
converges, you got a functional variant of
<i>perl_5.8.2.exe</i>; copy it to
<tt>&quot;perl_.exe&quot;</tt>. You are done with generation
of the local Perl installation.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">8.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">Make sure that the installed
modules are actually installed in the location of the new
Perl, and are not inherited from entries of <tt>@INC</tt>
given for inheritance from the older versions of Perl: set
<tt>&quot;PERLLIB_582_PREFIX&quot;</tt> to redirect the new
version of Perl to a new location, and copy the installed
files to this new location. Redo the tests to make sure that
the versions of modules inherited from older versions of
Perl are not needed.</p></td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">Actually, the
log output of <i>pod2ipf</i>(1) during the step 6 gives a
very detailed info about which modules are loaded from which
place; so you may use it as an additional verification
tool.</p>

<p style="margin-left:17%; margin-top: 1em">Check that some
temporary files did not make into the perl install tree. Run
something like this</p>

<pre style="margin-left:17%; margin-top: 1em">  pfind . &minus;f &quot;!(/\.(pm|pl|ix|al|h|a|lib|txt|pod|imp|bs|dll|ld|bs|inc|xbm|yml|cgi|uu|e2x|skip|packlist|eg|cfg|html|pub|enc|all|ini|po|pot)$/i or /^\w+$/&quot;) | less</pre>


<p style="margin-left:17%; margin-top: 1em">in the install
tree (both top one and <i>sitelib</i> one).</p>

<p style="margin-left:17%; margin-top: 1em">Compress all
the DLLs with <i>lxlite</i>. The tiny <i>.exe</i> can be
compressed with <tt>&quot;/c:max&quot;</tt> (the bug only
appears when there is a fixup in the last 6 bytes of a page
(?); since the tiny executables are much smaller than a
page, the bug will not hit). Do not compress
<tt>&quot;perl_.exe&quot;</tt> &minus; it would not work
under <small>DOS</small> .</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">9.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">Now you can generate the binary
distribution. This is done by running the test of the
<small>CPAN</small> distribution
<tt>&quot;OS2::SoftInstaller&quot;</tt>. Tune up the file
<i>test.pl</i> to suit the layout of current version of Perl
first. Do not forget to pack the necessary external DLLs
accordingly. Include the description of the bugs and test
suite failures you could not fix. Include the small-stack
versions of Perl executables from Perl build directory.</p></td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">Include
<i>perl5.def</i> so that people can relink the perl
<small>DLL</small> preserving the binary compatibility, or
can create compatibility DLLs. Include the diff files
(<tt>&quot;diff &minus;pu old new&quot;</tt>) of fixes you
did so that people can rebuild your version. Include
<i>perl5.map</i> so that one can use remote debugging.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">10.</p></td>
<td width="2%"></td>
<td width="83%">


<p style="margin-top: 1em">Share what you did with the
other people. Relax. Enjoy fruits of your work.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p>11.</p></td>
<td width="2%"></td>
<td width="83%">


<p>Brace yourself for thanks, bug reports, hate mail and
spam coming as result of the previous step. No good deed
should remain unpunished!</p></td></tr>
</table>

<h2>Building custom .EXE files
<a name="Building custom .EXE files"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Perl
executables can be easily rebuilt at any moment. Moreover,
one can use the <i>embedding</i> interface (see perlembed)
to make very customized executables.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Making
executables with a custom collection of statically loaded
extensions</b> <br>
It is a little bit easier to do so while <i>decreasing</i>
the list of statically loaded extensions. We discuss this
case only here.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">1.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">Change to an empty directory,
and create a placeholder &lt;Makefile.PL&gt;:</p></td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  use ExtUtils::MakeMaker;
  WriteMakefile NAME =&gt; 'dummy';</pre>



<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">2.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">Run it with the flavor of Perl
(<i>perl.exe</i> or <i>perl_.exe</i>) you want to
rebuild.</p> </td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  perl_ Makefile.PL</pre>



<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">3.</p></td>
<td width="3%"></td>
<td width="57%">


<p style="margin-top: 1em">Ask it to create new Perl
executable:</p> </td>
<td width="26%">
</td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  make perl</pre>


<p style="margin-left:17%; margin-top: 1em">(you may need
to manually add
<tt>&quot;PERLTYPE=&minus;DPERL_CORE&quot;</tt> to this
commandline on some versions of Perl; the symptom is that
the command-line globbing does not work from
<small>OS/2</small> shells with the newly-compiled
executable; check with</p>

<pre style="margin-left:17%; margin-top: 1em">  .\perl.exe &minus;wle &quot;print for @ARGV&quot; *</pre>


<p style="margin-left:17%; margin-top: 1em">).</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">4.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">The previous step created
<i>perlmain.c</i> which contains a list of <i>newXS()</i>
calls near the end. Removing unnecessary calls, and
rerunning</p> </td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  make perl</pre>


<p style="margin-left:17%; margin-top: 1em">will produce a
customized executable.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Making
executables with a custom search-paths</b> <br>
The default perl executable is flexible enough to support
most usages. However, one may want something yet more
flexible; for example, one may want to find Perl
<small>DLL</small> relatively to the location of the
<small>EXE</small> file; or one may want to ignore the
environment when setting the Perl-library search patch,
etc.</p>

<p style="margin-left:11%; margin-top: 1em">If you fill
comfortable with <i>embedding</i> interface (see perlembed),
such things are easy to do repeating the steps outlined in
&quot;Making executables with a custom collection of
statically loaded extensions&quot;, and doing more
comprehensive edits to <i>main()</i> of <i>perlmain.c</i>.
The people with little desire to understand Perl can just
rename <i>main()</i>, and do necessary modification in a
custom <i>main()</i> which calls the renamed function in
appropriate time.</p>

<p style="margin-left:11%; margin-top: 1em">However, there
is a third way: perl <small>DLL</small> exports the
<i>main()</i> function and several callbacks to customize
the search path. Below is a complete example of a &quot;Perl
loader&quot; which</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">1.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">Looks for Perl
<small>DLL</small> in the directory
<tt>&quot;$exedir/../dll&quot;</tt>;</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>2.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Prepends the above directory to
<tt>&quot;BEGINLIBPATH&quot;</tt>;</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>3.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Fails if the Perl <small>DLL</small> found via
<tt>&quot;BEGINLIBPATH&quot;</tt> is different from what was
loaded on step 1; e.g., another process could have loaded it
from <tt>&quot;LIBPATH&quot;</tt> or from a different value
of <tt>&quot;BEGINLIBPATH&quot;</tt>. In these cases one
needs to modify the setting of the system so that this other
process either does not run, or loads the <small>DLL</small>
from <tt>&quot;BEGINLIBPATH&quot;</tt> with
<tt>&quot;LIBPATHSTRICT=T&quot;</tt> (available with kernels
after September 2000).</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>4.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Loads Perl library from
<tt>&quot;$exedir/../dll/lib/&quot;</tt>.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>5.</p></td>
<td width="3%"></td>
<td width="83%">


<p>Uses Bourne shell from
<tt>&quot;$exedir/../dll/sh/ksh.exe&quot;</tt>.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">For best
results compile the C file below with the same options as
the Perl <small>DLL</small> . However, a lot of
functionality will work even if the executable is not an
<small>EMX</small> applications, e.g., if compiled with</p>

<pre style="margin-left:11%; margin-top: 1em">  gcc &minus;Wall &minus;DDOSISH &minus;DOS2=1 &minus;O2 &minus;s &minus;Zomf &minus;Zsys perl&minus;starter.c &minus;DPERL_DLL_BASENAME=\&quot;perl312F\&quot; &minus;Zstack 8192 &minus;Zlinker /PM:VIO</pre>


<p style="margin-left:11%; margin-top: 1em">Here is the
sample C file:</p>

<pre style="margin-left:11%; margin-top: 1em">  #define INCL_DOS
  #define INCL_NOPM
  /* These are needed for compile if os2.h includes os2tk.h, not os2emx.h */
  #define INCL_DOSPROCESS
  #include &lt;os2.h&gt;
  #include &quot;EXTERN.h&quot;
  #define PERL_IN_MINIPERLMAIN_C
  #include &quot;perl.h&quot;
  static char *me;
  HMODULE handle;
  static void
  die_with(char *msg1, char *msg2, char *msg3, char *msg4)
  {
     ULONG c;
     char *s = &quot; error: &quot;;
     DosWrite(2, me, strlen(me), &amp;c);
     DosWrite(2, s, strlen(s), &amp;c);
     DosWrite(2, msg1, strlen(msg1), &amp;c);
     DosWrite(2, msg2, strlen(msg2), &amp;c);
     DosWrite(2, msg3, strlen(msg3), &amp;c);
     DosWrite(2, msg4, strlen(msg4), &amp;c);
     DosWrite(2, &quot;\r\n&quot;, 2, &amp;c);
     exit(255);
  }
  typedef ULONG (*fill_extLibpath_t)(int type, char *pre, char *post, int replace, char *msg);
  typedef int (*main_t)(int type, char *argv[], char *env[]);
  typedef int (*handler_t)(void* data, int which);
  #ifndef PERL_DLL_BASENAME
  #  define PERL_DLL_BASENAME &quot;perl&quot;
  #endif
  static HMODULE
  load_perl_dll(char *basename)
  {
      char buf[300], fail[260];
      STRLEN l, dirl;
      fill_extLibpath_t f;
      ULONG rc_fullname;
      HMODULE handle, handle1;
      if (_execname(buf, sizeof(buf) &minus; 13) != 0)
          die_with(&quot;Can't find full path: &quot;, strerror(errno), &quot;&quot;, &quot;&quot;);
      /* XXXX Fill 'me' with new value */
      l = strlen(buf);
      while (l &amp;&amp; buf[l&minus;1] != '/' &amp;&amp; buf[l&minus;1] != '\\')
          l&minus;&minus;;
      dirl = l &minus; 1;
      strcpy(buf + l, basename);
      l += strlen(basename);
      strcpy(buf + l, &quot;.dll&quot;);
      if ( (rc_fullname = DosLoadModule(fail, sizeof fail, buf, &amp;handle)) != 0
           &amp;&amp; DosLoadModule(fail, sizeof fail, basename, &amp;handle) != 0 )
          die_with(&quot;Can't load DLL &quot;, buf, &quot;&quot;, &quot;&quot;);
      if (rc_fullname)
          return handle;                /* was loaded with short name; all is fine */
      if (DosQueryProcAddr(handle, 0, &quot;fill_extLibpath&quot;, (PFN*)&amp;f))
          die_with(buf, &quot;: DLL exports no symbol &quot;, &quot;fill_extLibpath&quot;, &quot;&quot;);
      buf[dirl] = 0;
      if (f(0 /*BEGINLIBPATH*/, buf /* prepend */, NULL /* append */,
            0 /* keep old value */, me))
          die_with(me, &quot;: prepending BEGINLIBPATH&quot;, &quot;&quot;, &quot;&quot;);
      if (DosLoadModule(fail, sizeof fail, basename, &amp;handle1) != 0)
          die_with(me, &quot;: finding perl DLL again via BEGINLIBPATH&quot;, &quot;&quot;, &quot;&quot;);
      buf[dirl] = '\\';
      if (handle1 != handle) {
          if (DosQueryModuleName(handle1, sizeof(fail), fail))
              strcpy(fail, &quot;???&quot;);
          die_with(buf, &quot;:\n\tperl DLL via BEGINLIBPATH is different: \n\t&quot;,
                   fail,
                   &quot;\n\tYou may need to manipulate global BEGINLIBPATH and LIBPATHSTRICT&quot;
                   &quot;\n\tso that the other copy is loaded via BEGINLIBPATH.&quot;);
      }
      return handle;
  }
  int
  main(int argc, char **argv, char **env)
  {
      main_t f;
      handler_t h;
      me = argv[0];
      /**/
      handle = load_perl_dll(PERL_DLL_BASENAME);
      if (DosQueryProcAddr(handle, 0, &quot;Perl_OS2_handler_install&quot;, (PFN*)&amp;h))
          die_with(PERL_DLL_BASENAME, &quot;: DLL exports no symbol &quot;, &quot;Perl_OS2_handler_install&quot;, &quot;&quot;);
      if ( !h((void *)&quot;~installprefix&quot;, Perlos2_handler_perllib_from)
           || !h((void *)&quot;~dll&quot;, Perlos2_handler_perllib_to)
           || !h((void *)&quot;~dll/sh/ksh.exe&quot;, Perlos2_handler_perl_sh) )
          die_with(PERL_DLL_BASENAME, &quot;: Can't install @INC manglers&quot;, &quot;&quot;, &quot;&quot;);
      if (DosQueryProcAddr(handle, 0, &quot;dll_perlmain&quot;, (PFN*)&amp;f))
          die_with(PERL_DLL_BASENAME, &quot;: DLL exports no symbol &quot;, &quot;dll_perlmain&quot;, &quot;&quot;);
      return f(argc, argv, env);
  }</pre>


<h2>Build FAQ
<a name="Build FAQ"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Some
&quot;/&quot; became &quot;\&quot; in pdksh.</b> <br>
You have a very old pdksh. See
&quot;Prerequisites&quot;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>'errno'
&minus; unresolved external</b> <br>
You do not have MT-safe <i>db.lib</i>. See
&quot;Prerequisites&quot;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Problems
with tr or sed</b> <br>
reported with very old version of tr and sed.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Some problem
(forget which ;&minus;)</b> <br>
You have an older version of <i>perl.dll</i> on your
<small>LIBPATH</small> , which broke the build of
extensions.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Library ...
not found</b> <br>
You did not run <tt>&quot;omflibs&quot;</tt>. See
&quot;Prerequisites&quot;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Segfault in
make</b> <br>
You use an old version of <small>GNU</small> make. See
&quot;Prerequisites&quot;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>op/sprintf
test failure</b> <br>
This can result from a bug in emx sprintf which was fixed in
0.9d fix 03.</p>

<h2>Specific (mis)features of OS/2 port
<a name="Specific (mis)features of OS/2 port"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>&quot;setpriority&quot;,
&quot;getpriority&quot;</b> <br>
Note that these functions are compatible with *nix, not with
the older ports of &rsquo;94 &minus; 95. The priorities are
absolute, go from 32 to &minus;95, lower is quicker. 0 is
the default priority.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>WARNING</small></b>
. Calling <tt>&quot;getpriority&quot;</tt> on a non-existing
process could lock the system before Warp3 fixpak22.
Starting with Warp3, Perl will use a workaround: it aborts
<i>getpriority()</i> if the process is not present. This is
not possible on older versions <tt>&quot;2.*&quot;</tt>, and
has a race condition anyway.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;system()&quot;</b>
<br>
Multi-argument form of <tt>&quot;system()&quot;</tt> allows
an additional numeric argument. The meaning of this argument
is described in OS2::Process.</p>

<p style="margin-left:11%; margin-top: 1em">When finding a
program to run, Perl first asks the <small>OS</small> to
look for executables on <tt>&quot;PATH&quot;</tt> (
<small>OS/2</small> adds extension <i>.exe</i> if no
extension is present). If not found, it looks for a script
with possible extensions added in this order: no extension,
<i>.cmd</i>, <i>.btm</i>, <i>.bat</i>, <i>.pl</i>. If found,
Perl checks the start of the file for magic strings
<tt>&quot;#!&quot;</tt> and <tt>&quot;extproc &quot;</tt>.
If found, Perl uses the rest of the first line as the
beginning of the command line to run this script. The only
mangling done to the first line is extraction of arguments
(currently up to 3), and ignoring of the path-part of the
&quot;interpreter&quot; name if it can&rsquo;t be found
using the full path.</p>

<p style="margin-left:11%; margin-top: 1em">E.g.,
<tt>&quot;system 'foo', 'bar', 'baz'&quot;</tt> may lead
Perl to finding <i>C:/emx/bin/foo.cmd</i> with the first
line being</p>

<pre style="margin-left:11%; margin-top: 1em"> extproc /bin/bash    &minus;x   &minus;c</pre>


<p style="margin-left:11%; margin-top: 1em">If
<i>/bin/bash.exe</i> is not found, then Perl looks for an
executable <i>bash.exe</i> on <tt>&quot;PATH&quot;</tt>. If
found in <i>C:/emx.add/bin/bash.exe</i>, then the above
<i>system()</i> is translated to</p>

<pre style="margin-left:11%; margin-top: 1em">  system qw(C:/emx.add/bin/bash.exe &minus;x &minus;c C:/emx/bin/foo.cmd bar baz)</pre>


<p style="margin-left:11%; margin-top: 1em">One additional
translation is performed: instead of <i>/bin/sh</i> Perl
uses the hardwired-or-customized shell (see
<tt>&quot;PERL_SH_DIR&quot;</tt>).</p>

<p style="margin-left:11%; margin-top: 1em">The above
search for &quot;interpreter&quot; is recursive: if
<i>bash</i> executable is not found, but <i>bash.btm</i> is
found, Perl will investigate its first line etc. The only
hardwired limit on the recursion depth is implicit: there is
a limit 4 on the number of additional arguments inserted
before the actual arguments given to <i>system()</i>. In
particular, if no additional arguments are specified on the
&quot;magic&quot; first lines, then the limit on the depth
is 4.</p>

<p style="margin-left:11%; margin-top: 1em">If Perl finds
that the found executable is of <small>PM</small> type when
the current session is not, it will start the new process in
a separate session of necessary type. Call via
<tt>&quot;OS2::Process&quot;</tt> to disable this magic.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>WARNING</small></b>
. Due to the described logic, you need to explicitly specify
<i>.com</i> extension if needed. Moreover, if the executable
<i>perl5.6.1</i> is requested, Perl will not look for
<i>perl5.6.1.exe</i>. [This may change in the future.]</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;extproc&quot;
on the first line</b> <br>
If the first chars of a Perl script are <tt>&quot;extproc
&quot;</tt>, this line is treated as
<tt>&quot;#!&quot;</tt>&minus;line, thus all the switches on
this line are processed (twice if script was started via
cmd.exe). See &quot; <small>DESCRIPTION</small> &quot; in
perlrun.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Additional
modules:</b> <br>
OS2::Process, <small>OS2::DLL</small> ,
<small>OS2::REXX</small> , OS2::PrfDB, OS2::ExtAttr. These
modules provide access to additional numeric argument for
<tt>&quot;system&quot;</tt> and to the information about the
running process, to DLLs having functions with
<small>REXX</small> signature and to the <small>REXX</small>
runtime, to <small>OS/2</small> databases in the <i>.INI</i>
format, and to Extended Attributes.</p>

<p style="margin-left:11%; margin-top: 1em">Two additional
extensions by Andreas Kaiser, <tt>&quot;OS2::UPM&quot;</tt>,
and <tt>&quot;OS2::FTP&quot;</tt>, are included into
<tt>&quot;ILYAZ&quot;</tt> directory, mirrored on
<small>CPAN</small> . Other OS/2&minus;related extensions
are available too.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Prebuilt
methods:</b> <br>
&quot;File::Copy::syscopy&quot;</p>

<p style="margin-left:17%;">used by
<tt>&quot;File::Copy::copy&quot;</tt>, see File::Copy.</p>


<p style="margin-left:11%;">&quot;DynaLoader::mod2fname&quot;</p>

<p style="margin-left:17%;">used by
<tt>&quot;DynaLoader&quot;</tt> for <small>DLL</small> name
mangling.</p>


<p style="margin-left:11%;">&quot;Cwd::current_drive()&quot;</p>

<p style="margin-left:17%;">Self explanatory.</p>


<p style="margin-left:11%;">&quot;Cwd::sys_chdir(name)&quot;</p>

<p style="margin-left:17%;">leaves drive as it is.</p>


<p style="margin-left:11%;">&quot;Cwd::change_drive(name)&quot;</p>

<p style="margin-left:17%;">changes the &quot;current&quot;
drive.</p>


<p style="margin-left:11%;">&quot;Cwd::sys_is_absolute(name)&quot;</p>

<p style="margin-left:17%;">means has drive letter and
is_rooted.</p>


<p style="margin-left:11%;">&quot;Cwd::sys_is_rooted(name)&quot;</p>

<p style="margin-left:17%;">means has leading
<tt>&quot;[/\\]&quot;</tt> (maybe after a
drive-letter:).</p>


<p style="margin-left:11%;">&quot;Cwd::sys_is_relative(name)&quot;</p>

<p style="margin-left:17%;">means changes with current
dir.</p>


<p style="margin-left:11%;">&quot;Cwd::sys_cwd(name)&quot;</p>

<p style="margin-left:17%;">Interface to cwd from
<small>EMX</small> . Used by
<tt>&quot;Cwd::cwd&quot;</tt>.</p>

<p style="margin-left:11%;">&quot;Cwd::sys_abspath(name,
dir)&quot;</p>

<p style="margin-left:17%;">Really really odious function
to implement. Returns absolute name of file which would have
<tt>&quot;name&quot;</tt> if <small>CWD</small> were
<tt>&quot;dir&quot;</tt>. <tt>&quot;Dir&quot;</tt> defaults
to the current dir.</p>


<p style="margin-left:11%;">&quot;Cwd::extLibpath([type])&quot;</p>

<p style="margin-left:17%;">Get current value of extended
library search path. If <tt>&quot;type&quot;</tt> is present
and positive, works with <tt>&quot;END_LIBPATH&quot;</tt>,
if negative, works with <tt>&quot;LIBPATHSTRICT&quot;</tt>,
otherwise with <tt>&quot;BEGIN_LIBPATH&quot;</tt>.</p>

<p style="margin-left:11%;">&quot;Cwd::extLibpath_set( path
[, type ] )&quot;</p>

<p style="margin-left:17%;">Set current value of extended
library search path. If <tt>&quot;type&quot;</tt> is present
and positive, works with &lt; <small>END_LIBPATH</small>
&gt;, if negative, works with
<tt>&quot;LIBPATHSTRICT&quot;</tt>, otherwise with
<tt>&quot;BEGIN_LIBPATH&quot;</tt>.</p>


<p style="margin-left:11%;">&quot;OS2::Error(do_harderror,do_exception)&quot;</p>

<p style="margin-left:17%;">Returns
<tt>&quot;undef&quot;</tt> if it was not called yet,
otherwise bit 1 is set if on the previous call do_harderror
was enabled, bit 2 is set if on previous call do_exception
was enabled.</p>

<p style="margin-left:17%; margin-top: 1em">This function
enables/disables error popups associated with hardware
errors (Disk not ready etc.) and software exceptions.</p>

<p style="margin-left:17%; margin-top: 1em">I know of no
way to find out the state of popups <i>before</i> the first
call to this function.</p>


<p style="margin-left:11%;">&quot;OS2::Errors2Drive(drive)&quot;</p>

<p style="margin-left:17%;">Returns
<tt>&quot;undef&quot;</tt> if it was not called yet,
otherwise return false if errors were not requested to be
written to a hard drive, or the drive letter if this was
requested.</p>

<p style="margin-left:17%; margin-top: 1em">This function
may redirect error popups associated with hardware errors
(Disk not ready etc.) and software exceptions to the file
<small>POPUPLOG</small> .OS2 at the root directory of the
specified drive. Overrides <i>OS2::Error()</i> specified by
individual programs. Given argument undef will disable
redirection.</p>

<p style="margin-left:17%; margin-top: 1em">Has global
effect, persists after the application exits.</p>

<p style="margin-left:17%; margin-top: 1em">I know of no
way to find out the state of redirection of popups to the
disk <i>before</i> the first call to this function.</p>

<p style="margin-left:11%;"><i>OS2::SysInfo()</i></p>

<p style="margin-left:17%;">Returns a hash with system
information. The keys of the hash are</p>

<pre style="margin-left:17%; margin-top: 1em">        MAX_PATH_LENGTH, MAX_TEXT_SESSIONS, MAX_PM_SESSIONS,
        MAX_VDM_SESSIONS, BOOT_DRIVE, DYN_PRI_VARIATION,
        MAX_WAIT, MIN_SLICE, MAX_SLICE, PAGE_SIZE,
        VERSION_MAJOR, VERSION_MINOR, VERSION_REVISION,
        MS_COUNT, TIME_LOW, TIME_HIGH, TOTPHYSMEM, TOTRESMEM,
        TOTAVAILMEM, MAXPRMEM, MAXSHMEM, TIMER_INTERVAL,
        MAX_COMP_LENGTH, FOREGROUND_FS_SESSION,
        FOREGROUND_PROCESS</pre>


<p style="margin-left:11%;"><i>OS2::BootDrive()</i></p>

<p style="margin-left:17%;">Returns a letter without
colon.</p>


<p style="margin-left:11%;">&quot;OS2::MorphPM(serve)&quot;,
&quot;OS2::UnMorphPM(serve)&quot;</p>

<p style="margin-left:17%;">Transforms the current
application into a <small>PM</small> application and back.
The argument true means that a real message loop is going to
be served. <i>OS2::MorphPM()</i> returns the
<small>PM</small> message queue handle as an integer.</p>

<p style="margin-left:17%; margin-top: 1em">See
&quot;Centralized management of resources&quot; for
additional details.</p>


<p style="margin-left:11%;">&quot;OS2::Serve_Messages(force)&quot;</p>

<p style="margin-left:17%;">Fake on-demand retrieval of
outstanding <small>PM</small> messages. If
<tt>&quot;force&quot;</tt> is false, will not dispatch
messages if a real message loop is known to be present.
Returns number of messages retrieved.</p>

<p style="margin-left:17%; margin-top: 1em">Dies with
&quot;QUITing...&quot; if <small>WM_QUIT</small> message is
obtained.</p>


<p style="margin-left:11%;">&quot;OS2::Process_Messages(force
[, cnt])&quot;</p>

<p style="margin-left:17%;">Retrieval of <small>PM</small>
messages until window creation/destruction. If
<tt>&quot;force&quot;</tt> is false, will not dispatch
messages if a real message loop is known to be present.</p>

<p style="margin-left:17%; margin-top: 1em">Returns change
in number of windows. If <tt>&quot;cnt&quot;</tt> is given,
it is incremented by the number of messages retrieved.</p>

<p style="margin-left:17%; margin-top: 1em">Dies with
&quot;QUITing...&quot; if <small>WM_QUIT</small> message is
obtained.</p>


<p style="margin-left:11%;">&quot;OS2::_control87(new,mask)&quot;</p>

<p style="margin-left:17%;">the same as
<i>_control87</i>(3) of <small>EMX</small> . Takes integers
as arguments, returns the previous coprocessor control word
as an integer. Only bits in <tt>&quot;new&quot;</tt> which
are present in <tt>&quot;mask&quot;</tt> are changed in the
control word.</p>


<p style="margin-left:11%;"><i>OS2::get_control87()</i></p>

<p style="margin-left:17%;">gets the coprocessor control
word as an integer.</p>


<p style="margin-left:11%;">&quot;OS2::set_control87_em(new=MCW_EM,mask=MCW_EM)&quot;</p>

<p style="margin-left:17%;">The variant of
<i>OS2::_control87()</i> with default values good for
handling exception mask: if no <tt>&quot;mask&quot;</tt>,
uses exception mask part of <tt>&quot;new&quot;</tt> only.
If no <tt>&quot;new&quot;</tt>, disables all the floating
point exceptions.</p>

<p style="margin-left:17%; margin-top: 1em">See
&quot;Misfeatures&quot; for details.</p>

<p style="margin-left:11%;">&quot;OS2::DLLname([how [,
\&amp;xsub]])&quot;</p>

<p style="margin-left:17%;">Gives the information about the
Perl <small>DLL</small> or the <small>DLL</small> containing
the C function bound to by <tt>&amp;xsub</tt>. The meaning
of <tt>&quot;how&quot;</tt> is: default (2): full name; 0:
handle; 1: module name.</p>

<p style="margin-left:11%; margin-top: 1em">(Note that some
of these may be moved to different libraries &minus;
eventually).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Prebuilt
variables:</b> <br>
$OS2::emx_rev</p>

<p style="margin-left:17%;">numeric value is the same as
_emx_rev of <small>EMX</small> , a string value the same as
_emx_vprt (similar to <tt>&quot;0.9c&quot;</tt>).</p>

<p style="margin-left:11%;">$OS2::emx_env</p>

<p style="margin-left:17%;">same as _emx_env of
<small>EMX</small> , a number similar to 0x8001.</p>

<p style="margin-left:11%;">$OS2::os_ver</p>

<p style="margin-left:17%;">a number <tt>&quot;OS_MAJOR +
0.001 * OS_MINOR&quot;</tt>.</p>

<p style="margin-left:11%;">$OS2::is_aout</p>

<p style="margin-left:17%;">true if the Perl library was
compiled in <small>AOUT</small> format.</p>

<p style="margin-left:11%;">$OS2::can_fork</p>

<p style="margin-left:17%;">true if the current executable
is an <small>AOUT EMX</small> executable, so Perl can fork.
Do not use this, use the portable check for
<tt>$Config::Config</tt>{dfork}.</p>

<p style="margin-left:11%;">$OS2::nsyserror</p>

<p style="margin-left:17%;">This variable (default is 1)
controls whether to enforce the contents of $^E to start
with <tt>&quot;SYS0003&quot;</tt>&minus;like id. If set to
0, then the string value of $^E is what is available from
the <small>OS/2</small> message file. (Some messages in this
file have an <tt>&quot;SYS0003&quot;</tt>&minus;like id
prepended, some not.)</p>


<p style="margin-left:11%; margin-top: 1em"><b>Misfeatures</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Since <i>flock</i>(3) is present in <small>EMX</small> ,
but is not functional, it is emulated by perl. To disable
the emulations, set environment variable
<tt>&quot;USE_PERL_FLOCK=0&quot;</tt>.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Here is the list of things which may be
&quot;broken&quot; on <small>EMX</small> (from
<small>EMX</small> docs):</p></td></tr>
</table>

<p style="margin-left:17%;">&bull;</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%"></td>
<td width="5%"></td>
<td width="77%">


<p style="margin-top: 1em">The functions <i>recvmsg</i>(3),
<i>sendmsg</i>(3), and <i>socketpair</i>(3) are not
implemented.</p> </td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p><i>sock_init</i>(3) is not required and not
implemented.</p> </td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p><i>flock</i>(3) is not yet implemented (dummy function).
(Perl has a workaround.)</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p><i>kill</i>(3): Special treatment of PID=0, PID=1 and
PID=&minus;1 is not implemented.</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p><i>waitpid</i>(3):</p></td></tr>
</table>

<pre style="margin-left:23%; margin-top: 1em">      WUNTRACED
              Not implemented.
      waitpid() is not implemented for negative values of PID.</pre>


<p style="margin-left:17%; margin-top: 1em">Note that
<tt>&quot;kill &minus;9&quot;</tt> does not work with the
current version of <small>EMX</small> .</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">See &quot;Text-mode
filehandles&quot;.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Unix-domain sockets on <small>OS/2</small> live in a
pseudo-file-system <tt>&quot;/sockets/...&quot;</tt>. To
avoid a failure to create a socket with a name of a
different form, <tt>&quot;/socket/&quot;</tt> is prepended
to the socket name (unless it starts with this already).</p></td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">This may lead
to problems later in case the socket is accessed via the
&quot;usual&quot; file-system calls using the
&quot;initial&quot; name.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">Apparently, <small>IBM</small>
used a compiler (for some period of time around &rsquo;95?)
which changes <small>FP</small> mask right and left. This is
not <i>that</i> bad for <small>IBM</small> &rsquo;s
programs, but the same compiler was used for DLLs which are
used with general-purpose applications. When these DLLs are
used, the state of floating-point flags in the application
is not predictable.</p></td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">What is much
worse, some DLLs change the floating point flags when in
<i>_DLLInitTerm()</i> (e.g., <i><small>TCP32IP</small></i>
). This means that even if you do not <i>call</i> any
function in the <small>DLL</small> , just the act of loading
this <small>DLL</small> will reset your flags. What is
worse, the same compiler was used to compile some
<small>HOOK</small> DLLs. Given that <small>HOOK</small>
dlls are executed in the context of <i>all</i> the
applications in the system, this means a complete
unpredictability of floating point flags on systems using
such <small>HOOK</small> DLLs. E.g.,
<i><small>GAMESRVR</small> .DLL</i> of
<b><small>DIVE</small></b> origin changes the floating point
flags on each write to the <small>TTY</small> of a
<small>VIO</small> (windowed text-mode) applications.</p>

<p style="margin-left:17%; margin-top: 1em">Some other (not
completely debugged) situations when <small>FP</small> flags
change include some video drivers (?), and some operations
related to creation of the windows. People who code
<b>OpenGL</b> may have more experience on this.</p>

<p style="margin-left:17%; margin-top: 1em">Perl is
generally used in the situation when all the floating-point
exceptions are ignored, as is the default under
<small>EMX</small> . If they are not ignored, some benign
Perl programs would get a <tt>&quot;SIGFPE&quot;</tt> and
would die a horrible death.</p>

<p style="margin-left:17%; margin-top: 1em">To circumvent
this, Perl uses two hacks. They help against <i>one</i> type
of damage only: <small>FP</small> flags changed when loading
a <small>DLL</small> .</p>

<p style="margin-left:17%; margin-top: 1em">One of the
hacks is to disable floating point exceptions on Perl
startup (as is the default with <small>EMX</small> ). This
helps only with compile-time-linked DLLs changing the flags
before <i>main()</i> had a chance to be called.</p>

<p style="margin-left:17%; margin-top: 1em">The other hack
is to restore <small>FP</small> flags after a call to
<i>dlopen()</i>. This helps against similar damage done by
DLLs <i>_DLLInitTerm()</i> at runtime. Currently no way to
switch these hacks off is provided.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Modifications</b>
<br>
Perl modifies some standard C library calls in the following
ways:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="12%">


<p style="margin-top: 1em">&quot;popen&quot;</p></td>
<td width="2%"></td>
<td width="75%">


<p style="margin-top: 1em"><tt>&quot;my_popen&quot;</tt>
uses <i>sh.exe</i> if shell is required, cf. &quot;
<small>PERL_SH_DIR</small> &quot;.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="12%">


<p>&quot;tmpnam&quot;</p></td>
<td width="2%"></td>
<td width="75%">


<p>is created using <tt>&quot;TMP&quot;</tt> or
<tt>&quot;TEMP&quot;</tt> environment variable, via
<tt>&quot;tempnam&quot;</tt>.</p> </td></tr>
</table>

<p style="margin-left:11%;">&quot;tmpfile&quot;</p>

<p style="margin-left:25%;">If the current directory is not
writable, file is created using modified
<tt>&quot;tmpnam&quot;</tt>, so there may be a race
condition.</p>

<p style="margin-left:11%;">&quot;ctermid&quot;</p>

<p style="margin-left:25%;">a dummy implementation.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p>&quot;stat&quot;</p></td>
<td width="5%"></td>
<td width="72%">


<p><tt>&quot;os2_stat&quot;</tt> special-cases
<i>/dev/tty</i> and <i>/dev/con</i>.</p></td>
<td width="3%">
</td></tr>
</table>

<p style="margin-left:11%;">&quot;mkdir&quot;,
&quot;rmdir&quot;</p>

<p style="margin-left:25%;">these <small>EMX</small>
functions do not work if the path contains a trailing
<tt>&quot;/&quot;</tt>. Perl contains a workaround for
this.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="11%">


<p>&quot;flock&quot;</p></td>
<td width="3%"></td>
<td width="75%">


<p>Since <i>flock</i>(3) is present in <small>EMX</small> ,
but is not functional, it is emulated by perl. To disable
the emulations, set environment variable
<tt>&quot;USE_PERL_FLOCK=0&quot;</tt>.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>Identifying
DLLs</b> <br>
All the DLLs built with the current versions of Perl have
<small>ID</small> strings identifying the name of the
extension, its version, and the version of Perl required for
this <small>DLL</small> . Run <tt>&quot;bldlevel
DLL&minus;name&quot;</tt> to find this info.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Centralized
management of resources</b> <br>
Since to call certain <small>OS/2 API</small> one needs to
have a correctly initialized <tt>&quot;Win&quot;</tt>
subsystem, OS/2&minus;specific extensions may require
getting <tt>&quot;HAB&quot;</tt>s and
<tt>&quot;HMQ&quot;</tt>s. If an extension would do it on
its own, another extension could fail to initialize.</p>

<p style="margin-left:11%; margin-top: 1em">Perl provides a
centralized management of these resources: <br>
&quot;HAB&quot;</p>

<p style="margin-left:17%;">To get the <small>HAB</small> ,
the extension should call <tt>&quot;hab =
perl_hab_GET()&quot;</tt> in C. After this call is
performed, <tt>&quot;hab&quot;</tt> may be accessed as
<tt>&quot;Perl_hab&quot;</tt>. There is no need to release
the <small>HAB</small> after it is used.</p>

<p style="margin-left:17%; margin-top: 1em">If by some
reasons <i>perl.h</i> cannot be included, use</p>

<pre style="margin-left:17%; margin-top: 1em">  extern int Perl_hab_GET(void);</pre>


<p style="margin-left:17%; margin-top: 1em">instead.</p>

<p style="margin-left:11%;">&quot;HMQ&quot;</p>

<p style="margin-left:17%;">There are two cases:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p>the extension needs an <tt>&quot;HMQ&quot;</tt> only
because some <small>API</small> will not work otherwise. Use
<tt>&quot;serve = 0&quot;</tt> below.</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p>the extension needs an <tt>&quot;HMQ&quot;</tt> since it
wants to engage in a <small>PM</small> event loop. Use
<tt>&quot;serve = 1&quot;</tt> below.</p></td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">To get an
<tt>&quot;HMQ&quot;</tt>, the extension should call
<tt>&quot;hmq = perl_hmq_GET(serve)&quot;</tt> in C. After
this call is performed, <tt>&quot;hmq&quot;</tt> may be
accessed as <tt>&quot;Perl_hmq&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">To signal to
Perl that <small>HMQ</small> is not needed any more, call
<tt>&quot;perl_hmq_UNSET(serve)&quot;</tt>. Perl process
will automatically morph/unmorph itself into/from a
<small>PM</small> process if <small>HMQ</small> is
needed/not&minus;needed. Perl will automatically
enable/disable <tt>&quot;WM_QUIT&quot;</tt> message during
shutdown if the message queue is
served/not&minus;served.</p>


<p style="margin-left:17%; margin-top: 1em"><b><small>NOTE</small></b>
. If during a shutdown there is a message queue which did
not disable <small>WM_QUIT</small> , and which did not
process the received <small>WM_QUIT</small> message, the
shutdown will be automatically cancelled. Do not call
<tt>perl_hmq_GET(1)</tt> unless you are going to process
messages on an orderly basis.</p>

<p style="margin-left:11%;">Treating errors reported by
<small>OS/2 API</small></p>

<p style="margin-left:17%;">There are two principal
conventions (it is useful to call them
<tt>&quot;Dos*&quot;</tt> and <tt>&quot;Win*&quot;</tt>
&minus; though this part of the function signature is not
always determined by the name of the <small>API</small> ) of
reporting the error conditions of <small>OS/2 API</small> .
Most of <tt>&quot;Dos*&quot;</tt> APIs report the error code
as the result of the call (so 0 means success, and there are
many types of errors). Most of <tt>&quot;Win*&quot;</tt>
<small>API</small> report success/fail via the result being
<tt>&quot;TRUE&quot;</tt>/<tt>&quot;FALSE&quot;</tt>; to
find the reason for the failure one should call
<i>WinGetLastError()</i> <small>API</small> .</p>

<p style="margin-left:17%; margin-top: 1em">Some
<tt>&quot;Win*&quot;</tt> entry points also overload a
&quot;meaningful&quot; return value with the error
indicator; having a 0 return value indicates an error. Yet
some other <tt>&quot;Win*&quot;</tt> entry points overload
things even more, and 0 return value may mean a successful
call returning a valid value 0, as well as an error
condition; in the case of a 0 return value one should call
<i>WinGetLastError()</i> <small>API</small> to distinguish a
successful call from a failing one.</p>

<p style="margin-left:17%; margin-top: 1em">By convention,
all the calls to <small>OS/2 API</small> should indicate
their failures by resetting $^E. All the Perl-accessible
functions which call <small>OS/2 API</small> may be broken
into two classes: some <i>die()</i>s when an
<small>API</small> error is encountered, the other report
the error via a false return value (of course, this does not
concern Perl-accessible functions which <i>expect</i> a
failure of the <small>OS/2 API</small> call, having some
workarounds coded).</p>

<p style="margin-left:17%; margin-top: 1em">Obviously, in
the situation of the last type of the signature of an
<small>OS/2 API</small> , it is must more convenient for the
users if the failure is indicated by <i>die()</i>ing: one
does not need to check $^E to know that something went
wrong. If, however, this solution is not desirable by some
reason, the code in question should reset $^E to 0 before
making this <small>OS/2 API</small> call, so that the caller
of this Perl-accessible function has a chance to distinguish
a success&minus;but&minus;0&minus;return value from a
failure. (One may return undef as an alternative way of
reporting an error.)</p>

<p style="margin-left:17%; margin-top: 1em">The macros to
simplify this type of error propagation are <br>
&quot;CheckOSError(expr)&quot;</p>

<p style="margin-left:23%;">Returns true on error, sets
$^E. Expects <i>expr()</i> be a call of
<tt>&quot;Dos*&quot;</tt>&minus;style <small>API</small>
.</p>


<p style="margin-left:17%;">&quot;CheckWinError(expr)&quot;</p>

<p style="margin-left:23%;">Returns true on error, sets
$^E. Expects <i>expr()</i> be a call of
<tt>&quot;Win*&quot;</tt>&minus;style <small>API</small>
.</p>


<p style="margin-left:17%;">&quot;SaveWinError(expr)&quot;</p>

<p style="margin-left:23%;">Returns
<tt>&quot;expr&quot;</tt>, sets $^E from
<i>WinGetLastError()</i> if <tt>&quot;expr&quot;</tt> is
false.</p>


<p style="margin-left:17%;">&quot;SaveCroakWinError(expr,die,name1,name2)&quot;</p>

<p style="margin-left:23%;">Returns
<tt>&quot;expr&quot;</tt>, sets $^E from
<i>WinGetLastError()</i> if <tt>&quot;expr&quot;</tt> is
false, and <i>die()</i>s if <tt>&quot;die&quot;</tt> and $^E
are true. The message to die is the concatenated strings
<tt>&quot;name1&quot;</tt> and <tt>&quot;name2&quot;</tt>,
separated by <tt>&quot;: &quot;</tt> from the contents of
$^E.</p>


<p style="margin-left:17%;">&quot;WinError_2_Perl_rc&quot;</p>

<p style="margin-left:23%;">Sets
<tt>&quot;Perl_rc&quot;</tt> to the return value of
<i>WinGetLastError()</i>.</p>

<p style="margin-left:17%;">&quot;FillWinError&quot;</p>

<p style="margin-left:23%;">Sets
<tt>&quot;Perl_rc&quot;</tt> to the return value of
<i>WinGetLastError()</i>, and sets $^E to the corresponding
value.</p>


<p style="margin-left:17%;">&quot;FillOSError(rc)&quot;</p>

<p style="margin-left:23%;">Sets
<tt>&quot;Perl_rc&quot;</tt> to <tt>&quot;rc&quot;</tt>, and
sets $^E to the corresponding value.</p>

<p style="margin-left:11%;">Loading DLLs and ordinals in
DLLs</p>

<p style="margin-left:17%;">Some DLLs are only present in
some versions of <small>OS/2</small> , or in some
configurations of <small>OS/2</small> . Some exported entry
points are present only in DLLs shipped with some versions
of <small>OS/2</small> . If these DLLs and entry points were
linked directly for a Perl executable/DLL or from a Perl
extensions, this binary would work only with the specified
versions/setups. Even if these entry points were not needed,
the <i>load</i> of the executable (or <small>DLL</small> )
would fail.</p>

<p style="margin-left:17%; margin-top: 1em">For example,
many newer useful APIs are not present in
<small>OS/2</small> v2; many PM-related APIs require DLLs
not available on floppy-boot setup.</p>

<p style="margin-left:17%; margin-top: 1em">To make these
calls fail <i>only when the calls are executed</i>, one
should call these <small>API</small> via a dynamic linking
<small>API</small> . There is a subsystem in Perl to
simplify such type of calls. A large number of entry points
available for such linking is provided (see
<tt>&quot;entries_ordinals&quot;</tt> &minus; and also
<tt>&quot;PMWIN_entries&quot;</tt> &minus; in
<i>os2ish.h</i>). These ordinals can be accessed via the
APIs:</p>

<pre style="margin-left:17%; margin-top: 1em">  CallORD(), DeclFuncByORD(), DeclVoidFuncByORD(),
  DeclOSFuncByORD(), DeclWinFuncByORD(), AssignFuncPByORD(),
  DeclWinFuncByORD_CACHE(), DeclWinFuncByORD_CACHE_survive(),
  DeclWinFuncByORD_CACHE_resetError_survive(),
  DeclWinFunc_CACHE(), DeclWinFunc_CACHE_resetError(),
  DeclWinFunc_CACHE_survive(), DeclWinFunc_CACHE_resetError_survive()</pre>


<p style="margin-left:17%; margin-top: 1em">See the header
files and the C code in the supplied OS/2&minus;related
modules for the details on usage of these functions.</p>

<p style="margin-left:17%; margin-top: 1em">Some of these
functions also combine dynaloading semantic with the
error-propagation semantic discussed above.</p>

<h2>Perl flavors
<a name="Perl flavors"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Because of
idiosyncrasies of <small>OS/2</small> one cannot have all
the eggs in the same basket (though <small>EMX</small>
environment tries hard to overcome this limitations, so the
situation may somehow improve). There are 4 executables for
Perl provided by the distribution:</p>


<p style="margin-left:11%; margin-top: 1em"><i>perl.exe</i>
<br>
The main workhorse. This is a chimera executable: it is
compiled as an <tt>&quot;a.out&quot;</tt>&minus;style
executable, but is linked with
<tt>&quot;omf&quot;</tt>&minus;style dynamic library
<i>perl.dll</i>, and with dynamic <small>CRT DLL</small> .
This executable is a <small>VIO</small> application.</p>

<p style="margin-left:11%; margin-top: 1em">It can load
perl dynamic extensions, and it can <i>fork()</i>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note.</b>
Keep in mind that <i>fork()</i> is needed to open a pipe to
yourself.</p>


<p style="margin-left:11%; margin-top: 1em"><i>perl_.exe</i>
<br>
This is a statically linked
<tt>&quot;a.out&quot;</tt>&minus;style executable. It cannot
load dynamic Perl extensions. The executable supplied in
binary distributions has a lot of extensions prebuilt, thus
the above restriction is important only if you use
custom-built extensions. This executable is a
<small>VIO</small> application.</p>

<p style="margin-left:11%; margin-top: 1em"><i>This is the
only executable with does not require <small>OS/2</small>
.</i> The friends locked into <tt>&quot;M$&quot;</tt> world
would appreciate the fact that this executable runs under
<small>DOS</small> , Win0.3*, Win0.95 and WinNT with an
appropriate extender. See &quot;Other OSes&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>perl__.exe</i>
<br>
This is the same executable as <i>perl___.exe</i>, but it is
a <small>PM</small> application.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note.</b>
Usually (unless explicitly redirected during the startup)
<small>STDIN</small> , <small>STDERR</small> , and
<small>STDOUT</small> of a <small>PM</small> application are
redirected to <i>nul</i>. However, it is possible to
<i>see</i> them if you start <tt>&quot;perl__.exe&quot;</tt>
from a <small>PM</small> program which emulates a console
window, like <i>Shell mode</i> of Emacs or
<small>EPM</small> . Thus it <i>is possible</i> to use Perl
debugger (see perldebug) to debug your <small>PM</small>
application (but beware of the message loop lockups &minus;
this will not work if you have a message queue to serve,
unless you hook the serving into the <i>getc()</i> function
of the debugger).</p>

<p style="margin-left:11%; margin-top: 1em">Another way to
see the output of a <small>PM</small> program is to run it
as</p>

<pre style="margin-left:11%; margin-top: 1em">  pm_prog args 2&gt;&amp;1 | cat &minus;</pre>


<p style="margin-left:11%; margin-top: 1em">with a shell
<i>different</i> from <i>cmd.exe</i>, so that it does not
create a link between a <small>VIO</small> session and the
session of <tt>&quot;pm_porg&quot;</tt>. (Such a link closes
the <small>VIO</small> window.) E.g., this works with
<i>sh.exe</i> &minus; or with Perl!</p>

<pre style="margin-left:11%; margin-top: 1em">  open P, 'pm_prog args 2&gt;&amp;1 |' or die;
  print while &lt;P&gt;;</pre>


<p style="margin-left:11%; margin-top: 1em">The flavor
<i>perl__.exe</i> is required if you want to start your
program without a <small>VIO</small> window present, but not
<tt>&quot;detach&quot;</tt>ed (run <tt>&quot;help
detach&quot;</tt> for more info). Very useful for extensions
which use <small>PM</small> , like
<tt>&quot;Perl/Tk&quot;</tt> or
<tt>&quot;OpenGL&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">Note also that
the differences between <small>PM</small> and
<small>VIO</small> executables are only in the
<i>default</i> behaviour. One can start <i>any</i>
executable in <i>any</i> kind of session by using the
arguments <tt>&quot;/fs&quot;</tt>, <tt>&quot;/pm&quot;</tt>
or <tt>&quot;/win&quot;</tt> switches of the command
<tt>&quot;start&quot;</tt> (of <i><small>CMD</small>
.EXE</i> or a similar shell). Alternatively, one can use the
numeric first argument of the <tt>&quot;system&quot;</tt>
Perl function (see OS2::Process).</p>


<p style="margin-left:11%; margin-top: 1em"><i>perl___.exe</i>
<br>
This is an <tt>&quot;omf&quot;</tt>&minus;style executable
which is dynamically linked to <i>perl.dll</i> and
<small>CRT DLL</small> . I know no advantages of this
executable over <tt>&quot;perl.exe&quot;</tt>, but it cannot
<i>fork()</i> at all. Well, one advantage is that the build
process is not so convoluted as with
<tt>&quot;perl.exe&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">It is a
<small>VIO</small> application.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Why strange
names?</b> <br>
Since Perl processes the <tt>&quot;#!&quot;</tt>&minus;line
(cf. &quot; <small>DESCRIPTION</small> &quot; in perlrun,
&quot;Command Switches&quot; in perlrun, &quot;No Perl
script found in input&quot; in perldiag), it should know
when a program <i>is a Perl</i>. There is some naming
convention which allows Perl to distinguish correct lines
from wrong ones. The above names are almost the only names
allowed by this convention which do not contain digits
(which have absolutely different semantics).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Why dynamic
linking?</b> <br>
Well, having several executables dynamically linked to the
same huge library has its advantages, but this would not
substantiate the additional work to make it compile. The
reason is the complicated-to-developers but very quick and
convenient-to-users &quot;hard&quot; dynamic linking used by
<small>OS/2</small> .</p>

<p style="margin-left:11%; margin-top: 1em">There are two
distinctive features of the dyna-linking model of
<small>OS/2:</small> first, all the references to external
functions are resolved at the compile time; second, there is
no runtime fixup of the DLLs after they are loaded into
memory. The first feature is an enormous advantage over
other models: it avoids conflicts when several DLLs used by
an application export entries with the same name. In such
cases &quot;other&quot; models of dyna-linking just choose
between these two entry points using some random criterion
&minus; with predictable disasters as results. But it is the
second feature which requires the build of
<i>perl.dll</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The address
tables of DLLs are patched only once, when they are loaded.
The addresses of the entry points into DLLs are guaranteed
to be the same for all the programs which use the same
<small>DLL</small> . This removes the runtime fixup &minus;
once <small>DLL</small> is loaded, its code is
read-only.</p>

<p style="margin-left:11%; margin-top: 1em">While this
allows some (significant?) performance advantages, this
makes life much harder for developers, since the above
scheme makes it impossible for a <small>DLL</small> to be
&quot;linked&quot; to a symbol in the <i>.EXE</i> file.
Indeed, this would need a <small>DLL</small> to have
different relocations tables for the (different) executables
which use this <small>DLL</small> .</p>

<p style="margin-left:11%; margin-top: 1em">However, a
dynamically loaded Perl extension is forced to use some
symbols from the perl executable, e.g., to know how to find
the arguments to the functions: the arguments live on the
perl internal evaluation stack. The solution is to put the
main code of the interpreter into a <small>DLL</small> , and
make the <i>.EXE</i> file which just loads this
<small>DLL</small> into memory and supplies
command-arguments. The extension <small>DLL</small> cannot
link to symbols in <i>.EXE</i>, but it has no problem
linking to symbols in the <i>.DLL</i>.</p>

<p style="margin-left:11%; margin-top: 1em">This
<i>greatly</i> increases the load time for the application
(as well as complexity of the compilation). Since
interpreter is in a <small>DLL</small> , the C
<small>RTL</small> is basically forced to reside in a
<small>DLL</small> as well (otherwise extensions would not
be able to use <small>CRT</small> ). There are some
advantages if you use different flavors of perl, such as
running <i>perl.exe</i> and <i>perl__.exe</i>
simultaneously: they share the memory of
<i>perl.dll</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NOTE</small></b>
. There is one additional effect which makes DLLs more
wasteful: DLLs are loaded in the shared memory region, which
is a scarse resource given the 512M barrier of the
&quot;standard&quot; <small>OS/2</small> virtual memory. The
code of <i>.EXE</i> files is also shared by all the
processes which use the particular <i>.EXE</i>, but they are
&quot;shared in the private address space of the
process&quot;; this is possible because the address at which
different sections of the <i>.EXE</i> file are loaded is
decided at compile-time, thus all the processes have these
sections loaded at same addresses, and no fixup of internal
links inside the <i>.EXE</i> is needed.</p>

<p style="margin-left:11%; margin-top: 1em">Since DLLs may
be loaded at run time, to have the same mechanism for DLLs
one needs to have the address range of <i>any of the
loaded</i> DLLs in the system to be available <i>in all the
processes</i> which did not load a particular
<small>DLL</small> yet. This is why the DLLs are mapped to
the shared memory region.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Why chimera
build?</b> <br>
Current <small>EMX</small> environment does not allow DLLs
compiled using Unixish <tt>&quot;a.out&quot;</tt> format to
export symbols for data (or at least some types of data).
This forces <tt>&quot;omf&quot;</tt>&minus;style compile of
<i>perl.dll</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Current
<small>EMX</small> environment does not allow <i>.EXE</i>
files compiled in <tt>&quot;omf&quot;</tt> format to
<i>fork()</i>. <i>fork()</i> is needed for exactly three
Perl operations:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>explicit <i>fork()</i> in the script,</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p><tt>&quot;open FH, &quot;|&minus;&quot;&quot;</tt></p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p><tt>&quot;open FH, &quot;&minus;|&quot;&quot;</tt>, in
other words, opening pipes to itself.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">While these
operations are not questions of life and death, they are
needed for a lot of useful scripts. This forces
<tt>&quot;a.out&quot;</tt>&minus;style compile of
<i>perl.exe</i>.</p>

<h2>ENVIRONMENT
<a name="ENVIRONMENT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Here we list
environment variables with are either
<small>OS/2&minus;</small> and <small>DOS&minus;</small> and
Win*&minus;specific, or are more important under
<small>OS/2</small> than under other OSes.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;PERLLIB_PREFIX&quot;</b>
<br>
Specific for <small>EMX</small> port. Should have the
form</p>

<pre style="margin-left:11%; margin-top: 1em">  path1;path2</pre>


<p style="margin-left:11%; margin-top: 1em">or</p>

<pre style="margin-left:11%; margin-top: 1em">  path1 path2</pre>


<p style="margin-left:11%; margin-top: 1em">If the
beginning of some prebuilt path matches <i>path1</i>, it is
substituted with <i>path2</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Should be used
if the perl library is moved from the default location in
preference to <tt>&quot;PERL(5)LIB&quot;</tt>, since this
would not leave wrong entries in <tt>@INC</tt>. For example,
if the compiled version of perl looks for <tt>@INC</tt> in
<i>f:/perllib/lib</i>, and you want to install the library
in <i>h:/opt/gnu</i>, do</p>

<pre style="margin-left:11%; margin-top: 1em">  set PERLLIB_PREFIX=f:/perllib/lib;h:/opt/gnu</pre>


<p style="margin-left:11%; margin-top: 1em">This will cause
Perl with the prebuilt <tt>@INC</tt> of</p>

<pre style="margin-left:11%; margin-top: 1em">  f:/perllib/lib/5.00553/os2
  f:/perllib/lib/5.00553
  f:/perllib/lib/site_perl/5.00553/os2
  f:/perllib/lib/site_perl/5.00553
  .</pre>


<p style="margin-left:11%; margin-top: 1em">to use the
following <tt>@INC:</tt></p>


<p style="margin-left:11%; margin-top: 1em"><tt>h:/opt/gnu/5.00553/os2
<br>
h:/opt/gnu/5.00553 <br>
h:/opt/gnu/site_perl/5.00553/os2 <br>
h:/opt/gnu/site_perl/5.00553 <br>
.</tt></p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;PERL_BADLANG&quot;</b>
<br>
If 0, perl ignores <i>setlocale()</i> failing. May be useful
with some strange <i>locale</i>s.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;PERL_BADFREE&quot;</b>
<br>
If 0, perl would not warn of in case of unwarranted
<i>free()</i>. With older perls this might be useful in
conjunction with the module DB_File, which was buggy when
dynamically linked and OMF-built.</p>

<p style="margin-left:11%; margin-top: 1em">Should not be
set with newer Perls, since this may hide some <i>real</i>
problems.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;PERL_SH_DIR&quot;</b>
<br>
Specific for <small>EMX</small> port. Gives the directory
part of the location for <i>sh.exe</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;USE_PERL_FLOCK&quot;</b>
<br>
Specific for <small>EMX</small> port. Since <i>flock</i>(3)
is present in <small>EMX</small> , but is not functional, it
is emulated by perl. To disable the emulations, set
environment variable
<tt>&quot;USE_PERL_FLOCK=0&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;TMP&quot;
or &quot;TEMP&quot;</b> <br>
Specific for <small>EMX</small> port. Used as storage place
for temporary files.</p>

<h2>Evolution
<a name="Evolution"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Here we list
major changes which could make you by surprise.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Text-mode
filehandles</b> <br>
Starting from version 5.8, Perl uses a builtin translation
layer for text-mode files. This replaces the efficient
well-tested <small>EMX</small> layer by some code which
should be best characterized as a &quot;quick
hack&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">In addition to
possible bugs and an inability to follow changes to the
translation policy with off/on switches of
<small>TERMIO</small> translation, this introduces a serious
incompatible change: before <i>sysread()</i> on text-mode
filehandles would go through the translation layer, now it
would not.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Priorities</b>
<tt><br>
&quot;setpriority&quot;</tt> and
<tt>&quot;getpriority&quot;</tt> are not compatible with
earlier ports by Andreas Kaiser. See <tt>&quot;setpriority,
getpriority&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DLL</small>
name mangling: pre 5.6.2</b> <br>
With the release 5.003_01 the dynamically loadable libraries
should be rebuilt when a different version of Perl is
compiled. In particular, DLLs (including <i>perl.dll</i>)
are now created with the names which contain a checksum,
thus allowing workaround for <small>OS/2</small> scheme of
caching DLLs.</p>

<p style="margin-left:11%; margin-top: 1em">It may be
possible to code a simple workaround which would</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">find the old DLLs looking
through the old <tt>@INC</tt>;</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>mangle the names according to the scheme of new perl and
copy the DLLs to these names;</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>edit the internal <tt>&quot;LX&quot;</tt> tables of
<small>DLL</small> to reflect the change of the name
(probably not needed for Perl extension DLLs, since the
internally coded names are not used for &quot;specific&quot;
DLLs, they used only for &quot;global&quot; DLLs).</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>edit the internal <tt>&quot;IMPORT&quot;</tt> tables and
change the name of the &quot;old&quot; <i>perl????.dll</i>
to the &quot;new&quot; <i>perl????.dll</i>.</p></td></tr>
</table>


<p style="margin-left:11%; margin-top: 1em"><b><small>DLL</small>
name mangling: 5.6.2 and beyond</b> <br>
In fact mangling of <i>extension</i> DLLs was done due to
misunderstanding of the <small>OS/2</small> dynaloading
model. <small>OS/2</small> (effectively) maintains two
different tables of loaded <small>DLL:</small> <br>
Global DLLs</p>

<p style="margin-left:17%;">those loaded by the base name
from <tt>&quot;LIBPATH&quot;</tt>; including those
associated at link time;</p>

<p style="margin-left:11%;">specific DLLs</p>

<p style="margin-left:17%;">loaded by the full name.</p>

<p style="margin-left:11%; margin-top: 1em">When resolving
a request for a global <small>DLL</small> , the table of
already-loaded specific DLLs is (effectively) ignored;
moreover, specific DLLs are <i>always</i> loaded from the
prescribed path.</p>

<p style="margin-left:11%; margin-top: 1em">There is/was a
minor twist which makes this scheme fragile: what to do with
DLLs loaded from <br>
&quot;BEGINLIBPATH&quot; and &quot;ENDLIBPATH&quot;</p>

<p style="margin-left:17%;">(which depend on the
process)</p>

<p style="margin-left:11%;"><i>.</i> from
&quot;LIBPATH&quot;</p>

<p style="margin-left:17%;">which <i>effectively</i>
depends on the process (although
<tt>&quot;LIBPATH&quot;</tt> is the same for all the
processes).</p>

<p style="margin-left:11%; margin-top: 1em">Unless
<tt>&quot;LIBPATHSTRICT&quot;</tt> is set to
<tt>&quot;T&quot;</tt> (and the kernel is after 2000/09/01),
such DLLs are considered to be global. When loading a global
<small>DLL</small> it is first looked in the table of
already-loaded global DLLs. Because of this the fact that
one executable loaded a <small>DLL</small> from
<tt>&quot;BEGINLIBPATH&quot;</tt> and
<tt>&quot;ENDLIBPATH&quot;</tt>, or <i>.</i> from
<tt>&quot;LIBPATH&quot;</tt> may affect <i>which</i>
<small>DLL</small> is loaded when <i>another</i> executable
requests a <small>DLL</small> with the same name.
<i>This</i> is the reason for version-specific mangling of
the <small>DLL</small> name for perl <small>DLL</small>
.</p>

<p style="margin-left:11%; margin-top: 1em">Since the Perl
extension DLLs are always loaded with the full path, there
is no need to mangle their names in a version-specific ways:
their directory already reflects the corresponding version
of perl, and <tt>@INC</tt> takes into account binary
compatibility with older version. Starting from
<tt>5.6.2</tt> the name mangling scheme is fixed to be the
same as for Perl 5.005_53 (same as in a popular binary
release). Thus new Perls will be able to <i>resolve the
names</i> of old extension DLLs if <tt>@INC</tt> allows
finding their directories.</p>

<p style="margin-left:11%; margin-top: 1em">However, this
still does not guarantee that these <small>DLL</small> may
be loaded. The reason is the mangling of the name of the
<i>Perl <small>DLL</small></i> . And since the extension
DLLs link with the Perl <small>DLL</small> , extension DLLs
for older versions would load an older Perl
<small>DLL</small> , and would most probably segfault (since
the data in this <small>DLL</small> is not properly
initialized).</p>

<p style="margin-left:11%; margin-top: 1em">There is a
partial workaround (which can be made complete with newer
<small>OS/2</small> kernels): create a forwarder
<small>DLL</small> with the same name as the
<small>DLL</small> of the older version of Perl, which
forwards the entry points to the newer Perl&rsquo;s
<small>DLL</small> . Make this <small>DLL</small> accessible
on (say) the <tt>&quot;BEGINLIBPATH&quot;</tt> of the new
Perl executable. When the new executable accesses old
Perl&rsquo;s extension DLLs, they would request the old
Perl&rsquo;s <small>DLL</small> by name, get the forwarder
instead, so effectively will link with the currently running
(new) Perl <small>DLL</small> .</p>

<p style="margin-left:11%; margin-top: 1em">This may break
in two ways:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Old perl executable is started when a new executable is
running has loaded an extension compiled for the old
executable (ouph!). In this case the old executable will get
a forwarder <small>DLL</small> instead of the old perl
<small>DLL</small> , so would link with the new perl
<small>DLL</small> . While not directly fatal, it will
behave the same as new executable. This beats the whole
purpose of explicitly starting an old executable.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>A new executable loads an extension compiled for the old
executable when an old perl executable is running. In this
case the extension will not pick up the forwarder &minus;
with fatal results.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">With support
for <tt>&quot;LIBPATHSTRICT&quot;</tt> this may be
circumvented &minus; unless one of DLLs is started from
<i>.</i> from <tt>&quot;LIBPATH&quot;</tt> (I do not know
whether <tt>&quot;LIBPATHSTRICT&quot;</tt> affects this
case).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>REMARK</small></b>
. Unless newer kernels allow <i>.</i> in
<tt>&quot;BEGINLIBPATH&quot;</tt> (older do not), this mess
cannot be completely cleaned. (It turns out that as of the
beginning of 2002, <i>.</i> is not allowed, but <i>.\.</i>
is &minus; and it has the same effect.)</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>REMARK</small></b>
. <tt>&quot;LIBPATHSTRICT&quot;</tt>,
<tt>&quot;BEGINLIBPATH&quot;</tt> and
<tt>&quot;ENDLIBPATH&quot;</tt> are not environment
variables, although <i>cmd.exe</i> emulates them on
<tt>&quot;SET ...&quot;</tt> lines. From Perl they may be
accessed by Cwd::extLibpath and Cwd::extLibpath_set.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DLL</small>
forwarder generation</b> <br>
Assume that the old <small>DLL</small> is named
<i>perlE0AC.dll</i> (as is one for 5.005_53), and the new
version is 5.6.1. Create a file
<i>perl5shim.def&minus;leader</i> with</p>

<pre style="margin-left:11%; margin-top: 1em">  LIBRARY 'perlE0AC' INITINSTANCE TERMINSTANCE
  DESCRIPTION '@#perl5&minus;porters@perl.org:5.006001#@ Perl module for 5.00553 &minus;&gt; Perl 5.6.1 forwarder'
  CODE LOADONCALL
  DATA LOADONCALL NONSHARED MULTIPLE
  EXPORTS</pre>


<p style="margin-left:11%; margin-top: 1em">modifying the
versions/names as needed. Run</p>

<pre style="margin-left:11%; margin-top: 1em"> perl &minus;wnle &quot;next if 0../EXPORTS/; print qq(  \&quot;$1\&quot;) if /\&quot;(\w+)\&quot;/&quot; perl5.def &gt;lst</pre>


<p style="margin-left:11%; margin-top: 1em">in the Perl
build directory (to make the <small>DLL</small> smaller
replace perl5.def with the definition file for the older
version of Perl if present).</p>

<pre style="margin-left:11%; margin-top: 1em"> cat perl5shim.def&minus;leader lst &gt;perl5shim.def
 gcc &minus;Zomf &minus;Zdll &minus;o perlE0AC.dll perl5shim.def &minus;s &minus;llibperl</pre>


<p style="margin-left:11%; margin-top: 1em">(ignore
multiple <tt>&quot;warning L4085&quot;</tt>).</p>


<p style="margin-left:11%; margin-top: 1em"><b>Threading</b>
<br>
As of release 5.003_01 perl is linked to multithreaded C
<small>RTL DLL</small> . If perl itself is not compiled
multithread-enabled, so will not be perl&rsquo;s
<i>malloc()</i>. However, extensions may use multiple thread
on their own risk.</p>

<p style="margin-left:11%; margin-top: 1em">This was needed
to compile <tt>&quot;Perl/Tk&quot;</tt> for
XFree86&minus;OS/2 out-of-the-box, and link with DLLs for
other useful libraries, which typically are compiled with
<tt>&quot;&minus;Zmt &minus;Zcrtdll&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Calls to
external programs</b> <br>
Due to a popular demand the perl external program calling
has been changed wrt Andreas Kaiser&rsquo;s port. <i>If</i>
perl needs to call an external program <i>via shell</i>, the
<i>f:/bin/sh.exe</i> will be called, or whatever is the
override, see &quot; <small>PERL_SH_DIR</small> &quot;.</p>

<p style="margin-left:11%; margin-top: 1em">Thus means that
you need to get some copy of a <i>sh.exe</i> as well (I use
one from pdksh). The path <i>F:/bin</i> above is set up
automatically during the build to a correct value on the
builder machine, but is overridable at runtime,</p>


<p style="margin-left:11%; margin-top: 1em"><b>Reasons:</b>
a consensus on <tt>&quot;perl5&minus;porters&quot;</tt> was
that perl should use one non-overridable shell per platform.
The obvious choices for <small>OS/2</small> are
<i>cmd.exe</i> and <i>sh.exe</i>. Having perl build itself
would be impossible with <i>cmd.exe</i> as a shell, thus I
picked up <tt>&quot;sh.exe&quot;</tt>. This assures almost
100% compatibility with the scripts coming from *nix. As an
added benefit this works as well under <small>DOS</small> if
you use DOS-enabled port of pdksh (see
&quot;Prerequisites&quot;).</p>


<p style="margin-left:11%; margin-top: 1em"><b>Disadvantages:</b>
currently <i>sh.exe</i> of pdksh calls external programs via
<i>fork()</i>/<i>exec()</i>, and there is <i>no</i>
functioning <i>exec()</i> on <small>OS/2</small> .
<i>exec()</i> is emulated by <small>EMX</small> by an
asynchronous call while the caller waits for child
completion (to pretend that the <tt>&quot;pid&quot;</tt> did
not change). This means that 1 <i>extra</i> copy of
<i>sh.exe</i> is made active via
<i>fork()</i>/<i>exec()</i>, which may lead to some
resources taken from the system (even if we do not count
extra work needed for <i>fork()</i>ing).</p>

<p style="margin-left:11%; margin-top: 1em">Note that this
a lesser issue now when we do not spawn <i>sh.exe</i> unless
needed (metachars found).</p>

<p style="margin-left:11%; margin-top: 1em">One can always
start <i>cmd.exe</i> explicitly via</p>

<pre style="margin-left:11%; margin-top: 1em">  system 'cmd', '/c', 'mycmd', 'arg1', 'arg2', ...</pre>


<p style="margin-left:11%; margin-top: 1em">If you need to
use <i>cmd.exe</i>, and do not want to hand-edit thousands
of your scripts, the long-term solution proposed on
p5&minus;p is to have a directive</p>

<pre style="margin-left:11%; margin-top: 1em">  use OS2::Cmd;</pre>


<p style="margin-left:11%; margin-top: 1em">which will
override <i>system()</i>, <i>exec()</i>,
<tt>&quot;``&quot;</tt>, and
<tt>&quot;open(,'...|')&quot;</tt>. With current perl you
may override only <i>system()</i>, <i>readpipe()</i> &minus;
the explicit version of <tt>&quot;``&quot;</tt>, and maybe
<i>exec()</i>. The code will substitute the one-argument
call to <i>system()</i> by <tt>&quot;CORE::system('cmd.exe',
'/c', shift)&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">If you have
some working code for <tt>&quot;OS2::Cmd&quot;</tt>, please
send it to me, I will include it into distribution. I have
no need for such a module, so cannot test it.</p>

<p style="margin-left:11%; margin-top: 1em">For the details
of the current situation with calling external programs, see
&quot;Starting <small>OS/2</small> (and <small>DOS</small> )
programs under Perl&quot;. Set us mention a couple of
features:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">External scripts may be called
by their basename. Perl will try the same extensions as when
processing <b>&minus;S</b> command-line switch.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>External scripts starting with <tt>&quot;#!&quot;</tt>
or <tt>&quot;extproc &quot;</tt> will be executed directly,
without calling the shell, by calling the program specified
on the rest of the first line.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>Memory
allocation</b> <br>
Perl uses its own <i>malloc()</i> under <small>OS/2</small>
&minus; interpreters are usually malloc-bound for speed, but
perl is not, since its malloc is lightning-fast.
Perl-memory-usage-tuned benchmarks show that Perl&rsquo;s
malloc is 5 times quicker than <small>EMX</small> one. I do
not have convincing data about memory footprint, but a
(pretty random) benchmark showed that Perl&rsquo;s one is 5%
better.</p>

<p style="margin-left:11%; margin-top: 1em">Combination of
perl&rsquo;s <i>malloc()</i> and rigid <small>DLL</small>
name resolution creates a special problem with library
functions which expect their return value to be
<i>free()</i>d by system&rsquo;s <i>free()</i>. To
facilitate extensions which need to call such functions,
system memory-allocation functions are still available with
the prefix <tt>&quot;emx_&quot;</tt> added. (Currently only
<small>DLL</small> perl has this, it should propagate to
<i>perl_.exe</i> shortly.)</p>

<p style="margin-left:11%; margin-top: 1em"><b>Threads</b>
<br>
One can build perl with thread support enabled by providing
<tt>&quot;&minus;D usethreads&quot;</tt> option to
<i>Configure</i>. Currently <small>OS/2</small> support of
threads is very preliminary.</p>

<p style="margin-left:11%; margin-top: 1em">Most notable
problems: <br>
&quot;COND_WAIT&quot;</p>

<p style="margin-left:17%;">may have a race condition (but
probably does not due to edge-triggered nature of
<small>OS/2</small> Event semaphores). (Needs a
reimplementation (in terms of chaining waiting threads, with
the linked list stored in per-thread structure?)?)</p>

<p style="margin-left:11%;"><i>os2.c</i></p>

<p style="margin-left:17%;">has a couple of static
variables used in OS/2&minus;specific functions. (Need to be
moved to per-thread structure, or serialized?)</p>

<p style="margin-left:11%; margin-top: 1em">Note that these
problems should not discourage experimenting, since they
have a low probability of affecting small programs.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This
description is not updated often (since 5.6.1?), see
<i>./os2/Changes</i> for more info.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Ilya
Zakharevich, cpan@ilyaz.org</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>perl</i>(1).</p>
<hr>
</body>
</html>
