<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Thu Aug 18 15:09:51 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>GETSPNAM</title>

</head>
<body>

<h1 align="center">GETSPNAM</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#RETURN VALUE">RETURN VALUE</a><br>
<a href="#ERRORS">ERRORS</a><br>
<a href="#FILES">FILES</a><br>
<a href="#CONFORMING TO">CONFORMING TO</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#COLOPHON">COLOPHON</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">getspnam,
getspnam_r, getspent, getspent_r, setspent, endspent,
fgetspent, fgetspent_r, sgetspent, sgetspent_r, putspent,
lckpwdf, ulckpwdf &minus; get shadow password file entry</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">/* General
shadow password file API */ <b><br>
#include &lt;shadow.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>struct spwd
*getspnam(const char *</b><i>name</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>struct spwd
*getspent(void);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>void
setspent(void);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>void
endspent(void);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>struct spwd
*fgetspent(FILE *</b><i>fp</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>struct spwd
*sgetspent(const char *</b><i>s</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
putspent(struct spwd *</b><i>p</i><b>, FILE
*</b><i>fp</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
lckpwdf(void);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
ulckpwdf(void);</b></p>

<p style="margin-left:11%; margin-top: 1em">/* GNU
extension */ <b><br>
#include &lt;shadow.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
getspent_r(struct spwd *</b><i>spbuf</i><b>, <br>
char *</b><i>buf</i><b>, size_t</b> <i>buflen</i><b>, struct
spwd **</b><i>spbufp</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
getspnam_r(const char *</b><i>name</i><b>, struct spwd
*</b><i>spbuf</i><b>, <br>
char *</b><i>buf</i><b>, size_t</b> <i>buflen</i><b>, struct
spwd **</b><i>spbufp</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
fgetspent_r(FILE *</b><i>fp</i><b>, struct spwd
*</b><i>spbuf</i><b>, <br>
char *</b><i>buf</i><b>, size_t</b> <i>buflen</i><b>, struct
spwd **</b><i>spbufp</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
sgetspent_r(const char *</b><i>s</i><b>, struct spwd
*</b><i>spbuf</i><b>, <br>
char *</b><i>buf</i><b>, size_t</b> <i>buflen</i><b>, struct
spwd **</b><i>spbufp</i><b>);</b></p>

<p style="margin-left:5%; margin-top: 1em">Feature Test
Macro Requirements for glibc (see
<b>feature_test_macros</b>(7)):</p>


<p style="margin-left:11%; margin-top: 1em"><b>getspent_r</b>(),
<b>getspnam_r</b>(), <b>fgetspent_r</b>(),
<b>sgetspent_r</b>():</p>

<p style="margin-left:17%;">_BSD_SOURCE || _SVID_SOURCE</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Long ago it was
considered safe to have encrypted passwords openly visible
in the password file. When computers got faster and people
got more security-conscious, this was no longer acceptable.
Julianne Frances Haugh implemented the shadow password suite
that keeps the encrypted passwords in the shadow password
database (e.g., the local shadow password file
<i>/etc/shadow</i>, NIS, and LDAP), readable only by
root.</p>

<p style="margin-left:11%; margin-top: 1em">The functions
described below resemble those for the traditional password
database (e.g., see <b>getpwnam</b>(3) and
<b>getpwent</b>(3)).</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>getspnam</b>() function returns a pointer to a structure
containing the broken-out fields of the record in the shadow
password database that matches the username <i>name</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>getspent</b>() function returns a pointer to the next
entry in the shadow password database. The position in the
input stream is initialized by <b>setspent</b>(). When done
reading, the program may call <b>endspent</b>() so that
resources can be deallocated.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>fgetspent</b>() function is similar to <b>getspent</b>()
but uses the supplied stream instead of the one implicitly
opened by <b>setspent</b>().</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>sgetspent</b>() function parses the supplied string
<i>s</i> into a struct <i>spwd</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>putspent</b>() function writes the contents of the
supplied struct <i>spwd *p</i> as a text line in the shadow
password file format to the stream <i>fp</i>. String entries
with value NULL and numerical entries with value &minus;1
are written as an empty string.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>lckpwdf</b>() function is intended to protect against
multiple simultaneous accesses of the shadow password
database. It tries to acquire a lock, and returns 0 on
success, or &minus;1 on failure (lock not obtained within 15
seconds). The <b>ulckpwdf</b>() function releases the lock
again. Note that there is no protection against direct
access of the shadow password file. Only programs that use
<b>lckpwdf</b>() will notice the lock.</p>

<p style="margin-left:11%; margin-top: 1em">These were the
functions that formed the original shadow API. They are
widely available.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Reentrant
versions</b> <br>
Analogous to the reentrant functions for the password
database, glibc also has reentrant functions for the shadow
password database. The <b>getspnam_r</b>() function is like
<b>getspnam</b>() but stores the retrieved shadow password
structure in the space pointed to by <i>spbuf</i>. This
shadow password structure contains pointers to strings, and
these strings are stored in the buffer <i>buf</i> of size
<i>buflen</i>. A pointer to the result (in case of success)
or NULL (in case no entry was found or an error occurred) is
stored in <i>*spbufp</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The functions
<b>getspent_r</b>(), <b>fgetspent_r</b>(), and
<b>sgetspent_r</b>() are similarly analogous to their
nonreentrant counterparts.</p>

<p style="margin-left:11%; margin-top: 1em">Some non-glibc
systems also have functions with these names, often with
different prototypes.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Structure</b>
<br>
The shadow password structure is defined in
<i>&lt;shadow.h&gt;</i> as follows:</p>

<p style="margin-left:17%; margin-top: 1em">struct spwd {
<br>
char *sp_namp; /* Login name */ <br>
char *sp_pwdp; /* Encrypted password */ <br>
long sp_lstchg; /* Date of last change <br>
(measured in days since <br>
1970-01-01 00:00:00 +0000 (UTC)) */ <br>
long sp_min; /* Min # of days between changes */ <br>
long sp_max; /* Max # of days between changes */ <br>
long sp_warn; /* # of days before password expires <br>
to warn user to change it */ <br>
long sp_inact; /* # of days after password expires <br>
until account is disabled */ <br>
long sp_expire; /* Date when account expires <br>
(measured in days since <br>
1970-01-01 00:00:00 +0000 (UTC)) */ <br>
unsigned long sp_flag; /* Reserved */ <br>
};</p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The functions
that return a pointer return NULL if no more entries are
available or if an error occurs during processing. The
functions which have <i>int</i> as the return value return 0
for success and &minus;1 for failure, with <i>errno</i> set
to indicate the cause of the error.</p>

<p style="margin-left:11%; margin-top: 1em">For the
nonreentrant functions, the return value may point to static
area, and may be overwritten by subsequent calls to these
functions.</p>

<p style="margin-left:11%; margin-top: 1em">The reentrant
functions return zero on success. In case of error, an error
number is returned.</p>

<h2>ERRORS
<a name="ERRORS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p style="margin-top: 1em"><b>EACCES</b></p></td>
<td width="2%"></td>
<td width="78%">


<p style="margin-top: 1em">The caller does not have
permission to access the shadow password file.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>ERANGE</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Supplied buffer is too small.</p></td></tr>
</table>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>/etc/shadow</i></p>

<p style="margin-left:22%;">local shadow password database
file</p>

<p style="margin-left:11%;"><i>/etc/.pwd.lock</i></p>

<p style="margin-left:22%;">lock file</p>

<p style="margin-left:11%; margin-top: 1em">The include
file <i>&lt;paths.h&gt;</i> defines the constant
<b>_PATH_SHADOW</b> to the pathname of the shadow password
file.</p>

<h2>CONFORMING TO
<a name="CONFORMING TO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The shadow
password database and its associated API are not specified
in POSIX.1-2001. However, many other systems provide a
similar API.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>getgrnam</b>(3),
<b>getpwnam</b>(3), <b>getpwnam_r</b>(3),
<b>shadow</b>(5)</p>

<h2>COLOPHON
<a name="COLOPHON"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This page is
part of release 3.53 of the Linux <i>man-pages</i> project.
A description of the project, and information about
reporting bugs, can be found at
http://www.kernel.org/doc/man&minus;pages/.</p>
<hr>
</body>
</html>
