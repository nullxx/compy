<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Thu Aug 18 15:26:03 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>tcltest</title>

</head>
<body>

<h1 align="center">tcltest</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#COMMANDS">COMMANDS</a><br>
<a href="#CONFIGURATION COMMANDS">CONFIGURATION COMMANDS</a><br>
<a href="#SHORTCUT COMMANDS">SHORTCUT COMMANDS</a><br>
<a href="#OTHER COMMANDS">OTHER COMMANDS</a><br>
<a href="#TESTS">TESTS</a><br>
<a href="#TEST CONSTRAINTS">TEST CONSTRAINTS</a><br>
<a href="#RUNNING ALL TESTS">RUNNING ALL TESTS</a><br>
<a href="#CONFIGURABLE OPTIONS">CONFIGURABLE OPTIONS</a><br>
<a href="#CREATING TEST SUITES WITH TCLTEST">CREATING TEST SUITES WITH TCLTEST</a><br>
<a href="#COMPATIBILITY">COMPATIBILITY</a><br>
<a href="#KNOWN ISSUES">KNOWN ISSUES</a><br>
<a href="#KEYWORDS">KEYWORDS</a><br>

<hr>



<p>______________________________________________________________________________</p>

<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">tcltest &minus;
Test harness support code and utilities</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>package
require tcltest ?2.3?</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>tcltest::test</b>
<i>name description ?option value ...?</i> <b><br>
tcltest::test</b> <i>name description ?constraints? body
result</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>tcltest::loadTestedCommands
<br>
tcltest::makeDirectory</b> <i>name ?directory?</i> <b><br>
tcltest::removeDirectory</b> <i>name ?directory?</i> <b><br>
tcltest::makeFile</b> <i>contents name ?directory?</i>
<b><br>
tcltest::removeFile</b> <i>name ?directory?</i> <b><br>
tcltest::viewFile</b> <i>name ?directory?</i> <b><br>
tcltest::cleanupTests</b> <i>?runningMultipleTests?</i>
<b><br>
tcltest::runAllTests</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>tcltest::configure
<br>
tcltest::configure</b> <i>option</i> <b><br>
tcltest::configure</b> <i>option value ?option value
...?</i> <b><br>
tcltest::customMatch</b> <i>mode command</i> <b><br>
tcltest::testConstraint</b> <i>constraint ?value?</i>
<b><br>
tcltest::outputChannel</b> <i>?channelID?</i> <b><br>
tcltest::errorChannel</b> <i>?channelID?</i> <b><br>
tcltest::interpreter</b> <i>?interp?</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>tcltest::debug</b>
<i>?level?</i> <b><br>
tcltest::errorFile</b> <i>?filename?</i> <b><br>
tcltest::limitConstraints</b> <i>?boolean?</i> <b><br>
tcltest::loadFile</b> <i>?filename?</i> <b><br>
tcltest::loadScript</b> <i>?script?</i> <b><br>
tcltest::match</b> <i>?patternList?</i> <b><br>
tcltest::matchDirectories</b> <i>?patternList?</i> <b><br>
tcltest::matchFiles</b> <i>?patternList?</i> <b><br>
tcltest::outputFile</b> <i>?filename?</i> <b><br>
tcltest::preserveCore</b> <i>?level?</i> <b><br>
tcltest::singleProcess</b> <i>?boolean?</i> <b><br>
tcltest::skip</b> <i>?patternList?</i> <b><br>
tcltest::skipDirectories</b> <i>?patternList?</i> <b><br>
tcltest::skipFiles</b> <i>?patternList?</i> <b><br>
tcltest::temporaryDirectory</b> <i>?directory?</i> <b><br>
tcltest::testsDirectory</b> <i>?directory?</i> <b><br>
tcltest::verbose</b> <i>?level?</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>tcltest::test</b>
<i>name description optionList</i> <b><br>
tcltest::bytestring</b> <i>string</i> <b><br>
tcltest::normalizeMsg</b> <i>msg</i> <b><br>
tcltest::normalizePath</b> <i>pathVar</i> <b><br>
tcltest::workingDirectory</b> <i>?dir?</i>
_________________________________________________________________</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>tcltest</b> package provides several utility commands
useful in the construction of test suites for code
instrumented to be run by evaluation of Tcl commands.
Notably the built-in commands of the Tcl library itself are
tested by a test suite using the tcltest package.</p>

<p style="margin-left:11%; margin-top: 1em">All the
commands provided by the <b>tcltest</b> package are defined
in and exported from the <b>::tcltest</b> namespace, as
indicated in the <b>SYNOPSIS</b> above. In the following
sections, all commands will be described by their simple
names, in the interest of brevity.</p>

<p style="margin-left:11%; margin-top: 1em">The central
command of <b>tcltest</b> is <b>test</b> that defines and
runs a test. Testing with <b>test</b> involves evaluation of
a Tcl script and comparing the result to an expected result,
as configured and controlled by a number of options. Several
other commands provided by <b>tcltest</b> govern the
configuration of <b>test</b> and the collection of many
<b>test</b> commands into test suites.</p>

<p style="margin-left:11%; margin-top: 1em">See <b>CREATING
TEST SUITES WITH TCLTEST</b> below for an extended example
of how to use the commands of <b>tcltest</b> to produce test
suites for your Tcl-enabled code.</p>

<h2>COMMANDS
<a name="COMMANDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>test</b>
<i>name description ?option value ...?</i></p>

<p style="margin-left:22%;">Defines and possibly runs a
test with the name <i>name</i> and description
<i>description</i>. The name and description of a test are
used in messages reported by <b>test</b> during the test, as
configured by the options of <b>tcltest</b>. The remaining
<i>option value</i> arguments to <b>test</b> define the
test, including the scripts to run, the conditions under
which to run them, the expected result, and the means by
which the expected and actual results should be compared.
See <b>TESTS</b> below for a complete description of the
valid options and how they define a test. The <b>test</b>
command returns an empty string.</p>

<p style="margin-left:11%;"><b>test</b> <i>name description
?constraints? body result</i></p>

<p style="margin-left:22%;">This form of <b>test</b> is
provided to support test suites written for version 1 of the
<b>tcltest</b> package, and also a simpler interface for a
common usage. It is the same as &ldquo;<b>test</b> <i>name
description</i> <b>&minus;constraints</b> <i>constraints</i>
<b>&minus;body</b> <i>body</i> <b>&minus;result</b>
<i>result</i>&rdquo;. All other options to <b>test</b> take
their default values. When <i>constraints</i> is omitted,
this form of <b>test</b> can be distinguished from the first
because all <i>option</i>s begin with
&ldquo;&minus;&rdquo;.</p>

<p style="margin-left:11%;"><b>loadTestedCommands</b></p>

<p style="margin-left:22%;">Evaluates in the caller&rsquo;s
context the script specified by <b>configure &minus;load</b>
or <b>configure &minus;loadfile</b>. Returns the result of
that script evaluation, including any error raised by the
script. Use this command and the related configuration
options to provide the commands to be tested to the
interpreter running the test suite.</p>

<p style="margin-left:11%;"><b>makeFile</b> <i>contents
name ?directory?</i></p>

<p style="margin-left:22%;">Creates a file named
<i>name</i> relative to directory <i>directory</i> and write
<i>contents</i> to that file using the encoding <b>encoding
system</b>. If <i>contents</i> does not end with a newline,
a newline will be appended so that the file named
<i>name</i> does end with a newline. Because the system
encoding is used, this command is only suitable for making
text files. The file will be removed by the next evaluation
of <b>cleanupTests</b>, unless it is removed by
<b>removeFile</b> first. The default value of
<i>directory</i> is the directory <b>configure
&minus;tmpdir</b>. Returns the full path of the file
created. Use this command to create any text file required
by a test with contents as needed.</p>

<p style="margin-left:11%;"><b>removeFile</b> <i>name
?directory?</i></p>

<p style="margin-left:22%;">Forces the file referenced by
<i>name</i> to be removed. This file name should be relative
to <i>directory</i>. The default value of <i>directory</i>
is the directory <b>configure &minus;tmpdir</b>. Returns an
empty string. Use this command to delete files created by
<b>makeFile</b>.</p>

<p style="margin-left:11%;"><b>makeDirectory</b> <i>name
?directory?</i></p>

<p style="margin-left:22%;">Creates a directory named
<i>name</i> relative to directory <i>directory</i>. The
directory will be removed by the next evaluation of
<b>cleanupTests</b>, unless it is removed by
<b>removeDirectory</b> first. The default value of
<i>directory</i> is the directory <b>configure
&minus;tmpdir</b>. Returns the full path of the directory
created. Use this command to create any directories that are
required to exist by a test.</p>

<p style="margin-left:11%;"><b>removeDirectory</b> <i>name
?directory?</i></p>

<p style="margin-left:22%;">Forces the directory referenced
by <i>name</i> to be removed. This directory should be
relative to <i>directory</i>. The default value of
<i>directory</i> is the directory <b>configure
&minus;tmpdir</b>. Returns an empty string. Use this command
to delete any directories created by
<b>makeDirectory</b>.</p>

<p style="margin-left:11%;"><b>viewFile</b> <i>file
?directory?</i></p>

<p style="margin-left:22%;">Returns the contents of
<i>file</i>, except for any final newline, just as <b>read
&minus;nonewline</b> would return. This file name should be
relative to <i>directory</i>. The default value of
<i>directory</i> is the directory <b>configure
&minus;tmpdir</b>. Use this command as a convenient way to
turn the contents of a file generated by a test into the
result of that test for matching against an expected result.
The contents of the file are read using the system encoding,
so its usefulness is limited to text files.</p>

<p style="margin-left:11%;"><b>cleanupTests</b></p>

<p style="margin-left:22%;">Intended to clean up and
summarize after several tests have been run. Typically
called once per test file, at the end of the file after all
tests have been completed. For best effectiveness, be sure
that the <b>cleanupTests</b> is evaluated even if an error
occurs earlier in the test file evaluation.</p>

<p style="margin-left:22%; margin-top: 1em">Prints
statistics about the tests run and removes files that were
created by <b>makeDirectory</b> and <b>makeFile</b> since
the last <b>cleanupTests</b>. Names of files and directories
in the directory <b>configure &minus;tmpdir</b> created
since the last <b>cleanupTests</b>, but not created by
<b>makeFile</b> or <b>makeDirectory</b> are printed to
<b>outputChannel</b>. This command also restores the
original shell environment, as described by the <b>::env</b>
array. Returns an empty string.</p>

<p style="margin-left:11%;"><b>runAllTests</b></p>

<p style="margin-left:22%;">This is a master command meant
to run an entire suite of tests, spanning multiple files
and/or directories, as governed by the configurable options
of <b>tcltest</b>. See <b>RUNNING ALL TESTS</b> below for a
complete description of the many variations possible with
<b>runAllTests</b>.</p>

<h2>CONFIGURATION COMMANDS
<a name="CONFIGURATION COMMANDS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>configure</b></p>

<p style="margin-left:22%;">Returns the list of
configurable options supported by <b>tcltest</b>. See
<b>CONFIGURABLE OPTIONS</b> below for the full list of
options, their valid values, and their effect on
<b>tcltest</b> operations.</p>

<p style="margin-left:11%;"><b>configure</b>
<i>option</i></p>

<p style="margin-left:22%;">Returns the current value of
the supported configurable option <i>option</i>. Raises an
error if <i>option</i> is not a supported configurable
option.</p>

<p style="margin-left:11%;"><b>configure</b> <i>option
value ?option value ...?</i></p>

<p style="margin-left:22%;">Sets the value of each
configurable option <i>option</i> to the corresponding value
<i>value</i>, in order. Raises an error if an <i>option</i>
is not a supported configurable option, or if <i>value</i>
is not a valid value for the corresponding <i>option</i>, or
if a <i>value</i> is not provided. When an error is raised,
the operation of <b>configure</b> is halted, and subsequent
<i>option value</i> arguments are not processed.</p>

<p style="margin-left:22%; margin-top: 1em">If the
environment variable <b>::env(TCLTEST_OPTIONS)</b> exists
when the <b>tcltest</b> package is loaded (by <b>package
require tcltest</b>) then its value is taken as a list of
arguments to pass to <b>configure</b>. This allows the
default values of the configuration options to be set by the
environment.</p>

<p style="margin-left:11%;"><b>customMatch</b> <i>mode
script</i></p>

<p style="margin-left:22%;">Registers <i>mode</i> as a new
legal value of the <b>&minus;match</b> option to
<b>test</b>. When the <b>&minus;match</b> <i>mode</i> option
is passed to <b>test</b>, the script <i>script</i> will be
evaluated to compare the actual result of evaluating the
body of the test to the expected result. To perform the
match, the <i>script</i> is completed with two additional
words, the expected result, and the actual result, and the
completed script is evaluated in the global namespace. The
completed script is expected to return a boolean value
indicating whether or not the results match. The built-in
matching modes of <b>test</b> are <b>exact</b>, <b>glob</b>,
and <b>regexp</b>.</p>

<p style="margin-left:11%;"><b>testConstraint</b>
<i>constraint ?boolean?</i></p>

<p style="margin-left:22%;">Sets or returns the boolean
value associated with the named <i>constraint</i>. See
<b>TEST CONSTRAINTS</b> below for more information.</p>

<p style="margin-left:11%;"><b>interpreter</b>
<i>?executableName?</i></p>

<p style="margin-left:22%;">Sets or returns the name of the
executable to be <b>exec</b>ed by <b>runAllTests</b> to run
each test file when <b>configure &minus;singleproc</b> is
false. The default value for <b>interpreter</b> is the name
of the currently running program as returned by <b>info
nameofexecutable</b>.</p>

<p style="margin-left:11%;"><b>outputChannel</b>
<i>?channelID?</i></p>

<p style="margin-left:22%;">Sets or returns the output
channel ID. This defaults to stdout. Any test that prints
test related output should send that output to
<b>outputChannel</b> rather than letting that output default
to stdout.</p>

<p style="margin-left:11%;"><b>errorChannel</b>
<i>?channelID?</i></p>

<p style="margin-left:22%;">Sets or returns the error
channel ID. This defaults to stderr. Any test that prints
error messages should send that output to
<b>errorChannel</b> rather than printing directly to
stderr.</p>

<h2>SHORTCUT COMMANDS
<a name="SHORTCUT COMMANDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>debug</b>
<i>?level?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;debug</b> <i>?level?</i>.</p>

<p style="margin-left:11%;"><b>errorFile</b>
<i>?filename?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;errfile</b> <i>?filename?</i>.</p>

<p style="margin-left:11%;"><b>limitConstraints</b>
<i>?boolean?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;limitconstraints</b> <i>?boolean?</i>.</p>

<p style="margin-left:11%;"><b>loadFile</b>
<i>?filename?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;loadfile</b> <i>?filename?</i>.</p>

<p style="margin-left:11%;"><b>loadScript</b>
<i>?script?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;load</b> <i>?script?</i>.</p>

<p style="margin-left:11%;"><b>match</b>
<i>?patternList?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;match</b> <i>?patternList?</i>.</p>

<p style="margin-left:11%;"><b>matchDirectories</b>
<i>?patternList?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;relateddir</b> <i>?patternList?</i>.</p>

<p style="margin-left:11%;"><b>matchFiles</b>
<i>?patternList?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;file</b> <i>?patternList?</i>.</p>

<p style="margin-left:11%;"><b>outputFile</b>
<i>?filename?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;outfile</b> <i>?filename?</i>.</p>

<p style="margin-left:11%;"><b>preserveCore</b>
<i>?level?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;preservecore</b> <i>?level?</i>.</p>

<p style="margin-left:11%;"><b>singleProcess</b>
<i>?boolean?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;singleproc</b> <i>?boolean?</i>.</p>

<p style="margin-left:11%;"><b>skip</b>
<i>?patternList?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;skip</b> <i>?patternList?</i>.</p>

<p style="margin-left:11%;"><b>skipDirectories</b>
<i>?patternList?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;asidefromdir</b> <i>?patternList?</i>.</p>

<p style="margin-left:11%;"><b>skipFiles</b>
<i>?patternList?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;notfile</b> <i>?patternList?</i>.</p>

<p style="margin-left:11%;"><b>temporaryDirectory</b>
<i>?directory?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;tmpdir</b> <i>?directory?</i>.</p>

<p style="margin-left:11%;"><b>testsDirectory</b>
<i>?directory?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;testdir</b> <i>?directory?</i>.</p>

<p style="margin-left:11%;"><b>verbose</b>
<i>?level?</i></p>

<p style="margin-left:22%;">Same as <b>configure
&minus;verbose</b> <i>?level?</i>.</p>

<h2>OTHER COMMANDS
<a name="OTHER COMMANDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The remaining
commands provided by <b>tcltest</b> have better alternatives
provided by <b>tcltest</b> or <b>Tcl</b> itself. They are
retained to support existing test suites, but should be
avoided in new code. <b><br>
test</b> <i>name description optionList</i></p>

<p style="margin-left:22%;">This form of <b>test</b> was
provided to enable passing many options spanning several
lines to <b>test</b> as a single argument quoted by braces,
rather than needing to backslash quote the newlines between
arguments to <b>test</b>. The <i>optionList</i> argument is
expected to be a list with an even number of elements
representing <i>option</i> and <i>value</i> arguments to
pass to <b>test</b>. However, these values are not passed
directly, as in the alternate forms of <b>switch</b>.
Instead, this form makes an unfortunate attempt to overthrow
Tcl&rsquo;s substitution rules by performing substitutions
on some of the list elements as an attempt to implement a
&ldquo;do what I mean&rdquo; interpretation of a
brace-enclosed &ldquo;block&rdquo;. The result is nearly
impossible to document clearly, and for that reason this
form is not recommended. See the examples in <b>CREATING
TEST SUITES WITH TCLTEST</b> below to see that this form is
really not necessary to avoid backslash-quoted newlines. If
you insist on using this form, examine the source code of
<b>tcltest</b> if you want to know the substitution details,
or just enclose the third through last argument to
<b>test</b> in braces and hope for the best.</p>

<p style="margin-left:11%;"><b>workingDirectory</b>
<i>?directoryName?</i></p>

<p style="margin-left:22%;">Sets or returns the current
working directory when the test suite is running. The
default value for workingDirectory is the directory in which
the test suite was launched. The Tcl commands <b>cd</b> and
<b>pwd</b> are sufficient replacements.</p>

<p style="margin-left:11%;"><b>normalizeMsg</b>
<i>msg</i></p>

<p style="margin-left:22%;">Returns the result of removing
the &ldquo;extra&rdquo; newlines from <i>msg</i>, where
&ldquo;extra&rdquo; is rather imprecise. Tcl offers plenty
of string processing commands to modify strings as you wish,
and <b>customMatch</b> allows flexible matching of actual
and expected results.</p>

<p style="margin-left:11%;"><b>normalizePath</b>
<i>pathVar</i></p>

<p style="margin-left:22%;">Resolves symlinks in a path,
thus creating a path without internal redirection. It is
assumed that <i>pathVar</i> is absolute. <i>pathVar</i> is
modified in place. The Tcl command <b>file normalize</b> is
a sufficient replacement.</p>

<p style="margin-left:11%;"><b>bytestring</b>
<i>string</i></p>

<p style="margin-left:22%;">Construct a string that
consists of the requested sequence of bytes, as opposed to a
string of properly formed UTF-8 characters using the value
supplied in <i>string</i>. This allows the tester to create
denormalized or improperly formed strings to pass to C
procedures that are supposed to accept strings with embedded
NULL types and confirm that a string result has a certain
pattern of bytes. This is exactly equivalent to the Tcl
command <b>encoding convertfrom identity</b>.</p>

<h2>TESTS
<a name="TESTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The <b>test</b>
command is the heart of the <b>tcltest</b> package. Its
essential function is to evaluate a Tcl script and compare
the result with an expected result. The options of
<b>test</b> define the test script, the environment in which
to evaluate it, the expected result, and how the compare the
actual result to the expected result. Some configuration
options of <b>tcltest</b> also influence how <b>test</b>
operates.</p>

<p style="margin-left:11%; margin-top: 1em">The valid
options for <b>test</b> are summarized:</p>

<p style="margin-left:22%; margin-top: 1em"><b>test</b>
<i>name description</i> <br>
?-constraints <i>keywordList|expression</i>? <br>
?-setup <i>setupScript</i>? <br>
?-body <i>testScript</i>? <br>
?-cleanup <i>cleanupScript</i>? <br>
?-result <i>expectedAnswer</i>? <br>
?-output <i>expectedOutput</i>? <br>
?-errorOutput <i>expectedError</i>? <br>
?-returnCodes <i>codeList</i>? <br>
?-match <i>mode</i>?</p>

<p style="margin-left:11%; margin-top: 1em">The <i>name</i>
may be any string. It is conventional to choose a
<i>name</i> according to the pattern:</p>


<p style="margin-left:22%; margin-top: 1em"><i>target</i>-<i>majorNum</i>.<i>minorNum</i></p>

<p style="margin-left:11%; margin-top: 1em">For white-box
(regression) tests, the target should be the name of the C
function or Tcl procedure being tested. For black-box tests,
the target should be the name of the feature being tested.
Some conventions call for the names of black-box tests to
have the suffix <b>_bb</b>. Related tests should share a
major number. As a test suite evolves, it is best to have
the same test name continue to correspond to the same test,
so that it remains meaningful to say things like &ldquo;Test
foo-1.3 passed in all releases up to 3.4, but began failing
in release 3.5.&rdquo;</p>

<p style="margin-left:11%; margin-top: 1em">During
evaluation of <b>test</b>, the <i>name</i> will be compared
to the lists of string matching patterns returned by
<b>configure &minus;match</b>, and <b>configure
&minus;skip</b>. The test will be run only if <i>name</i>
matches any of the patterns from <b>configure
&minus;match</b> and matches none of the patterns from
<b>configure &minus;skip</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>description</i> should be a short textual description of
the test. The <i>description</i> is included in output
produced by the test, typically test failure messages. Good
<i>description</i> values should briefly explain the purpose
of the test to users of a test suite. The name of a Tcl or C
function being tested should be included in the description
for regression tests. If the test case exists to reproduce a
bug, include the bug ID in the description.</p>

<p style="margin-left:11%; margin-top: 1em">Valid
attributes and associated values are: <b><br>
&minus;constraints</b> <i>keywordList|expression</i></p>

<p style="margin-left:22%;">The optional
<b>&minus;constraints</b> attribute can be list of one or
more keywords or an expression. If the
<b>&minus;constraints</b> value is a list of keywords, each
of these keywords should be the name of a constraint defined
by a call to <b>testConstraint</b>. If any of the listed
constraints is false or does not exist, the test is skipped.
If the <b>&minus;constraints</b> value is an expression,
that expression is evaluated. If the expression evaluates to
true, then the test is run. Note that the expression form of
<b>&minus;constraints</b> may interfere with the operation
of <b>configure &minus;constraints</b> and <b>configure
&minus;limitconstraints</b>, and is not recommended.
Appropriate constraints should be added to any tests that
should not always be run. That is, conditional evaluation of
a test should be accomplished by the
<b>&minus;constraints</b> option, not by conditional
evaluation of <b>test</b>. In that way, the same number of
tests are always reported by the test suite, though the
number skipped may change based on the testing environment.
The default value is an empty list. See <b>TEST
CONSTRAINTS</b> below for a list of built-in constraints and
information on how to add your own constraints.</p>

<p style="margin-left:11%;"><b>&minus;setup</b>
<i>script</i></p>

<p style="margin-left:22%;">The optional
<b>&minus;setup</b> attribute indicates a <i>script</i> that
will be run before the script indicated by the
<b>&minus;body</b> attribute. If evaluation of <i>script</i>
raises an error, the test will fail. The default value is an
empty script.</p>

<p style="margin-left:11%;"><b>&minus;body</b>
<i>script</i></p>

<p style="margin-left:22%;">The <b>&minus;body</b>
attribute indicates the <i>script</i> to run to carry out
the test. It must return a result that can be checked for
correctness. If evaluation of <i>script</i> raises an error,
the test will fail. The default value is an empty
script.</p>

<p style="margin-left:11%;"><b>&minus;cleanup</b>
<i>script</i></p>

<p style="margin-left:22%;">The optional
<b>&minus;cleanup</b> attribute indicates a <i>script</i>
that will be run after the script indicated by the
<b>&minus;body</b> attribute. If evaluation of <i>script</i>
raises an error, the test will fail. The default value is an
empty script.</p>

<p style="margin-left:11%;"><b>&minus;match</b>
<i>mode</i></p>

<p style="margin-left:22%;">The <b>&minus;match</b>
attribute determines how expected answers supplied by
<b>&minus;result</b>, <b>&minus;output</b>, and
<b>&minus;errorOutput</b> are compared. Valid values for
<i>mode</i> are <b>regexp</b>, <b>glob</b>, <b>exact</b>,
and any value registered by a prior call to
<b>customMatch</b>. The default value is <b>exact</b>.</p>

<p style="margin-left:11%;"><b>&minus;result</b>
<i>expectedValue</i></p>

<p style="margin-left:22%;">The <b>&minus;result</b>
attribute supplies the <i>expectedValue</i> against which
the return value from script will be compared. The default
value is an empty string.</p>

<p style="margin-left:11%;"><b>&minus;output</b>
<i>expectedValue</i></p>

<p style="margin-left:22%;">The <b>&minus;output</b>
attribute supplies the <i>expectedValue</i> against which
any output sent to <b>stdout</b> or <b>outputChannel</b>
during evaluation of the script(s) will be compared. Note
that only output printed using <b>::puts</b> is used for
comparison. If <b>&minus;output</b> is not specified, output
sent to <b>stdout</b> and <b>outputChannel</b> is not
processed for comparison.</p>

<p style="margin-left:11%;"><b>&minus;errorOutput</b>
<i>expectedValue</i></p>

<p style="margin-left:22%;">The <b>&minus;errorOutput</b>
attribute supplies the <i>expectedValue</i> against which
any output sent to <b>stderr</b> or <b>errorChannel</b>
during evaluation of the script(s) will be compared. Note
that only output printed using <b>::puts</b> is used for
comparison. If <b>&minus;errorOutput</b> is not specified,
output sent to <b>stderr</b> and <b>errorChannel</b> is not
processed for comparison.</p>

<p style="margin-left:11%;"><b>&minus;returnCodes</b>
<i>expectedCodeList</i></p>

<p style="margin-left:22%;">The optional
<b>&minus;returnCodes</b> attribute supplies
<i>expectedCodeList</i>, a list of return codes that may be
accepted from evaluation of the <b>&minus;body</b> script.
If evaluation of the <b>&minus;body</b> script returns a
code not in the <i>expectedCodeList</i>, the test fails. All
return codes known to <b>return</b>, in both numeric and
symbolic form, including extended return codes, are
acceptable elements in the <i>expectedCodeList</i>. Default
value is &ldquo;<b>ok&rdquo;return</b>.</p>

<p style="margin-left:11%; margin-top: 1em">To pass, a test
must successfully evaluate its <b>&minus;setup</b>,
<b>&minus;body</b>, and <b>&minus;cleanup</b> scripts. The
return code of the <b>&minus;body</b> script and its result
must match expected values, and if specified, output and
error data from the test must match expected
<b>&minus;output</b> and <b>&minus;errorOutput</b> values.
If any of these conditions are not met, then the test fails.
Note that all scripts are evaluated in the context of the
caller of <b>test</b>.</p>

<p style="margin-left:11%; margin-top: 1em">As long as
<b>test</b> is called with valid syntax and legal values for
all attributes, it will not raise an error. Test failures
are instead reported as output written to
<b>outputChannel</b>. In default operation, a successful
test produces no output. The output messages produced by
<b>test</b> are controlled by the <b>configure
&minus;verbose</b> option as described in <b>CONFIGURABLE
OPTIONS</b> below. Any output produced by the test scripts
themselves should be produced using <b>::puts</b> to
<b>outputChannel</b> or <b>errorChannel</b>, so that users
of the test suite may easily capture output with the
<b>configure &minus;outfile</b> and <b>configure
&minus;errfile</b> options, and so that the
<b>&minus;output</b> and <b>&minus;errorOutput</b>
attributes work properly.</p>

<h2>TEST CONSTRAINTS
<a name="TEST CONSTRAINTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Constraints are
used to determine whether or not a test should be skipped.
Each constraint has a name, which may be any string, and a
boolean value. Each <b>test</b> has a
<b>&minus;constraints</b> value which is a list of
constraint names. There are two modes of constraint control.
Most frequently, the default mode is used, indicated by a
setting of <b>configure &minus;limitconstraints</b> to
false. The test will run only if all constraints in the list
are true-valued. Thus, the <b>&minus;constraints</b> option
of <b>test</b> is a convenient, symbolic way to define any
conditions required for the test to be possible or
meaningful. For example, a <b>test</b> with
<b>&minus;constraints unix</b> will only be run if the
constraint <b>unix</b> is true, which indicates the test
suite is being run on a Unix platform.</p>

<p style="margin-left:11%; margin-top: 1em">Each
<b>test</b> should include whatever
<b>&minus;constraints</b> are required to constrain it to
run only where appropriate. Several constraints are
pre-defined in the <b>tcltest</b> package, listed below. The
registration of user-defined constraints is performed by the
<b>testConstraint</b> command. User-defined constraints may
appear within a test file, or within the script specified by
the <b>configure &minus;load</b> or <b>configure
&minus;loadfile</b> options.</p>

<p style="margin-left:11%; margin-top: 1em">The following
is a list of constraints pre-defined by the <b>tcltest</b>
package itself: <i><br>
singleTestInterp</i></p>

<p style="margin-left:22%;">test can only be run if all
test files are sourced into a single interpreter</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><i>unix</i></p></td>
<td width="5%"></td>
<td width="72%">


<p>test can only be run on any Unix platform</p></td>
<td width="6%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><i>win</i></p></td>
<td width="5%"></td>
<td width="72%">


<p>test can only be run on any Windows platform</p></td>
<td width="6%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><i>nt</i></p></td>
<td width="5%"></td>
<td width="72%">


<p>test can only be run on any Windows NT platform</p></td>
<td width="6%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><i>95</i></p></td>
<td width="5%"></td>
<td width="72%">


<p>test can only be run on any Windows 95 platform</p></td>
<td width="6%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><i>98</i></p></td>
<td width="5%"></td>
<td width="72%">


<p>test can only be run on any Windows 98 platform</p></td>
<td width="6%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><i>mac</i></p></td>
<td width="5%"></td>
<td width="72%">


<p>test can only be run on any Mac platform</p></td>
<td width="6%">
</td></tr>
</table>

<p style="margin-left:11%;"><i>unixOrWin</i></p>

<p style="margin-left:22%;">test can only be run on a Unix
or Windows platform</p>

<p style="margin-left:11%;"><i>macOrWin</i></p>

<p style="margin-left:22%;">test can only be run on a Mac
or Windows platform</p>

<p style="margin-left:11%;"><i>macOrUnix</i></p>

<p style="margin-left:22%;">test can only be run on a Mac
or Unix platform</p>

<p style="margin-left:11%;"><i>tempNotWin</i></p>

<p style="margin-left:22%;">test can not be run on Windows.
This flag is used to temporarily disable a test.</p>

<p style="margin-left:11%;"><i>tempNotMac</i></p>

<p style="margin-left:22%;">test can not be run on a Mac.
This flag is used to temporarily disable a test.</p>

<p style="margin-left:11%;"><i>unixCrash</i></p>

<p style="margin-left:22%;">test crashes if it is run on
Unix. This flag is used to temporarily disable a test.</p>

<p style="margin-left:11%;"><i>winCrash</i></p>

<p style="margin-left:22%;">test crashes if it is run on
Windows. This flag is used to temporarily disable a
test.</p>

<p style="margin-left:11%;"><i>macCrash</i></p>

<p style="margin-left:22%;">test crashes if it is run on a
Mac. This flag is used to temporarily disable a test.</p>

<p style="margin-left:11%;"><i>emptyTest</i></p>

<p style="margin-left:22%;">test is empty, and so not worth
running, but it remains as a place-holder for a test to be
written in the future. This constraint has value false to
cause tests to be skipped unless the user specifies
otherwise.</p>

<p style="margin-left:11%;"><i>knownBug</i></p>

<p style="margin-left:22%;">test is known to fail and the
bug is not yet fixed. This constraint has value false to
cause tests to be skipped unless the user specifies
otherwise.</p>

<p style="margin-left:11%;"><i>nonPortable</i></p>

<p style="margin-left:22%;">test can only be run in some
known development environment. Some tests are inherently
non-portable because they depend on things like word length,
file system configuration, window manager, etc. This
constraint has value false to cause tests to be skipped
unless the user specifies otherwise.</p>

<p style="margin-left:11%;"><i>userInteraction</i></p>

<p style="margin-left:22%;">test requires interaction from
the user. This constraint has value false to causes tests to
be skipped unless the user specifies otherwise.</p>

<p style="margin-left:11%;"><i>interactive</i></p>

<p style="margin-left:22%;">test can only be run in if the
interpreter is in interactive mode (when the global
tcl_interactive variable is set to 1).</p>

<p style="margin-left:11%;"><i>nonBlockFiles</i></p>

<p style="margin-left:22%;">test can only be run if
platform supports setting files into nonblocking mode</p>

<p style="margin-left:11%;"><i>asyncPipeClose</i></p>

<p style="margin-left:22%;">test can only be run if
platform supports async flush and async close on a pipe</p>

<p style="margin-left:11%;"><i>unixExecs</i></p>

<p style="margin-left:22%;">test can only be run if this
machine has Unix-style commands <b>cat</b>, <b>echo</b>,
<b>sh</b>, <b>wc</b>, <b>rm</b>, <b>sleep</b>, <b>fgrep</b>,
<b>ps</b>, <b>chmod</b>, and <b>mkdir</b> available</p>

<p style="margin-left:11%;"><i>hasIsoLocale</i></p>

<p style="margin-left:22%;">test can only be run if can
switch to an ISO locale</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><i>root</i></p></td>
<td width="5%"></td>
<td width="58%">


<p>test can only run if Unix user is root</p></td>
<td width="20%">
</td></tr>
</table>

<p style="margin-left:11%;"><i>notRoot</i></p>

<p style="margin-left:22%;">test can only run if Unix user
is not root</p>

<p style="margin-left:11%;"><i>eformat</i></p>

<p style="margin-left:22%;">test can only run if app has a
working version of sprintf with respect to the
&ldquo;e&rdquo; format of floating-point numbers.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><i>stdio</i></p></td>
<td width="4%"></td>
<td width="78%">


<p>test can only be run if <b>interpreter</b> can be
<b>open</b>ed as a pipe.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The alternative
mode of constraint control is enabled by setting
<b>configure &minus;limitconstraints</b> to true. With that
configuration setting, all existing constraints other than
those in the constraint list returned by <b>configure
&minus;constraints</b> are set to false. When the value of
<b>configure &minus;constraints</b> is set, all those
constraints are set to true. The effect is that when both
options <b>configure &minus;constraints</b> and <b>configure
&minus;limitconstraints</b> are in use, only those tests
including only constraints from the <b>configure
&minus;constraints</b> list are run; all others are skipped.
For example, one might set up a configuration with</p>


<p style="margin-left:22%; margin-top: 1em"><b>configure</b>
-constraints knownBug \ <br>
-limitconstraints true \ <br>
-verbose pass</p>

<p style="margin-left:11%; margin-top: 1em">to run exactly
those tests that exercise known bugs, and discover whether
any of them pass, indicating the bug had been fixed.</p>

<h2>RUNNING ALL TESTS
<a name="RUNNING ALL TESTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The single
command <b>runAllTests</b> is evaluated to run an entire
test suite, spanning many files and directories. The
configuration options of <b>tcltest</b> control the precise
operations. The <b>runAllTests</b> command begins by
printing a summary of its configuration to
<b>outputChannel</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Test files to
be evaluated are sought in the directory <b>configure
&minus;testdir</b>. The list of files in that directory that
match any of the patterns in <b>configure &minus;file</b>
and match none of the patterns in <b>configure
&minus;notfile</b> is generated and sorted. Then each file
will be evaluated in turn. If <b>configure
&minus;singleproc</b> is true, then each file will be
<b>source</b>d in the caller&rsquo;s context. If it is
false, then a copy of <b>interpreter</b> will be
<b>exec</b>&rsquo;d to evaluate each file. The multi-process
operation is useful when testing can cause errors so severe
that a process terminates. Although such an error may
terminate a child process evaluating one file, the master
process can continue with the rest of the test suite. In
multi-process operation, the configuration of <b>tcltest</b>
in the master process is passed to the child processes as
command line arguments, with the exception of <b>configure
&minus;outfile</b>. The <b>runAllTests</b> command in the
master process collects all output from the child processes
and collates their results into one master report. Any
reports of individual test failures, or messages requested
by a <b>configure &minus;verbose</b> setting are passed
directly on to <b>outputChannel</b> by the master
process.</p>

<p style="margin-left:11%; margin-top: 1em">After
evaluating all selected test files, a summary of the results
is printed to <b>outputChannel</b>. The summary includes the
total number of <b>test</b>s evaluated, broken down into
those skipped, those passed, and those failed. The summary
also notes the number of files evaluated, and the names of
any files with failing tests or errors. A list of the
constraints that caused tests to be skipped, and the number
of tests skipped for each is also printed. Also, messages
are printed if it appears that evaluation of a test file has
caused any temporary files to be left behind in <b>configure
&minus;tmpdir</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Having
completed and summarized all selected test files,
<b>runAllTests</b> then recursively acts on subdirectories
of <b>configure &minus;testdir</b>. All subdirectories that
match any of the patterns in <b>configure
&minus;relateddir</b> and do not match any of the patterns
in <b>configure &minus;asidefromdir</b> are examined. If a
file named <b>all.tcl</b> is found in such a directory, it
will be <b>source</b>d in the caller&rsquo;s context.
Whether or not an examined directory contains an
<b>all.tcl</b> file, its subdirectories are also scanned
against the <b>configure &minus;relateddir</b> and
<b>configure &minus;asidefromdir</b> patterns. In this way,
many directories in a directory tree can have all their test
files evaluated by a single <b>runAllTests</b> command.</p>

<h2>CONFIGURABLE OPTIONS
<a name="CONFIGURABLE OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>configure</b> command is used to set and query the
configurable options of <b>tcltest</b>. The valid options
are: <b><br>
&minus;singleproc</b> <i>boolean</i></p>

<p style="margin-left:22%;">Controls whether or not
<b>runAllTests</b> spawns a child process for each test
file. No spawning when <i>boolean</i> is true. Default value
is false.</p>

<p style="margin-left:11%;"><b>&minus;debug</b>
<i>level</i></p>

<p style="margin-left:22%;">Sets the debug level to
<i>level</i>, an integer value indicating how much debugging
information should be printed to stdout. Note that debug
messages always go to stdout, independent of the value of
<b>configure &minus;outfile</b>. Default value is 0. Levels
are defined as:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>0</p></td>
<td width="9%"></td>
<td width="68%">


<p>Do not display any debug information.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>1</p></td>
<td width="9%"></td>
<td width="68%">


<p>Display information regarding whether a test is skipped
because it does not match any of the tests that were
specified using by <b>configure &minus;match</b>
(userSpecifiedNonMatch) or matches any of the tests
specified by <b>configure &minus;skip</b>
(userSpecifiedSkip). Also print warnings about possible lack
of cleanup or balance in test files. Also print warnings
about any re-use of test names.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>2</p></td>
<td width="9%"></td>
<td width="68%">


<p>Display the flag array parsed by the command line
processor, the contents of the ::env array, and all
user-defined variables that exist in the current namespace
as they are used.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>3</p></td>
<td width="9%"></td>
<td width="68%">


<p>Display information regarding what individual procs in
the test harness are doing.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;verbose</b>
<i>level</i></p>

<p style="margin-left:22%;">Sets the type of output
verbosity desired to <i>level</i>, a list of zero or more of
the elements <b>body</b>, <b>pass</b>, <b>skip</b>,
<b>start</b>, <b>error</b> and <b>line</b>. Default value is
<b>{body error}</b>. Levels are defined as: <br>
body (b)</p>

<p style="margin-left:32%;">Display the body of failed
tests</p>

<p style="margin-left:22%;">pass (p)</p>

<p style="margin-left:32%;">Print output when a test
passes</p>

<p style="margin-left:22%;">skip (s)</p>

<p style="margin-left:32%;">Print output when a test is
skipped</p>

<p style="margin-left:22%;">start (t)</p>

<p style="margin-left:32%;">Print output whenever a test
starts</p>

<p style="margin-left:22%;">error (e)</p>

<p style="margin-left:32%;">Print errorInfo and errorCode,
if they exist, when a test return code does not match its
expected return code</p>

<p style="margin-left:22%;">line (l)</p>

<p style="margin-left:32%;">Print source file line
information of failed tests</p>

<p style="margin-left:11%;">The single letter abbreviations
noted above are also recognized so that &ldquo;<b>configure
&minus;verbose pt</b>&rdquo; is the same as
&ldquo;<b>configure &minus;verbose {pass start}</b>&rdquo;.
<b><br>
&minus;preservecore</b> <i>level</i></p>

<p style="margin-left:22%;">Sets the core preservation
level to <i>level</i>. This level determines how stringent
checks for core files are. Default value is 0. Levels are
defined as:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>0</p></td>
<td width="9%"></td>
<td width="68%">


<p>No checking &mdash; do not check for core files at the
end of each test command, but do check for them in
<b>runAllTests</b> after all test files have been
evaluated.</p> </td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>1</p></td>
<td width="9%"></td>
<td width="68%">


<p>Also check for core files at the end of each <b>test</b>
command.</p> </td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>2</p></td>
<td width="9%"></td>
<td width="68%">


<p>Check for core files at all times described above, and
save a copy of each core file produced in <b>configure
&minus;tmpdir</b>.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;limitconstraints</b>
<i>boolean</i></p>

<p style="margin-left:22%;">Sets the mode by which
<b>test</b> honors constraints as described in <b>TESTS</b>
above. Default value is false.</p>

<p style="margin-left:11%;"><b>&minus;constraints</b>
<i>list</i></p>

<p style="margin-left:22%;">Sets all the constraints in
<i>list</i> to true. Also used in combination with
<b>configure &minus;limitconstraints true</b> to control an
alternative constraint mode as described in <b>TESTS</b>
above. Default value is an empty list.</p>

<p style="margin-left:11%;"><b>&minus;tmpdir</b>
<i>directory</i></p>

<p style="margin-left:22%;">Sets the temporary directory to
be used by <b>makeFile</b>, <b>makeDirectory</b>,
<b>viewFile</b>, <b>removeFile</b>, and
<b>removeDirectory</b> as the default directory where
temporary files and directories created by test files should
be created. Default value is <b>workingDirectory</b>.</p>

<p style="margin-left:11%;"><b>&minus;testdir</b>
<i>directory</i></p>

<p style="margin-left:22%;">Sets the directory searched by
<b>runAllTests</b> for test files and subdirectories.
Default value is <b>workingDirectory</b>.</p>

<p style="margin-left:11%;"><b>&minus;file</b>
<i>patternList</i></p>

<p style="margin-left:22%;">Sets the list of patterns used
by <b>runAllTests</b> to determine what test files to
evaluate. Default value is &ldquo;<b>*.test</b>&rdquo;.</p>

<p style="margin-left:11%;"><b>&minus;notfile</b>
<i>patternList</i></p>

<p style="margin-left:22%;">Sets the list of patterns used
by <b>runAllTests</b> to determine what test files to skip.
Default value is &ldquo;<b>l.*.test</b>&rdquo;, so that any
SCCS lock files are skipped.</p>

<p style="margin-left:11%;"><b>&minus;relateddir</b>
<i>patternList</i></p>

<p style="margin-left:22%;">Sets the list of patterns used
by <b>runAllTests</b> to determine what subdirectories to
search for an <b>all.tcl</b> file. Default value is
&ldquo;<b>*</b>&rdquo;.</p>

<p style="margin-left:11%;"><b>&minus;asidefromdir</b>
<i>patternList</i></p>

<p style="margin-left:22%;">Sets the list of patterns used
by <b>runAllTests</b> to determine what subdirectories to
skip when searching for an <b>all.tcl</b> file. Default
value is an empty list.</p>

<p style="margin-left:11%;"><b>&minus;match</b>
<i>patternList</i></p>

<p style="margin-left:22%;">Set the list of patterns used
by <b>test</b> to determine whether a test should be run.
Default value is &ldquo;<b>*</b>&rdquo;.</p>

<p style="margin-left:11%;"><b>&minus;skip</b>
<i>patternList</i></p>

<p style="margin-left:22%;">Set the list of patterns used
by <b>test</b> to determine whether a test should be
skipped. Default value is an empty list.</p>

<p style="margin-left:11%;"><b>&minus;load</b>
<i>script</i></p>

<p style="margin-left:22%;">Sets a script to be evaluated
by <b>loadTestedCommands</b>. Default value is an empty
script.</p>

<p style="margin-left:11%;"><b>&minus;loadfile</b>
<i>filename</i></p>

<p style="margin-left:22%;">Sets the filename from which to
read a script to be evaluated by <b>loadTestedCommands</b>.
This is an alternative to <b>&minus;load</b>. They cannot be
used together.</p>

<p style="margin-left:11%;"><b>&minus;outfile</b>
<i>filename</i></p>

<p style="margin-left:22%;">Sets the file to which all
output produced by tcltest should be written. A file named
<i>filename</i> will be <b>open</b>ed for writing, and the
resulting channel will be set as the value of
<b>outputChannel</b>.</p>

<p style="margin-left:11%;"><b>&minus;errfile</b>
<i>filename</i></p>

<p style="margin-left:22%;">Sets the file to which all
error output produced by tcltest should be written. A file
named <i>filename</i> will be <b>open</b>ed for writing, and
the resulting channel will be set as the value of
<b>errorChannel</b>.</p>

<h2>CREATING TEST SUITES WITH TCLTEST
<a name="CREATING TEST SUITES WITH TCLTEST"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The fundamental
element of a test suite is the individual <b>test</b>
command. We begin with several examples.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p>[1]</p></td>
<td width="7%"></td>
<td width="60%">


<p>Test of a script that returns normally.</p></td>
<td width="18%">
</td></tr>
</table>

<p style="margin-left:32%; margin-top: 1em"><b>test</b>
example-1.0 {normal return} { <br>
format %s value <br>
} value</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">[2]</p></td>
<td width="7%"></td>
<td width="78%">


<p style="margin-top: 1em">Test of a script that requires
context setup and cleanup. Note the bracing and indenting
style that avoids any need for line continuation.</p></td></tr>
</table>

<p style="margin-left:32%; margin-top: 1em"><b>test</b>
example-1.1 {test file existence} -setup { <br>
set file [makeFile {} test] <br>
} -body { <br>
file exists $file <br>
} -cleanup { <br>
removeFile test <br>
} -result 1</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">[3]</p></td>
<td width="7%"></td>
<td width="58%">


<p style="margin-top: 1em">Test of a script that raises an
error.</p> </td>
<td width="20%">
</td></tr>
</table>

<p style="margin-left:32%; margin-top: 1em"><b>test</b>
example-1.2 {error return} -body { <br>
error message <br>
} -returnCodes error -result message</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">[4]</p></td>
<td width="7%"></td>
<td width="35%">


<p style="margin-top: 1em">Test with a constraint.</p></td>
<td width="43%">
</td></tr>
</table>

<p style="margin-left:32%; margin-top: 1em"><b>test</b>
example-1.3 {user owns created files} -constraints { <br>
unix <br>
} -setup { <br>
set file [makeFile {} test] <br>
} -body { <br>
file attributes $file -owner <br>
} -cleanup { <br>
removeFile test <br>
} -result $::tcl_platform(user)</p>

<p style="margin-left:11%; margin-top: 1em">At the next
higher layer of organization, several <b>test</b> commands
are gathered together into a single test file. Test files
should have names with the <b>.test</b> extension, because
that is the default pattern used by <b>runAllTests</b> to
find test files. It is a good rule of thumb to have one test
file for each source code file of your project. It is good
practice to edit the test file and the source code file
together, keeping tests synchronized with code changes.</p>

<p style="margin-left:11%; margin-top: 1em">Most of the
code in the test file should be the <b>test</b> commands.
Use constraints to skip tests, rather than conditional
evaluation of <b>test</b>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">[5]</p></td>
<td width="7%"></td>
<td width="78%">


<p style="margin-top: 1em">Recommended system for writing
conditional tests, using constraints to guard:</p></td></tr>
</table>


<p style="margin-left:32%; margin-top: 1em"><b>testConstraint</b>
X [expr $myRequirement] <b><br>
test</b> goodConditionalTest {} X { <br>
# body <br>
} result</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">[6]</p></td>
<td width="7%"></td>
<td width="78%">


<p style="margin-top: 1em">Discouraged system for writing
conditional tests, using <b>if</b> to guard:</p></td></tr>
</table>

<p style="margin-left:32%; margin-top: 1em">if
$myRequirement { <br>
test badConditionalTest {} { <br>
#body <br>
} result <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">Use the
<b>&minus;setup</b> and <b>&minus;cleanup</b> options to
establish and release all context requirements of the test
body. Do not make tests depend on prior tests in the file.
Those prior tests might be skipped. If several consecutive
tests require the same context, the appropriate setup and
cleanup scripts may be stored in variable for passing to
each tests <b>&minus;setup</b> and <b>&minus;cleanup</b>
options. This is a better solution than performing setup
outside of <b>test</b> commands, because the setup will only
be done if necessary, and any errors during setup will be
reported, and not cause the test file to abort.</p>

<p style="margin-left:11%; margin-top: 1em">A test file
should be able to be combined with other test files and not
interfere with them, even when <b>configure
&minus;singleproc 1</b> causes all files to be evaluated in
a common interpreter. A simple way to achieve this is to
have your tests define all their commands and variables in a
namespace that is deleted when the test file evaluation is
complete. A good namespace to use is a child namespace
<b>test</b> of the namespace of the module you are
testing.</p>

<p style="margin-left:11%; margin-top: 1em">A test file
should also be able to be evaluated directly as a script,
not depending on being called by a master
<b>runAllTests</b>. This means that each test file should
process command line arguments to give the tester all the
configuration control that <b>tcltest</b> provides.</p>

<p style="margin-left:11%; margin-top: 1em">After all
<b>test</b>s in a test file, the command <b>cleanupTests</b>
should be called.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">[7]</p></td>
<td width="7%"></td>
<td width="78%">


<p style="margin-top: 1em">Here is a sketch of a sample
test file illustrating those points:</p></td></tr>
</table>

<p style="margin-left:32%; margin-top: 1em">package require
tcltest 2.2 <br>
eval <b>::tcltest::configure</b> $argv <br>
package require example <br>
namespace eval ::example::test { <br>
namespace import ::tcltest::* <b><br>
testConstraint</b> X [expr {...}] <br>
variable SETUP {#common setup code} <br>
variable CLEANUP {#common cleanup code} <b><br>
test</b> example-1 {} -setup $SETUP -body { <br>
# First test <br>
} -cleanup $CLEANUP -result {...} <b><br>
test</b> example-2 {} -constraints X -setup $SETUP -body {
<br>
# Second test; constrained <br>
} -cleanup $CLEANUP -result {...} <b><br>
test</b> example-3 {} { <br>
# Third test; no context required <br>
} {...} <b><br>
cleanupTests</b> <br>
} <br>
namespace delete ::example::test</p>

<p style="margin-left:11%; margin-top: 1em">The next level
of organization is a full test suite, made up of several
test files. One script is used to control the entire suite.
The basic function of this script is to call
<b>runAllTests</b> after doing any necessary setup. This
script is usually named <b>all.tcl</b> because that is the
default name used by <b>runAllTests</b> when combining
multiple test suites into one testing run.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">[8]</p></td>
<td width="7%"></td>
<td width="78%">


<p style="margin-top: 1em">Here is a sketch of a sample
test suite master script:</p></td></tr>
</table>

<p style="margin-left:32%; margin-top: 1em">package require
Tcl 8.4 <br>
package require tcltest 2.2 <br>
package require example <b><br>
::tcltest::configure</b> -testdir \ <br>
[file dirname [file normalize [info script]]] <br>
eval <b>::tcltest::configure</b> $argv <b><br>
::tcltest::runAllTests</b></p>

<h2>COMPATIBILITY
<a name="COMPATIBILITY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A number of
commands and variables in the <b>::tcltest</b> namespace
provided by earlier releases of <b>tcltest</b> have not been
documented here. They are no longer part of the supported
public interface of <b>tcltest</b> and should not be used in
new test suites. However, to continue to support existing
test suites written to the older interface specifications,
many of those deprecated commands and variables still work
as before. For example, in many circumstances,
<b>configure</b> will be automatically called shortly after
<b>package require tcltest 2.1</b> succeeds with arguments
from the variable <b>::argv</b>. This is to support test
suites that depend on the old behavior that <b>tcltest</b>
was automatically configured from command line arguments.
New test files should not depend on this, but should
explicitly include</p>

<p style="margin-left:22%; margin-top: 1em">eval
<b>::tcltest::configure</b> $::argv</p>

<p style="margin-left:11%; margin-top: 1em">to establish a
configuration from command line arguments.</p>

<h2>KNOWN ISSUES
<a name="KNOWN ISSUES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">There are two
known issues related to nested evaluations of <b>test</b>.
The first issue relates to the stack level in which test
scripts are executed. Tests nested within other tests may be
executed at the same stack level as the outermost test. For
example, in the following code:</p>

<p style="margin-left:22%; margin-top: 1em"><b>test</b>
level-1.1 {level 1} { <br>
-body { <b><br>
test</b> level-2.1 {level 2} { <br>
} <br>
} <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">any script
executed in level-2.1 may be executed at the same stack
level as the script defined for level-1.1.</p>

<p style="margin-left:11%; margin-top: 1em">In addition,
while two <b>test</b>s have been run, results will only be
reported by <b>cleanupTests</b> for tests at the same level
as test level-1.1. However, test results for all tests run
prior to level-1.1 will be available when test level-2.1
runs. What this means is that if you try to access the test
results for test level-2.1, it will may say that
&ldquo;m&rdquo; tests have run, &ldquo;n&rdquo; tests have
been skipped, &ldquo;o&rdquo; tests have passed and
&ldquo;p&rdquo; tests have failed, where &ldquo;m&rdquo;,
&ldquo;n&rdquo;, &ldquo;o&rdquo;, and &ldquo;p&rdquo; refer
to tests that were run at the same test level as test
level-1.1.</p>

<p style="margin-left:11%; margin-top: 1em">Implementation
of output and error comparison in the test command depends
on usage of ::puts in your application code. Output is
intercepted by redefining the ::puts command while the
defined test script is being run. Errors thrown by C
procedures or printed directly from C applications will not
be caught by the test command. Therefore, usage of the
<b>&minus;output</b> and <b>&minus;errorOutput</b> options
to <b>test</b> is useful only for pure Tcl applications that
use <b>::puts</b> to produce output.</p>

<h2>KEYWORDS
<a name="KEYWORDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">test, test
harness, test suite</p>
<hr>
</body>
</html>
