<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Thu Aug 18 15:04:01 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>Tcl_AddErrorInfo</title>

</head>
<body>

<h1 align="center">Tcl_AddErrorInfo</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#ARGUMENTS">ARGUMENTS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#KEYWORDS">KEYWORDS</a><br>

<hr>



<p>______________________________________________________________________________</p>

<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Tcl_GetReturnOptions,
Tcl_SetReturnOptions, Tcl_AddErrorInfo,
Tcl_AppendObjToErrorInfo, Tcl_AddObjErrorInfo,
Tcl_SetObjErrorCode, Tcl_SetErrorCode, Tcl_SetErrorCodeVA,
Tcl_PosixError, Tcl_LogCommandInfo &minus; retrieve or
record information about errors and other return options</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;tcl.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Tcl_Obj *
<big>&#9474;</big> <b><br>
Tcl_GetReturnOptions</b>(<i>interp, code</i>)
<big>&#9474;</big></p>

<p style="margin-left:11%; margin-top: 1em">int
<big>&#9474;</big> <b><br>
Tcl_SetReturnOptions</b>(<i>interp, options</i>)
<big>&#9474;</big></p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_AddErrorInfo</b>(<i>interp,
message</i>)</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_AppendObjToErrorInfo</b>(<i>interp,
objPtr</i>) <big>&#9474;</big></p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_AddObjErrorInfo</b>(<i>interp,
message, length</i>)</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_SetObjErrorCode</b>(<i>interp,
errorObjPtr</i>)</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_SetErrorCode</b>(<i>interp,
element, element, ...</i> <b>(char *) NULL</b>)</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_SetErrorCodeVA</b>(<i>interp,
argList</i>)</p>

<p style="margin-left:11%; margin-top: 1em">const char *
<b><br>
Tcl_PosixError</b>(<i>interp</i>)</p>

<p style="margin-left:11%; margin-top: 1em">void <b><br>
Tcl_LogCommandInfo</b>(<i>interp, script, command,
commandLength</i>)</p>

<h2>ARGUMENTS
<a name="ARGUMENTS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="35%">


<p style="margin-top: 1em">Tcl_Interp <i>*interp</i>
(in)</p> </td>
<td width="25%"></td>
<td width="29%">


<p style="margin-top: 1em">Interpreter in which to record
information.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="35%">


<p>int <i>code</i></p></td>
<td width="25%"></td>
<td width="29%">


<p>The code returned from script evaluation.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="35%">


<p>Tcl_Obj <i>*options</i></p></td>
<td width="25%"></td>
<td width="29%">


<p>A dictionary of return options.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="35%">


<p>char <i>*message</i> (in)</p></td>
<td width="25%"></td>
<td width="29%">


<p>For <b>Tcl_AddErrorInfo</b>, this is a conventional C
string to append to the <b>&minus;errorinfo</b> return
option. For <b>Tcl_AddObjErrorInfo</b>, this points to the
first byte of an array of <i>length</i> bytes containing a
string to append to the <b>&minus;errorinfo</b> return
option. This byte array may contain embedded null bytes
unless <i>length</i> is negative. <big>&#9474;</big></p></td></tr>
</table>

<p style="margin-left:11%;">Tcl_Obj <i>*objPtr</i> (in)
<big>&#9474;</big></p>

<p style="margin-left:71%;">A message to be appended to the
<big>&#9474;</big> <b>&minus;errorinfo</b> return option in
the <big>&#9474;</big> form of a Tcl_Obj value.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="38%">


<p>int <i>length</i> (in)</p></td>
<td width="22%"></td>
<td width="29%">


<p>The number of bytes to copy from <i>message</i> when
appending to the <b>&minus;errorinfo</b> return option. If
negative, all bytes up to the first null byte are used.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="38%">


<p>Tcl_Obj <i>*errorObjPtr</i> (in)</p></td>
<td width="22%"></td>
<td width="29%">


<p>The <b>&minus;errorcode</b> return option will be set to
this value.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="38%">


<p>char <i>*element</i> (in)</p></td>
<td width="22%"></td>
<td width="29%">


<p>String to record as one element of the
<b>&minus;errorcode</b> return option. Last <i>element</i>
argument must be NULL.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="38%">


<p>va_list <i>argList</i> (in)</p></td>
<td width="22%"></td>
<td width="29%">


<p>An argument list which must have been initialized using
<b>va_start</b>, and cleared using <b>va_end</b>.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="38%">


<p>const char <i>*script</i> (in)</p></td>
<td width="22%"></td>
<td width="29%">


<p>Pointer to first character in script containing command
(must be &lt;= command)</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="38%">


<p>const char <i>*command</i> (in)</p></td>
<td width="22%"></td>
<td width="29%">


<p>Pointer to first character in command that generated the
error</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="38%">


<p>int <i>commandLength</i> (in)</p></td>
<td width="22%"></td>
<td width="29%">


<p>Number of bytes in command; -1 means use all bytes up to
first null byte</p></td></tr>
</table>


<p style="margin-left:71%;">_________________________________________________________________</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>Tcl_SetReturnOptions</b> and <b>Tcl_GetReturnOptions</b>
routines expose the <big>&#9474;</big> same capabilities as
the <b>return</b> and <b>catch</b> commands, respectively,
in <big>&#9474;</big> the form of a C interface.
<big>&#9474;</big></p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_GetReturnOptions</b>
retrieves the dictionary of return options from an
<big>&#9474;</big> interpreter following a script
evaluation. Routines such as <b>Tcl_Eval</b>
<big>&#9474;</big> are called to evaluate a script in an
interpreter. These routines <big>&#9474;</big> return an
integer completion code. These routines also leave in the
<big>&#9474;</big> interpreter both a result and a
dictionary of return options generated <big>&#9474;</big> by
script evaluation. Just as <b>Tcl_GetObjResult</b> retrieves
the result, <big>&#9474;</big> <b>Tcl_GetReturnOptions</b>
retrieves the dictionary of return options. The
<big>&#9474;</big> integer completion code should be passed
as the <i>code</i> argument to <big>&#9474;</big>
<b>Tcl_GetReturnOptions</b> so that all required options
will be present in <big>&#9474;</big> the dictionary.
Specifically, a <i>code</i> value of <b>TCL_ERROR</b> will
ensure <big>&#9474;</big> that entries for the keys
<b>&minus;errorinfo</b>, <b>&minus;errorcode</b>, and
<b>&minus;errorline</b> will <big>&#9474;</big> appear in
the dictionary. Also, the entries for the keys
<b>&minus;code</b> and <big>&#9474;</big>
<b>&minus;level</b> will be adjusted if necessary to agree
with the value of <i>code</i>. <big>&#9474;</big> The
<b>(Tcl_Obj *)</b> returned by <b>Tcl_GetReturnOptions</b>
points to an unshared <big>&#9474;</big> <b>Tcl_Obj</b> with
reference count of zero. The dictionary may be written
<big>&#9474;</big> to, either adding, removing, or
overwriting any entries in it, without <big>&#9474;</big>
the need to check for a shared object.
<big>&#9474;</big></p>

<p style="margin-left:11%; margin-top: 1em">A typical usage
for <b>Tcl_GetReturnOptions</b> is to retrieve the stack
trace <big>&#9474;</big> when script evaluation returns
<b>TCL_ERROR</b>, like so: <big>&#9474;</big></p>

<p style="margin-left:22%;">int code = Tcl_Eval(interp,
script); <big>&#9474;</big> <br>
if (code == TCL_ERROR) { <big>&#9474;</big> <br>
Tcl_Obj *options = Tcl_GetReturnOptions(interp, code);
<big>&#9474;</big> <br>
Tcl_Obj *key = Tcl_NewStringObj(&quot;-errorinfo&quot;, -1);
<big>&#9474;</big> <br>
Tcl_Obj *stackTrace; <big>&#9474;</big> <br>
Tcl_IncrRefCount(key); <big>&#9474;</big> <br>
Tcl_DictObjGet(NULL, options, key, &amp;stackTrace);
<big>&#9474;</big> <br>
Tcl_DecrRefCount(key); <big>&#9474;</big> <br>
/* Do something with stackTrace */ <big>&#9474;</big> <br>
} <big>&#9474;</big></p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_SetReturnOptions</b>
sets the return options of <i>interp</i> to be
<i>options</i>. <big>&#9474;</big> If <i>options</i>
contains any invalid value for any key, TCL_ERROR will be
<big>&#9474;</big> returned, and the interp result will be
set to an appropriate error <big>&#9474;</big> message.
Otherwise, a completion code in agreement with the
<b>&minus;code</b> and <big>&#9474;</big>
<b>&minus;level</b> keys in <i>options</i> will be returned.
<big>&#9474;</big></p>

<p style="margin-left:11%; margin-top: 1em">As an example,
Tcl&rsquo;s <b>return</b> command itself could be
implemented in <big>&#9474;</big> terms of
<b>Tcl_SetReturnOptions</b> like so: <big>&#9474;</big></p>

<p style="margin-left:22%;">if ((objc % 2) == 0) { /*
explicit result argument */ <big>&#9474;</big> <br>
objc--; <big>&#9474;</big> <br>
Tcl_SetObjResult(interp, objv[objc]); <big>&#9474;</big>
<br>
} <big>&#9474;</big> <br>
return Tcl_SetReturnOptions(interp, Tcl_NewListObj(objc-1,
objv+1)); <big>&#9474;</big></p>

<p style="margin-left:11%;">(It is not really implemented
that way. Internal access privileges <big>&#9474;</big>
allow for a more efficient alternative that meshes better
with the <big>&#9474;</big> bytecode compiler.)
<big>&#9474;</big></p>

<p style="margin-left:11%; margin-top: 1em">Note that a
newly created <b>Tcl_Obj</b> may be passed in as the
<i>options</i> <big>&#9474;</big> argument without the need
to tend to any reference counting. This is
<big>&#9474;</big> analogous to <b>Tcl_SetObjResult</b>.
<big>&#9474;</big></p>

<p style="margin-left:11%; margin-top: 1em">While
<b>Tcl_SetReturnOptions</b> provides a general interface to
set any <big>&#9474;</big> collection of return options,
there are a handful of return options <big>&#9474;</big>
that are very frequently used. Most notably the
<b>&minus;errorinfo</b> and <big>&#9474;</big>
<b>&minus;errorcode</b> return options should be set
properly when the command <big>&#9474;</big> procedure of a
command returns <b>TCL_ERROR</b>. Tcl provides several
simpler <big>&#9474;</big> interfaces to more directly set
these return options.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>&minus;errorinfo</b> option holds a stack trace of the
operations that were in progress when an error occurred, and
is intended to be human-readable. The
<b>&minus;errorcode</b> option holds a list of items that
are intended to be machine-readable. The first item in the
<b>&minus;errorcode</b> value identifies the class of error
that occurred (e.g. POSIX means an error occurred in a POSIX
system call) and additional elements hold additional pieces
of information that depend on the class. See the tclvars
manual entry for details on the various formats for the
<b>&minus;errorcode</b> option used by Tcl&rsquo;s built-in
commands.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>&minus;errorinfo</b> option value is gradually built up
as an error unwinds through the nested operations. Each time
an error code is returned to <b>Tcl_Eval</b>, or any of the
routines that performs script evaluation, the procedure
<b>Tcl_AddErrorInfo</b> is called to add additional text to
the <b>&minus;errorinfo</b> value describing the command
that was being executed when the error occurred. By the time
the error has been passed all the way back to the
application, it will contain a complete trace of the
activity in progress when the error occurred.</p>

<p style="margin-left:11%; margin-top: 1em">It is sometimes
useful to add additional information to the
<b>&minus;errorinfo</b> value beyond what can be supplied
automatically by the script evaluation routines.
<b>Tcl_AddErrorInfo</b> may be used for this purpose: its
<i>message</i> argument is an additional string to be
appended to the <b>&minus;errorinfo</b> option. For example,
when an error arises during the <b>source</b> command, the
procedure <b>Tcl_AddErrorInfo</b> is called to record the
name of the file being processed and the line number on
which the error occurred. Likewise, when an error arises
during evaluation of a Tcl procedures, the procedure name
and line number within the procedure are recorded, and so
on. The best time to call <b>Tcl_AddErrorInfo</b> is just
after a script evaluation routine has returned
<b>TCL_ERROR</b>. The value of the <b>&minus;errorline</b>
return option (retrieved via a call to
<b>Tcl_GetReturnOptions</b>) often makes up a useful part of
the <i>message</i> passed to <b>Tcl_AddErrorInfo</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_AppendObjToErrorInfo</b>
is an alternative interface to the same <big>&#9474;</big>
functionality as <b>Tcl_AddErrorInfo</b>.
<b>Tcl_AppendObjToErrorInfo</b> is called <big>&#9474;</big>
when the string value to be appended to the
<b>&minus;errorinfo</b> option is <big>&#9474;</big>
available as a <b>Tcl_Obj</b> instead of as a <b>char</b>
array.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_AddObjErrorInfo</b>
is nearly identical to <b>Tcl_AddErrorInfo</b>, except that
it has an additional <i>length</i> argument. This allows the
<i>message</i> string to contain embedded null bytes. This
is essentially never a good idea. If the <i>message</i>
needs to contain the null character <b>U+0000</b>,
Tcl&rsquo;s usual internal encoding rules should be used to
avoid the need for a null byte. If the
<b>Tcl_AddObjErrorInfo</b> interface is used at all, it
should be with a negative <i>length</i> value.</p>

<p style="margin-left:11%; margin-top: 1em">The procedure
<b>Tcl_SetObjErrorCode</b> is used to set the
<b>&minus;errorcode</b> return option to the list object
<i>errorObjPtr</i> built up by the caller.
<b>Tcl_SetObjErrorCode</b> is typically invoked just before
returning an error. If an error is returned without calling
<b>Tcl_SetObjErrorCode</b> or <b>Tcl_SetErrorCode</b> the
Tcl interpreter automatically sets the
<b>&minus;errorcode</b> return option to <b>NONE</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The procedure
<b>Tcl_SetErrorCode</b> is also used to set the
<b>&minus;errorcode</b> return option. However, it takes one
or more strings to record instead of an object. Otherwise,
it is similar to <b>Tcl_SetObjErrorCode</b> in behavior.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_SetErrorCodeVA</b>
is the same as <b>Tcl_SetErrorCode</b> except that instead
of taking a variable number of arguments it takes an
argument list.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_PosixError</b>
sets the <b>&minus;errorcode</b> variable after an error in
a POSIX kernel call. It reads the value of the <b>errno</b>
C variable and calls <b>Tcl_SetErrorCode</b> to set the
<b>&minus;errorcode</b> return option in the <b>POSIX</b>
format. The caller must previously have called
<b>Tcl_SetErrno</b> to set <b>errno</b>; this is necessary
on some platforms (e.g. Windows) where Tcl is linked into an
application as a shared library, or when the error occurs in
a dynamically loaded extension. See the manual entry for
<b>Tcl_SetErrno</b> for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_PosixError</b>
returns a human-readable diagnostic message for the error
(this is the same value that will appear as the third
element in the <b>&minus;errorcode</b> value). It may be
convenient to include this string as part of the error
message returned to the application in the
interpreter&rsquo;s result.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tcl_LogCommandInfo</b>
is invoked after an error occurs in an interpreter. It adds
information about the command that was being executed when
the error occurred to the <b>&minus;errorinfo</b> value, and
the line number stored internally in the interpreter is
set.</p>

<p style="margin-left:11%; margin-top: 1em">In older
releases of Tcl, there was no <b>Tcl_GetReturnOptions</b>
routine. In its place, the global Tcl variables
<b>errorInfo</b> and <b>errorCode</b> were the only place to
retrieve the error information. Much existing code written
for older Tcl releases still access this information via
those global variables.</p>

<p style="margin-left:11%; margin-top: 1em">It is important
to realize that while reading from those global variables
remains a supported way to access these return option
values, it is important not to assume that writing to those
global variables will properly set the corresponding return
options. It has long been emphasized in this manual page
that it is important to call the procedures described here
rather than setting <b>errorInfo</b> or <b>errorCode</b>
directly with <b>Tcl_ObjSetVar2</b>.</p>

<p style="margin-left:11%; margin-top: 1em">If the
procedure <b>Tcl_ResetResult</b> is called, it clears all of
the state of the interpreter associated with script
evaluation, including the entire return options dictionary.
In particular, the <b>&minus;errorinfo</b> and
<b>&minus;errorcode</b> options are reset. If an error had
occurred, the <b>Tcl_ResetResult</b> call will clear the
error state to make it appear as if no error had occurred
after all. The global variables <b>errorInfo</b> and
<b>errorCode</b> are not modified by <b>Tcl_ResetResult</b>
so they continue to hold a record of information about the
most recent error seen in an interpreter.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Tcl_DecrRefCount,
Tcl_IncrRefCount, Tcl_Interp, Tcl_ResetResult,
Tcl_SetErrno</p>

<h2>KEYWORDS
<a name="KEYWORDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">error, object,
object result, stack, trace, variable</p>
<hr>
</body>
</html>
